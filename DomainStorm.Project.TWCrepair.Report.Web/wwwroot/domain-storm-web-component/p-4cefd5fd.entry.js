import{r as t,c as s,a as e,h as i,H as h}from"./p-DTU8m96f.js";import{d as a}from"./p-CoYRMer0.js";import{C as l}from"./p-DVyujS5Y.js";import{d as c}from"./p-9Du3dL5x.js";import"./p-E-ZsRS8r.js";const o=class{constructor(e){t(this,e),this.valueChanged=s(this,"valueChanged"),this.change=s(this,"change"),this.searchChange=s(this,"searchChange")}_choices;_dataSet;_selectRef;get host(){return e(this)}label;value;name;dataSet;shouldSort=!1;selection="single";removeItemButton=!1;duplicateItemsAllowed=!1;searchable;searchTimeOut=500;searchFilter=!0;valueChanged;change;searchChange;dataSetWatcher(){this.initDataSet(),"active"===this._selectRef?.getAttribute("data-choice")&&this._dataSet&&(this._dataSet.length?this._choices.setChoices(this._dataSet,"value","label",!0):this._choices.clearStore())}valueWatcher(){if(this._choices){const t=this._choices.getValue(!0);Array.isArray(t)&&Array.isArray(this.value)?a(t,this.value)||this._choices.setChoiceByValue(this.value):t!==this.value&&this._choices.setChoiceByValue(this.value)}this.change.emit(this.value),this.valueChanged.emit(this.value)}setSearch=c((t=>{this.searchChange.emit(t)}),this.searchTimeOut);initSelection(){if(this._dataSet)if(this.value)this._dataSet.forEach((t=>{t.selected=Array.isArray(this.value)?this.value.includes(t.value):this.value==t.value}));else if(this._dataSet.some((t=>t.selected))){const t=this._dataSet.filter((t=>t.selected));this.value="single"===this.selection?t[0].value:t.map((t=>t.value))}else"single"===this.selection&&(this._dataSet[0].selected=!0,this.value=this._dataSet[0].value);else this.value="multiple"===this.selection?Array.from(this.host.querySelectorAll("option:checked")).map((t=>t.value)):this.host.querySelector("option:checked").value}initDataSet(){this.dataSet?"string"==typeof this.dataSet?this._dataSet=JSON.parse(this.dataSet):Array.isArray(this.dataSet)&&this.dataSet.length&&(this._dataSet=this.dataSet.map((t=>({value:t.id,label:t.title,selected:t.selected})))):this._dataSet=null}handleFocused=async t=>{t.target.parentElement.classList.add("is-focused")};handleFocusout=async t=>{const s=t.target;s.value&&s.parentElement.classList.add("is-filled"),s.parentElement.classList.remove("is-focused")};handleKeyUp=async t=>{const s=t.target;s.value?s.parentElement.classList.add("is-filled"):s.parentElement.classList.remove("is-filled")};componentWillLoad(){this.initDataSet(),this.initSelection()}labelRender(){if(this.label)return i("label",{class:"form-label ms-0"},this.label)}render(){return i(h,{key:"0e3ed519b3c64baa2f3987a7015d0889f2d0d8b3"},this.labelRender(),i("select",{key:"f50eef99f5dbb9e9415f6b9e32583e852e9e9284",class:"form-control",name:this.name,onFocus:t=>this.handleFocused(t),onFocusout:t=>this.handleFocusout(t),onKeyUp:t=>this.handleKeyUp(t),ref:t=>this._selectRef=t,multiple:"multiple"===this.selection},i("slot",{key:"04c502cad87fb35f84dcff0a679260cec028c09a",name:"option"})))}componentDidRender(){"active"!==this._selectRef.getAttribute("data-choice")&&(this._choices=new l(this._selectRef,{searchEnabled:this.searchable??"multiple"===this.selection,allowHTML:!0,removeItemButton:this.removeItemButton,noChoicesText:"沒有可供選擇的選項",noResultsText:"找不到任何結果",duplicateItemsAllowed:this.duplicateItemsAllowed,shouldSort:this.shouldSort,searchPlaceholderValue:"搜尋",searchChoices:this.searchFilter,searchFloor:-1}),this._dataSet&&this._choices.setChoices(this._dataSet,"value","label",!0),this._choices.passedElement.element.addEventListener("change",(t=>{t.preventDefault(),t.stopPropagation(),this.value=this._choices.getValue(!0)}),!1),this.searchFilter||this._selectRef.addEventListener("search",(t=>{this.setSearch(t.detail.value)})))}static get watchers(){return{dataSet:[{dataSetWatcher:0}],value:[{valueWatcher:0}]}}};o.style=".choices__list--dropdown,.choices__list[aria-expanded]{z-index:1030}";export{o as storm_select}