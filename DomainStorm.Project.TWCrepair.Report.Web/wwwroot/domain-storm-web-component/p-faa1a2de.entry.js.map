{"version":3,"names":["stormCarouselCss","StormCarousel","this","addItemElement","item","mimeType","h","innerHTML","content","startsWith","class","src","url","ref","el","videoRefs","set","controls","autoplay","type","controlInterval","carousel","pause","get","currentTime","play","cycle","componentDidRender","dataSet","Carousel","carouselRef","wrap","ride","addEventListener","ev","playListItems","to","_a","length","_b","forEach","v","next","addItem","Map","map","index","playDuration","render","Host","id","fade"],"sources":["src/components/storm-carousel/storm-carousel.css?tag=storm-carousel&encapsulation=shadow","src/components/storm-carousel/storm-carousel.tsx"],"sourcesContent":["@import '../../../material-dashboard-pro/assets/css/material-dashboard.min.css';\r\n\r\n.center {\r\n  display: block;\r\n  text-align: -webkit-center;\r\n}\r\n","import {Component, Host, h, Prop, Element} from '@stencil/core';\r\n// import {Carousel} from 'bootstrap';\r\nimport {Carousel} from 'bootstrap/dist/js/bootstrap.bundle';\r\n\r\n@Component({\r\n  tag: 'storm-carousel',\r\n  styleUrl: 'storm-carousel.css',\r\n  shadow: true,\r\n})\r\n\r\nexport class StormCarousel {\r\n  @Element() host: HTMLElement\r\n  @Prop() dataSet: IPlayList\r\n  @Prop() fade: boolean = false\r\n  // @Prop() interval: number | boolean = false   //在一個自動循環的輪播中，項目之間所延遲的時間。 如果為 false，輪播不會自動重播。\r\n  @Prop() wrap: boolean = true       //輪播是否應該連續循環，或是會停止。\r\n  carousel: Carousel\r\n  carouselRef: HTMLDivElement\r\n  // videoRefs: Map<IMediaFileData,HTMLStormVideoElement>\r\n  videoRefs: Map<IMediaFileData,HTMLVideoElement>\r\n\r\n  // @Listen('change')\r\n  // listenVideoEnd() {\r\n  //   debugger\r\n  //   this.carousel.next();\r\n  // }\r\n\r\n  componentDidRender() {\r\n    if(!this.dataSet) return\r\n    // if(!this.carouselRef || this.carousel) return\r\n    this.carousel = new Carousel(this.carouselRef, {\r\n      // interval: true,\r\n      wrap: this.wrap,\r\n      ride: 'carousel'\r\n    });\r\n\r\n    // this.carousel = new Carousel(this.carouselRef, {\r\n    //   interval: this.dataSet.playListItems[0].mimeType.startsWith('video/') ? this.interval : true,\r\n    //   wrap: this.wrap,\r\n    //   pause: this.pause\r\n    //   ride: 'carousel'\r\n    // });\r\n\r\n    this.carouselRef.addEventListener('slid.bs.carousel', (ev:any) => {\r\n      this.controlInterval(this.dataSet.playListItems[ev.to])\r\n    })\r\n\r\n    if(this.dataSet && this.dataSet.playListItems?.length > 0){\r\n      this.controlInterval(this.dataSet.playListItems[0])\r\n    }\r\n\r\n    this.videoRefs?.forEach(v => {\r\n      v.addEventListener('ended', () => {\r\n        this.carousel.next();\r\n      })\r\n    })\r\n  }\r\n\r\n  addItem() {\r\n    if(!this.dataSet) return;\r\n    // this.videoRefs = new Map<IMediaFileData,HTMLStormVideoElement>()\r\n    this.videoRefs = new Map<IMediaFileData,HTMLVideoElement>()\r\n    return(\r\n      this.dataSet.playListItems.map( (item, index) => {\r\n          return(\r\n            <div class={index == 0 ? \"carousel-item center active\" : \"carousel-item center\"} data-bs-interval={item.playDuration > 0 ? item.playDuration*1000 : false}>\r\n              {this.addItemElement(item)}\r\n            </div>\r\n          )\r\n      })\r\n    )\r\n  }\r\n\r\n  addItemElement = (item:IMediaFileData):HTMLElement => {\r\n    if(item.mimeType == 'text/html') {\r\n      return <div innerHTML={item.content}></div>\r\n    }else if(item.mimeType.startsWith('image/')) {\r\n      return <img class=\"d-block\" src={item.url} />\r\n    }else if (item.mimeType.startsWith('video/')) {\r\n      return <video ref={el => this.videoRefs.set(item,el)} controls autoplay><source src={item.url} type={item.mimeType}/></video>\r\n      // return <storm-video url={item.url} autoplay={true} reTime={true} ref={el => this.videoRefs.set(item,el)}/>\r\n    }\r\n  }\r\n\r\n  controlInterval = (item:IMediaFileData) => {\r\n    if(item.mimeType.startsWith('video/')){\r\n      this.carousel.pause()\r\n      this.videoRefs.get(item).currentTime = 0\r\n      this.videoRefs.get(item).play()\r\n    }else{\r\n      this.carousel.cycle()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div id=\"carouselControls\" class={this.fade ? \"carousel slide carousel-fade\" : \"carousel slide\"} ref={el => this.carouselRef = el}>\r\n          <div class=\"carousel-inner\">\r\n            {this.addItem()}\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface IPlayList {\r\n  playListId?: string\r\n  name?: string\r\n  // ownerId: string\r\n  marquee: string\r\n  playListItems: IMediaFileData[]\r\n}\r\n\r\nexport interface IMediaFileData {\r\n  mediaFileId?: string\r\n  name?: string\r\n  description?: string\r\n  url: string\r\n  poster?: string\r\n  playDuration?: number\r\n  mimeType: 'text/html' | 'image/' | 'video/'\r\n  ownerId: string\r\n  fileName: string\r\n  content: string\r\n}\r\n"],"mappings":"qHAAA,MAAMA,EAAmB,0tte,MCUZC,EAAa,M,yBA+DxBC,KAAAC,eAAkBC,IAChB,GAAGA,EAAKC,UAAY,YAAa,CAC/B,OAAOC,EAAA,OAAKC,UAAWH,EAAKI,S,MACxB,GAAGJ,EAAKC,SAASI,WAAW,UAAW,CAC3C,OAAOH,EAAA,OAAKI,MAAM,UAAUC,IAAKP,EAAKQ,K,MAClC,GAAIR,EAAKC,SAASI,WAAW,UAAW,CAC5C,OAAOH,EAAA,SAAOO,IAAKC,GAAMZ,KAAKa,UAAUC,IAAIZ,EAAKU,GAAKG,SAAQ,KAACC,SAAQ,MAACZ,EAAA,UAAQK,IAAKP,EAAKQ,IAAKO,KAAMf,EAAKC,W,GAK9GH,KAAAkB,gBAAmBhB,IACjB,GAAGA,EAAKC,SAASI,WAAW,UAAU,CACpCP,KAAKmB,SAASC,QACdpB,KAAKa,UAAUQ,IAAInB,GAAMoB,YAAc,EACvCtB,KAAKa,UAAUQ,IAAInB,GAAMqB,M,KACtB,CACHvB,KAAKmB,SAASK,O,oCA7EM,M,UAEA,I,CAYxB,kBAAAC,G,QACE,IAAIzB,KAAK0B,QAAS,OAElB1B,KAAKmB,SAAW,IAAIQ,WAAS3B,KAAK4B,YAAa,CAE7CC,KAAM7B,KAAK6B,KACXC,KAAM,aAUR9B,KAAK4B,YAAYG,iBAAiB,oBAAqBC,IACrDhC,KAAKkB,gBAAgBlB,KAAK0B,QAAQO,cAAcD,EAAGE,IAAI,IAGzD,GAAGlC,KAAK0B,WAAWS,EAAAnC,KAAK0B,QAAQO,iBAAa,MAAAE,SAAA,SAAAA,EAAEC,QAAS,EAAE,CACxDpC,KAAKkB,gBAAgBlB,KAAK0B,QAAQO,cAAc,G,EAGlDI,EAAArC,KAAKa,aAAS,MAAAwB,SAAA,SAAAA,EAAEC,SAAQC,IACtBA,EAAER,iBAAiB,SAAS,KAC1B/B,KAAKmB,SAASqB,MAAM,GACpB,G,CAIN,OAAAC,GACE,IAAIzC,KAAK0B,QAAS,OAElB1B,KAAKa,UAAY,IAAI6B,IACrB,OACE1C,KAAK0B,QAAQO,cAAcU,KAAK,CAACzC,EAAM0C,IAEjCxC,EAAA,OAAKI,MAAOoC,GAAS,EAAI,8BAAgC,uBAAsB,mBAAoB1C,EAAK2C,aAAe,EAAI3C,EAAK2C,aAAa,IAAO,OACjJ7C,KAAKC,eAAeC,K,CA4BjC,MAAA4C,GACE,OACE1C,EAAC2C,EAAI,KACH3C,EAAA,OAAK4C,GAAG,mBAAmBxC,MAAOR,KAAKiD,KAAO,+BAAiC,iBAAkBtC,IAAKC,GAAMZ,KAAK4B,YAAchB,GAC7HR,EAAA,OAAKI,MAAM,kBACRR,KAAKyC,Y"}