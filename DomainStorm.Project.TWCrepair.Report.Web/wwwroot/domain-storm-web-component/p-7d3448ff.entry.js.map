{"version":3,"names":["stormPaginationCss","StormPagination","pageNumber","totalPages","paginationSuccessivelySize","paginationPagesBySide","pageChange","pageFrom","pageTo","cachedPaginationItems","lastCalculationKey","setPage","newPageNumber","this","emit","componentWillLoad","SharedStyles","applyShadowRootStylesAsync","host","disconnectedCallback","calculatePageRange","halfSize","Math","floor","max","min","componentWillRender","getPaginationItems","currentKey","paginationItems","i","push","page","title","render","h","Host","key","class","href","onClick","newPage","FnIcon","map","x","index","isActive","isDisabled","active","disabled","undefined","toString","stormTableBodyCss","StormTableBody","table","dataSet","timeStamp","clickRow","updateColumnCheckbox","col","type","checkedCount","getTotalChecked","field","stormCheckbox","querySelector","checked","totalRows","indeterminate","updateRowCheckbox","row","cell","getFieldValue","fieldId","forceUpdate","fieldSelected","updateRowSelection","el","classList","toggle","computeColumnClasses","classes","align","valign","sortable","asc","sortName","sortOrder","desc","renderThead","columns","filter","visible","renderColumn","content","onValueChanged","ev","handleColumnCheckChange","renderHeaderCell","scope","handleColumnClick","description","sortChange","detail","checkAll","uncheckAll","initSelect","totalChecked","computeCellClasses","renderCell","cellClasses","renderCellContent","column","renderRow","rowId","isSelected","visibleColumns","mainRow","isColumnResponsive","detailCol","find","detailClasses","colSpan","expand","visibleColumnCount","renderDetail","responsive","rwdClassReversal","renderRows","groupBy","groupItem","result","forEach","groupByValue","renderBody","length","emptyClasses","clickRowTo","parseClassNames","componentDidRender","isCommandString","value","test","trim","parseCommandString","trimmed","commandRegex","match","exec","command","MemoryCache","store","Map","maxEntries","constructor","get","set","entry","has","size","evictOldestEntry","iterator","keys","firstKey","next","delete","clear","defaultKeyPrefix","setMaxEntries","enforceMaxEntries","excessCount","getMaxEntries","destroy","cacheService","CacheService","async","invokeDotNetMethodAsync","methodName","args","settings","TypeError","cache","regionName","JSON","stringify","useCache","cachedValue","window","counterInterop","invokeMethodAsync","err","console","error","stormTableCellCss","StormTableCell","cellData","cellType","prependText","appendText","__cellValueEditingEvent","clickCell","clickAction","valueChanged","cellWillValueChanged","cellValueChanged","cellDidValueChanged","cellValueChangedOnBlur","valueChangedHandler","eventDetail","id","cellWillValueChangedHandler","sidePagination","cellValueChangedHandler","setFieldValue","cellDidValueChangedHandler","rerender","focusoutHandler","_","debounce","dispatchCustomEvent","renderSerialNumber","pageSize","FnIconSwitch","onToggle","on","detailRow","shadowRoot","renderActionControl","onClickAction","stopPropagation","renderInputControl","onChange","target","renderTextareaControl","option","cols","rows","renderDropdownControl","label","nullable","searchable","selection","renderDropdownTreeControl","dataSets","isConditionGroups","matchingConditionGroup","conditionGroup","isConditions","conditions","evaluateConditions","loading","partialLoad","text","fieldText","dataSource","fieldLabel","fieldChildren","expandLevel","nodeSelectableRule","onTextChanged","onSearchChanged","renderCheckControl","renderCheckboxGroupControl","labelClasses","groupType","isSwitch","isInline","renderCellValue","Array","isArray","item","join","escape","escapeHtml","transform","searchText","appendHighlight","template","cellTemplate","displayValue","innerHTML","replacePlaceholders","resetCellState","Promise","all","resolvePropertyValueAsync","resetControlState","targetObject","propertyName","resolvePropertyValue","parsed","resolved","preventDefault"],"sources":["src/components/storm-pagination/storm-pagination.css?tag=storm-pagination&encapsulation=shadow","src/components/storm-pagination/storm-pagination.tsx","src/components/storm-table/storm-table-body/storm-table-body.scss?tag=storm-table-body","src/components/storm-table/storm-table-body/storm-table-body.tsx","src/utils/command-utils/command-utils.ts","src/utils/cache/memory-cache.ts","src/utils/dotnet-method-invoker/dotnet-method-invoker.ts","src/components/storm-table/storm-table-cell/storm-table-cell.css?tag=storm-table-cell","src/components/storm-table/storm-table-cell/storm-table-cell.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n\r\n:host dl,\r\n:host ol,\r\n:host ul {\r\n  margin-bottom: 0;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, h } from '@stencil/core';\r\nimport { FnIcon } from '../../utils/functional/functional';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\nimport type { PaginationItem } from './interface';\r\n\r\n@Component({\r\n  tag: 'storm-pagination',\r\n  styleUrl: 'storm-pagination.css',\r\n  shadow: true,\r\n})\r\nexport class StormPagination {\r\n  @Element() host: HTMLElement;\r\n  @Prop({ mutable: true }) pageNumber: number = 1;\r\n  @Prop() totalPages: number;\r\n  @Prop() paginationSuccessivelySize: number = 5;\r\n  @Prop() paginationPagesBySide = 1;\r\n\r\n  @Event() pageChange: EventEmitter<number>;\r\n\r\n  private pageFrom: number = -1;\r\n  private pageTo: number = -1;\r\n  private cachedPaginationItems: PaginationItem[] | null = null;\r\n  private lastCalculationKey: string = '';\r\n\r\n  setPage(newPageNumber: number) {\r\n    // 邊界檢查和驗證\r\n    if (newPageNumber < 1 || newPageNumber > this.totalPages || newPageNumber === this.pageNumber) {\r\n      return;\r\n    }\r\n\r\n    this.pageNumber = newPageNumber;\r\n    // 清除快取，因為頁碼已改變\r\n    this.cachedPaginationItems = null;\r\n    this.lastCalculationKey = '';\r\n    this.pageChange.emit(this.pageNumber);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    // 清理快取\r\n    this.cachedPaginationItems = null;\r\n    this.lastCalculationKey = '';\r\n  }\r\n\r\n  private calculatePageRange(): void {\r\n    // 提早返回避免不必要的計算\r\n    if (this.totalPages <= 0) {\r\n      this.pageFrom = 1;\r\n      this.pageTo = 0;\r\n      return;\r\n    }\r\n\r\n    // 邊界檢查和自動修正\r\n    if (this.pageNumber > this.totalPages) {\r\n      this.pageNumber = this.totalPages;\r\n    }\r\n    if (this.pageNumber < 1) {\r\n      this.pageNumber = 1;\r\n    }\r\n\r\n    // 簡化計算邏輯\r\n    if (this.totalPages <= this.paginationSuccessivelySize) {\r\n      this.pageFrom = 1;\r\n      this.pageTo = this.totalPages;\r\n      return;\r\n    }\r\n\r\n    // 計算顯示範圍\r\n    const halfSize = Math.floor(this.paginationSuccessivelySize / 2);\r\n    this.pageFrom = Math.max(1, this.pageNumber - halfSize);\r\n    this.pageTo = Math.min(this.totalPages, this.pageFrom + this.paginationSuccessivelySize - 1);\r\n\r\n    // 調整起始位置以保持固定數量的頁面\r\n    if (this.pageTo - this.pageFrom + 1 < this.paginationSuccessivelySize) {\r\n      this.pageFrom = Math.max(1, this.pageTo - this.paginationSuccessivelySize + 1);\r\n    }\r\n  }\r\n\r\n  componentWillRender() {\r\n    this.calculatePageRange();\r\n  }\r\n\r\n  private getPaginationItems(): PaginationItem[] {\r\n    // 使用快取避免重複計算\r\n    const currentKey = `${this.pageNumber}-${this.totalPages}-${this.paginationSuccessivelySize}-${this.paginationPagesBySide}`;\r\n    if (this.lastCalculationKey === currentKey && this.cachedPaginationItems) {\r\n      return this.cachedPaginationItems;\r\n    }\r\n\r\n    const paginationItems: PaginationItem[] = [];\r\n\r\n    // 左側頁面\r\n    if (this.pageFrom > 1) {\r\n      let max = this.paginationPagesBySide;\r\n      if (max >= this.pageFrom) max = this.pageFrom - 1;\r\n\r\n      for (let i = 1; i <= max; i++) {\r\n        paginationItems.push({ page: i });\r\n      }\r\n\r\n      if (this.pageFrom - 1 === max + 1) {\r\n        paginationItems.push({ page: this.pageFrom - 1 });\r\n      } else if (this.pageFrom - 1 > max) {\r\n        paginationItems.push({ title: '...' });\r\n      }\r\n    }\r\n\r\n    // 中間頁面\r\n    for (let i = this.pageFrom; i <= this.pageTo; i++) {\r\n      paginationItems.push({ page: i });\r\n    }\r\n\r\n    // 右側頁面\r\n    if (this.totalPages > this.pageTo) {\r\n      let min = this.totalPages - (this.paginationPagesBySide - 1);\r\n      if (this.pageTo >= min) min = this.pageTo + 1;\r\n\r\n      if (this.pageTo + 1 === min - 1) {\r\n        paginationItems.push({ page: this.pageTo + 1 });\r\n      } else {\r\n        paginationItems.push({ title: '...' });\r\n      }\r\n\r\n      for (let i = min; i <= this.totalPages; i++) {\r\n        paginationItems.push({ page: i });\r\n      }\r\n    }\r\n\r\n    // 快取結果\r\n    this.cachedPaginationItems = paginationItems;\r\n    this.lastCalculationKey = currentKey;\r\n\r\n    return paginationItems;\r\n  }\r\n\r\n  render() {\r\n    const paginationItems = this.getPaginationItems();\r\n\r\n    return (\r\n      <Host>\r\n        <ul class=\"pagination pagination-primary\">\r\n          <li class=\"page-item\">\r\n            <a\r\n              class=\"page-link\"\r\n              href=\"javascript:;\"\r\n              aria-label=\"上一頁\"\r\n              onClick={() => {\r\n                const newPage = this.pageNumber === 1 ? this.totalPages : this.pageNumber - 1;\r\n                this.setPage(newPage);\r\n              }}\r\n            >\r\n              <span aria-hidden=\"true\">\r\n                <FnIcon>keyboard_arrow_left</FnIcon>\r\n              </span>\r\n            </a>\r\n          </li>\r\n          {paginationItems.map((x, index) => {\r\n            const isActive = x.page === this.pageNumber;\r\n            const isDisabled = x.page == null;\r\n\r\n            return (\r\n              <li\r\n                key={x.page ? `page-${x.page}` : `ellipsis-${index}`}\r\n                class={{ 'page-item': true, active: isActive, disabled: isDisabled }}\r\n                onClick={() => {\r\n                  if (x.page && !isActive) this.setPage(x.page);\r\n                }}\r\n              >\r\n                <a class=\"page-link\" href=\"javascript:;\" aria-current={isActive ? 'page' : undefined} aria-label={x.page ? `第 ${x.page} 頁` : undefined}>\r\n                  {x.title || x.page?.toString()}\r\n                </a>\r\n              </li>\r\n            );\r\n          })}\r\n          <li class=\"page-item\">\r\n            <a\r\n              class=\"page-link\"\r\n              href=\"javascript:;\"\r\n              aria-label=\"下一頁\"\r\n              onClick={() => {\r\n                const newPage = this.pageNumber === this.totalPages ? 1 : this.pageNumber + 1;\r\n                this.setPage(newPage);\r\n              }}\r\n            >\r\n              <span aria-hidden=\"true\">\r\n                <FnIcon>keyboard_arrow_right</FnIcon>\r\n              </span>\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n","@use \"sass:list\";\r\n\r\n:host {\r\n  display: block;\r\n}\r\n\r\n:host .group-item {\r\n  > th {\r\n    cursor: auto;\r\n\r\n    > div {\r\n      line-height: 1;\r\n      margin: 0.25rem;\r\n    }\r\n  }\r\n}\r\n\r\n:host span.detail-title {\r\n  display: inline-block;\r\n  min-width: 75px;\r\n  font-weight: bold;\r\n}\r\n\r\n:host .d-table-none {\r\n  display: none !important;\r\n}\r\n\r\n:host .d-table-cell {\r\n  display: table-cell !important;\r\n}\r\n\r\n// 響應式類別設定\r\n$sizes: 4xs, 3xs, xxs, xs, sm, md, lg, xl, xxl, 3xl, 4xl;\r\n\r\n@each $innerSize in $sizes {\r\n  $none-selectors: ();\r\n  $cell-selectors: ();\r\n\r\n  @each $size in $sizes {\r\n    @if list.index($sizes, $size) >= list.index($sizes, $innerSize) {\r\n      $none-selectors: list.append($none-selectors, \":host .storm-table-#{$size} .d-table-#{$innerSize}-none\", comma);\r\n    }\r\n\r\n    @if list.index($sizes, $size) >= list.index($sizes, $innerSize) {\r\n      $cell-selectors: list.append($cell-selectors, \":host .storm-table-#{$size} .d-table-#{$innerSize}-cell\", comma);\r\n    }\r\n  }\r\n\r\n  #{$none-selectors} {\r\n    display: none !important;\r\n  }\r\n\r\n  #{$cell-selectors} {\r\n    display: table-cell !important;\r\n  }\r\n}\r\n","import { Component, Element, Event, EventEmitter, Host, Method, Prop, forceUpdate, h } from '@stencil/core';\r\nimport { getFieldValue, parseClassNames } from '../../../utils/utils';\r\nimport type { TableColumnInterface } from '../interface';\r\nimport { StormTable } from '../storm-table';\r\n\r\n@Component({\r\n  tag: 'storm-table-body',\r\n  styleUrl: 'storm-table-body.scss',\r\n  shadow: false,\r\n})\r\nexport class StormTableBody {\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() table: StormTable;\r\n  @Prop() dataSet: object[];\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n\r\n  @Event() clickRow: EventEmitter<string>;\r\n\r\n  @Method()\r\n  async updateColumnCheckbox(col: TableColumnInterface) {\r\n    if (!this.dataSet || col.type !== 'checkbox') return;\r\n    const checkedCount = this.getTotalChecked(col.field);\r\n    const stormCheckbox = this.host.querySelector('th[data-field=\"' + col.field + '\"] storm-checkbox') as HTMLStormCheckboxElement;\r\n\r\n    stormCheckbox.checked = checkedCount === this.table.totalRows;\r\n    stormCheckbox.indeterminate = checkedCount > 0 && checkedCount < this.table.totalRows;\r\n  }\r\n\r\n  @Method()\r\n  async updateRowCheckbox(row: object, col: TableColumnInterface) {\r\n    const cell = this.host.querySelector(\r\n      'tr[data-id=\"' + getFieldValue(row, this.table.fieldId) + '\"] storm-table-cell[data-field=\"' + col.field + '\"]',\r\n    ) as HTMLStormTableCellElement;\r\n    if (cell) {\r\n      forceUpdate(cell);\r\n    }\r\n    if (col.field === this.table.fieldSelected) {\r\n      await this.updateRowSelection(row);\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async updateRowSelection(row: object) {\r\n    const el = this.host.querySelector('tr[data-id=\"' + getFieldValue(row, this.table.fieldId) + '\"]') as HTMLInputElement;\r\n    if (el) el.classList.toggle('table-primary', getFieldValue(row, this.table.fieldSelected) as boolean);\r\n  }\r\n\r\n  private computeColumnClasses(col: TableColumnInterface, classes?: Record<string, boolean>): Record<string, boolean> {\r\n    return {\r\n      'text-center': col.align === 'center',\r\n      'text-start': !col.align || col.align === 'left',\r\n      'text-end': col.align === 'right',\r\n      'align-middle': !col.valign || col.valign === 'middle',\r\n      'align-top': col.valign === 'top',\r\n      'align-bottom': col.valign === 'bottom',\r\n      'font-weight-bolder': true,\r\n      'text-truncate': true,\r\n      'table-sorter': col.sortable,\r\n      asc: this.table.sortName === col.field && this.table.sortOrder !== 'desc',\r\n      desc: this.table.sortName === col.field && this.table.sortOrder === 'desc',\r\n      ...(classes || {}),\r\n      ...(col.classes || {}),\r\n    };\r\n  }\r\n\r\n  renderThead() {\r\n    if (!this.table.columns) return;\r\n    return (\r\n      <thead>\r\n        <tr>\r\n          {this.table.columns\r\n            .filter(col => col.visible !== false)\r\n            .map(col => {\r\n              return this.renderColumn(col);\r\n            })}\r\n        </tr>\r\n      </thead>\r\n    );\r\n  }\r\n\r\n  renderColumn(col: TableColumnInterface) {\r\n    let content: any = col.title;\r\n    const classes: any = {\r\n      'thead-xxs': col.type === 'detail' || col.type === 'serialNumber' || col.type === 'radio' || col.type === 'checkbox',\r\n      'detail-toggle': col.type === 'detail',\r\n    };\r\n\r\n    if (content == null && col.type === 'checkbox') {\r\n      const checkedCount = this.getTotalChecked(col.field);\r\n      content = (\r\n        <storm-checkbox\r\n          type=\"checkbox\"\r\n          indeterminate={checkedCount > 0 && checkedCount < this.table.totalRows}\r\n          checked={checkedCount === this.table.totalRows}\r\n          onValueChanged={ev => this.handleColumnCheckChange(ev, col)}\r\n        ></storm-checkbox>\r\n      );\r\n    }\r\n\r\n    return this.renderHeaderCell(content, col, classes);\r\n  }\r\n\r\n  renderHeaderCell(content: any, col: TableColumnInterface, classes: Record<string, boolean> = {}) {\r\n    return (\r\n      <th data-field={col.field} scope=\"col\" class={this.computeColumnClasses(col, classes)} onClick={() => this.handleColumnClick(col)}>\r\n        <div class=\"cell\">{content}</div>\r\n        {col.description && <div class=\"table-description\">{col.description}</div>}\r\n      </th>\r\n    );\r\n  }\r\n\r\n  handleColumnClick(col: TableColumnInterface) {\r\n    if (!col.sortable) return;\r\n    if (col.field == this.table.sortName) {\r\n      if (this.table.sortOrder == 'desc') this.table.sortChange.emit({ sortName: undefined, sortOrder: undefined });\r\n      else this.table.sortChange.emit({ sortName: this.table.sortName, sortOrder: 'desc' });\r\n    } else this.table.sortChange.emit({ sortName: col.field, sortOrder: 'asc' });\r\n  }\r\n\r\n  async handleColumnCheckChange(ev: CustomEvent<boolean>, col: TableColumnInterface) {\r\n    const checked = ev.detail;\r\n    if (checked) await this.table.checkAll(col.field);\r\n    else await this.table.uncheckAll(col.field);\r\n  }\r\n\r\n  async initSelect() {\r\n    if (!this.dataSet || !this.table.columns) return;\r\n\r\n    for (const row of this.dataSet) {\r\n      await this.updateRowSelection(row);\r\n    }\r\n  }\r\n\r\n  getTotalChecked(field: string | number): number {\r\n    if (!this.table.totalChecked) return 0;\r\n    return this.table.totalChecked[field];\r\n  }\r\n\r\n  private computeCellClasses(col: TableColumnInterface, classes?: Record<string, boolean>): Record<string, boolean> {\r\n    return {\r\n      'text-center': col.align === 'center',\r\n      'text-start': !col.align || col.align === 'left',\r\n      'text-end': col.align === 'right',\r\n      'align-middle': !col.valign || col.valign === 'middle',\r\n      'align-top': col.valign === 'top',\r\n      'align-bottom': col.valign === 'bottom',\r\n      ...(classes || {}),\r\n      ...(col.classes || {}),\r\n    };\r\n  }\r\n\r\n  renderCell(row: object, index: number, col: TableColumnInterface) {\r\n    const cellClasses = this.computeCellClasses(col, { 'text-xs': col.type === 'serialNumber', 'detail-toggle': col.type === 'detail' });\r\n    return (\r\n      <td data-field={col.field} class={cellClasses}>\r\n        {this.renderCellContent(row, index, col)}\r\n      </td>\r\n    );\r\n  }\r\n\r\n  renderCellContent(row: object, index: number, col: TableColumnInterface) {\r\n    return <storm-table-cell table={this.table} row={row} index={index} column={col} time-stamp={this.timeStamp} data-field={col.field}></storm-table-cell>;\r\n  }\r\n\r\n  private renderRow(row: object, index: number) {\r\n    const rowId = getFieldValue(row, this.table.fieldId) as string;\r\n    const isSelected = getFieldValue(row, this.table.fieldSelected) as boolean;\r\n    const visibleColumns = this.table.columns.filter(col => col.visible !== false);\r\n\r\n    const mainRow = (\r\n      <tr data-id={rowId} class={{ 'table-primary': isSelected }} onClick={() => this.clickRow.emit(rowId)}>\r\n        {visibleColumns.map(col => this.renderCell(row, index, col))}\r\n      </tr>\r\n    );\r\n\r\n    if (this.table.isColumnResponsive) {\r\n      const detailCol = this.table.columns.find(col => col.type === 'detail');\r\n      const detailClasses = detailCol?.classes ? { ...detailCol.classes, 'row-detail': true, 'd-none': true } : { 'row-detail': true, 'd-none': true };\r\n\r\n      return [\r\n        mainRow,\r\n        <tr class={detailClasses} data-index={index}>\r\n          <td class=\"full-cell\" colSpan={this.table.expand.visibleColumnCount}>\r\n            <ul class=\"list-group list-group-flush\">{this.renderDetail(row, index)}</ul>\r\n          </td>\r\n        </tr>,\r\n      ];\r\n    }\r\n\r\n    return mainRow;\r\n  }\r\n\r\n  renderDetail(row: object, index: number) {\r\n    return this.table.columns\r\n      .filter(col => col.responsive === true && col.visible !== false)\r\n      .map(col => (\r\n        <li class={{ 'list-group-item': true, ...(col.rwdClassReversal || {}) }}>\r\n          <span class=\"detail-title\">{col.title}</span>\r\n          <span>{this.renderCellContent(row, index, col)}</span>\r\n        </li>\r\n      ));\r\n  }\r\n\r\n  private renderRows() {\r\n    if (this.table.groupBy) {\r\n      let groupItem: string = '';\r\n      const result: any[] = [];\r\n\r\n      this.dataSet.forEach((row, i) => {\r\n        const groupByValue = getFieldValue(row, this.table.groupBy) as string;\r\n\r\n        if (groupByValue !== groupItem) {\r\n          groupItem = groupByValue;\r\n          result.push(\r\n            <tr class=\"group-item table-info\">\r\n              <th class=\"align-middle full-cell\" colSpan={this.table.expand.visibleColumnCount}>\r\n                {groupByValue}\r\n              </th>\r\n            </tr>,\r\n          );\r\n        }\r\n        result.push(this.renderRow(row, i));\r\n      });\r\n      return result;\r\n    }\r\n\r\n    return this.dataSet.map((row, index) => this.renderRow(row, index));\r\n  }\r\n\r\n  private renderBody() {\r\n    if (!this.dataSet?.length) {\r\n      const emptyClasses = {\r\n        'align-middle': true,\r\n        'text-center': true,\r\n        'full-cell': true,\r\n        ...(this.table.classes?.['table-sm'] ? { 'height-100': true } : { 'height-300': true }),\r\n      };\r\n\r\n      return (\r\n        <tbody>\r\n          <tr>\r\n            <td class={emptyClasses} colSpan={this.table.expand.visibleColumnCount}>\r\n              <p class=\"p-4 h6\">沒有找到符合的結果</p>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      );\r\n    }\r\n    return <tbody>{this.renderRows()}</tbody>;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <table class={{ ...{ table: true, 'mb-0': true, 'table-hover': !!this.table.clickRowTo }, ...parseClassNames(this.table.classes) }}>\r\n          {this.renderThead()}\r\n          {this.renderBody()}\r\n        </table>\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  async componentDidRender() {\r\n    await this.initSelect();\r\n  }\r\n}\r\n","import type { ParsedCommand } from './interface';\r\n\r\n/**\r\n * 判斷輸入是否為有效命令格式，例如 @Invoke:DotNet('GetUser')\r\n * @param value 任意輸入\r\n * @returns 是否符合命令格式\r\n */\r\nexport function isCommandString(value: unknown): value is string {\r\n    if (typeof value !== 'string') return false;\r\n    // 檢查型別與正則，確保格式正確\r\n    // 僅允許單層括號內容，且括號內可為任意字元\r\n    return (\r\n        typeof value === 'string' &&\r\n        /^@[a-zA-Z0-9:-]+\\('.*'\\)$/.test(value.trim())\r\n    );\r\n}\r\n\r\n/**\r\n * 解析命令字串，回傳 ParsedCommand 或 null\r\n * 格式範例：@Invoke:DotNet('GetUser')\r\n * @param value 命令字串\r\n * @returns 解析後的命令物件，若格式不符則回傳 null\r\n */\r\nexport function parseCommandString(value: string): ParsedCommand | null {\r\n    const trimmed = value.trim();\r\n    // 強化正則表達式，避免括號內為空或出現多行情況\r\n    const commandRegex = /^@([a-zA-Z0-9:-]+)\\('([^']*)'\\)$/;\r\n\r\n    const match = commandRegex.exec(trimmed);\r\n    if (!match) return null;\r\n\r\n    return {\r\n        command: match[1],\r\n        value: match[2]\r\n    };\r\n}\r\n\r\n/**\r\n * 檢查解析後命令是否符合指定 path\r\n * @param parsed 解析後的命令物件\r\n * @param expectedPath 預期的 path 字串，例如 \"Invoke:DotNet\"\r\n * @returns 是否符合預期 path\r\n */\r\nexport function isPath(parsed: ParsedCommand | null, expectedPath: string): boolean {\r\n    return !!parsed && parsed.command === expectedPath;\r\n}","import type { CacheEntry, CacheProvider } from './interface';\r\n\r\nexport class MemoryCache implements CacheProvider {\r\n    private readonly store = new Map<string, CacheEntry>();\r\n    private maxEntries: number;\r\n\r\n    constructor(maxEntries = 1000) {\r\n        this.maxEntries = maxEntries;\r\n    }\r\n\r\n    async get(key: string): Promise<CacheEntry | null> {\r\n        return this.store.get(key) || null;\r\n    }\r\n\r\n    async set(key: string, entry: CacheEntry): Promise<void> {\r\n        // If updating existing key, no need to check size\r\n        if (!this.store.has(key) && this.store.size >= this.maxEntries) {\r\n            this.evictOldestEntry();\r\n        }\r\n        \r\n        this.store.set(key, entry);\r\n    }\r\n\r\n    private evictOldestEntry(): void {\r\n        const iterator = this.store.keys();\r\n        const firstKey = iterator.next().value;\r\n        if (firstKey !== undefined) {\r\n            this.store.delete(firstKey);\r\n        }\r\n    }\r\n\r\n    async delete(key: string): Promise<void> {\r\n        this.store.delete(key);\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        this.store.clear();\r\n    }\r\n\r\n    get defaultKeyPrefix(): string {\r\n        return 'mem';\r\n    }\r\n\r\n    async size(): Promise<number> {\r\n        return this.store.size;\r\n    }\r\n\r\n    setMaxEntries(maxEntries: number): void {\r\n        this.maxEntries = maxEntries;\r\n        this.enforceMaxEntries();\r\n    }\r\n\r\n    private enforceMaxEntries(): void {\r\n        const excessCount = this.store.size - this.maxEntries;\r\n        if (excessCount <= 0) return;\r\n        \r\n        const iterator = this.store.keys();\r\n        for (let i = 0; i < excessCount; i++) {\r\n            const key = iterator.next().value;\r\n            if (key === undefined) break;\r\n            this.store.delete(key);\r\n        }\r\n    }\r\n\r\n    getMaxEntries(): number {\r\n        return this.maxEntries;\r\n    }\r\n\r\n    async destroy(): Promise<void> {\r\n        this.store.clear();\r\n    }\r\n}","import { CacheService } from '../cache/cache-service';\r\nimport { MemoryCache } from '../cache/memory-cache';\r\n\r\ndeclare global {\r\n    interface Window {\r\n        counterInterop: {\r\n            invokeMethodAsync: (method: string, ...args: any[]) => Promise<any>;\r\n        };\r\n    }\r\n}\r\n\r\nconst cacheService = new CacheService(new MemoryCache());\r\n\r\n/**\r\n * 呼叫 .NET Interop 方法，支援快取與錯誤保護\r\n * @param value    字串，格式可為 \"Invoke:DotNet('methodName')\" 或僅 methodName\r\n * @param args     傳給 .NET 方法的參數陣列\r\n * @param settings 可選設定：\r\n *                 - cache: 是否啟用快取，預設 true\r\n *                 - regionName: 快取區域名稱，預設 'dotnetInterop'\r\n * @return Promise<any> 回傳 .NET 方法的結果\r\n */\r\nexport async function invokeDotNetMethodAsync(\r\n    methodName: string,\r\n    args: any[] = [],\r\n    settings: { cache?: boolean, regionName?: string } = {}\r\n): Promise<any> {\r\n    if (typeof methodName !== 'string') {\r\n        throw new TypeError('methodName 必須是字串');\r\n    }\r\n\r\n    settings = { cache: true, regionName: 'dotnetInterop', ...settings };\r\n\r\n    // 組成 key：methodName + args\r\n    const key = `${methodName}:${JSON.stringify(args)}`;\r\n    const useCache = settings.cache ?? true;\r\n\r\n    if (useCache) {\r\n        const cachedValue = await cacheService.get<any>(key);\r\n        if (cachedValue !== null) {\r\n            return cachedValue;\r\n        }\r\n    }\r\n\r\n    try {\r\n        const result = await window.counterInterop?.invokeMethodAsync(\r\n            methodName,\r\n            ...args\r\n        );\r\n\r\n        if (useCache) {\r\n            await cacheService.set(key, result);\r\n        }\r\n        return result;\r\n    } catch (err) {\r\n        console.error(`[Interop] 無法呼叫 '${methodName}'：`, err);\r\n        return 'unknown';\r\n    }\r\n}\r\n\r\n/**\r\n * 清除 .NET Interop 方法的快取\r\n * @param regionName (可選) 指定要清除的 region，預設為 'dotnetInterop'\r\n * @return Promise<void>\r\n */\r\nexport async function clearDotNetMethodCache(): Promise<void> {\r\n    await cacheService.clear();\r\n}",":host {\r\n  display: block;\r\n}\r\n\r\n.input-group.input-group-static .form-control {\r\n  background-color: white;\r\n  line-height: 1.25rem;\r\n  padding: .25rem;\r\n}\r\n\r\n.detail-button {\r\n  cursor: pointer;\r\n}","import { Component, Element, Event, EventEmitter, forceUpdate, h, Host, Listen, Method, Prop, State } from '@stencil/core';\r\nimport { isCommandString, parseCommandString } from '../../../utils/command-utils/command-utils';\r\nimport { invokeDotNetMethodAsync } from '../../../utils/dotnet-method-invoker/dotnet-method-invoker';\r\nimport { FnIconSwitch } from '../../../utils/functional/functional';\r\nimport {\r\n  appendHighlight,\r\n  debounce,\r\n  escapeHtml,\r\n  evaluateConditions,\r\n  getFieldValue,\r\n  isConditionGroups,\r\n  isConditions,\r\n  replacePlaceholders,\r\n  resolvePropertyValue,\r\n  setFieldValue,\r\n} from '../../../utils/utils';\r\nimport type { ICheckboxItem } from '../../storm-checkbox-group/storm-checkbox-group';\r\nimport type { CheckboxGroupInterface, TableColumnInterface } from '../interface';\r\nimport { StormTable } from '../storm-table';\r\nimport type { ClickActionDetail } from '../storm-table-toolbar/interface';\r\nimport type {\r\n  CellValue,\r\n  CheckboxGroupControlOptionInterface,\r\n  CheckControlOptionInterface,\r\n  DropdownControlOptionInterface,\r\n  DropdownTreeControlOptionInterface,\r\n  TextAreaControlOptionInterface,\r\n} from './interface';\r\n\r\n@Component({\r\n  tag: 'storm-table-cell',\r\n  styleUrl: 'storm-table-cell.css',\r\n  shadow: false,\r\n})\r\nexport class StormTableCell {\r\n  @State() private cellData: any;\r\n  @State() private cellType: string = 'text';\r\n  @State() private isDisabled: boolean = false;\r\n  @State() private prependText?: string;\r\n  @State() private appendText?: string;\r\n  private __cellValueEditingEvent?: CellValue;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() table: StormTable;\r\n  @Prop() row: object;\r\n  @Prop() index: number;\r\n  @Prop() column: TableColumnInterface;\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n\r\n  @Event() clickCell: EventEmitter<{ id: string; field: string | number }>;\r\n  @Event() clickAction: EventEmitter<ClickActionDetail>;\r\n  @Event() valueChanged: EventEmitter<any>;\r\n\r\n  @Event() cellWillValueChanged: EventEmitter<CellValue>;\r\n  @Event() cellValueChanged: EventEmitter<CellValue>;\r\n  @Event() cellDidValueChanged: EventEmitter<CellValue>;\r\n  @Event() cellValueChangedOnBlur: EventEmitter<CellValue>;\r\n\r\n  @Listen('valueChanged')\r\n  valueChangedHandler(ev: CustomEvent<any>) {\r\n    if (!this.column?.field) return;\r\n\r\n    const eventDetail = {\r\n      id: getFieldValue(this.row, this.table.fieldId) as string,\r\n      field: this.column.field,\r\n      value: ev.detail,\r\n    };\r\n    this.cellWillValueChanged.emit(eventDetail);\r\n  }\r\n\r\n  @Listen('cellWillValueChanged')\r\n  cellWillValueChangedHandler(ev: CustomEvent<CellValue>) {\r\n    if (this.table.sidePagination === 'stencil') {\r\n      this.cellValueChanged.emit(ev.detail);\r\n    }\r\n  }\r\n\r\n  @Listen('cellValueChanged')\r\n  cellValueChangedHandler(ev: CustomEvent<CellValue>) {\r\n    setFieldValue(this.row, this.column.field, ev.detail.value);\r\n    if (this.table.sidePagination === 'stencil') {\r\n      this.cellDidValueChanged.emit(ev.detail);\r\n    }\r\n  }\r\n\r\n  @Listen('cellDidValueChanged')\r\n  cellDidValueChangedHandler(ev: CustomEvent<CellValue>) {\r\n    this.__cellValueEditingEvent = ev.detail;\r\n    this.rerender();\r\n  }\r\n\r\n  @Listen('focusout')\r\n  focusoutHandler(_: FocusEvent) {\r\n    if (this.__cellValueEditingEvent) {\r\n      this.cellValueChangedOnBlur.emit(this.__cellValueEditingEvent);\r\n      this.__cellValueEditingEvent = undefined;\r\n    }\r\n  }\r\n\r\n  private readonly rerender = debounce(() => {\r\n    forceUpdate(this);\r\n  }, 100);\r\n\r\n  @Method()\r\n  async dispatchCustomEvent(type: string, detail?: object): Promise<void> {\r\n    this[type].emit(detail);\r\n  }\r\n\r\n  renderSerialNumber() {\r\n    return (this.table.pageNumber - 1) * this.table.pageSize + this.index + 1;\r\n  }\r\n\r\n  renderDetail() {\r\n    return (\r\n      <FnIconSwitch\r\n        onToggle={on => {\r\n          const detailRow = this.table.host.shadowRoot.querySelector('.row-detail[data-index=\"' + this.index + '\"]');\r\n          if (detailRow) {\r\n            detailRow.classList.toggle('d-none', !on);\r\n          }\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  renderActionControl() {\r\n    return (\r\n      <storm-table-toolbar\r\n        table={this.table}\r\n        column={this.column}\r\n        row={this.row}\r\n        timeStamp={this.timeStamp}\r\n        onClickAction={ev => {\r\n          ev.stopPropagation();\r\n          this.clickAction.emit(ev.detail);\r\n        }}\r\n      ></storm-table-toolbar>\r\n    );\r\n  }\r\n\r\n  renderInputControl() {\r\n    return (\r\n      <div class=\"input-group input-group-static\">\r\n        <input\r\n          class=\"form-control\"\r\n          type=\"text\"\r\n          aria-label={this.column.title}\r\n          disabled={this.isDisabled}\r\n          value={getFieldValue(this.row, this.column.field) as string | number | string[]}\r\n          onClick={ev => ev.stopPropagation()}\r\n          onChange={ev => {\r\n            ev.stopPropagation();\r\n            this.valueChanged.emit((ev.target as HTMLInputElement).value);\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderTextareaControl() {\r\n    const option = this.cellData as TextAreaControlOptionInterface;\r\n    return (\r\n      <div class=\"input-group input-group-static\">\r\n        <textarea\r\n          class=\"form-control\"\r\n          disabled={this.isDisabled}\r\n          cols={option.cols}\r\n          rows={option.rows}\r\n          title={this.column.title}\r\n          value={getFieldValue(this.row, this.column.field) as string}\r\n          onClick={ev => ev.stopPropagation()}\r\n          onChange={ev => {\r\n            ev.stopPropagation();\r\n            this.valueChanged.emit((ev.target as HTMLInputElement).value);\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderDropdownControl() {\r\n    const option = this.cellData as DropdownControlOptionInterface;\r\n    const dataSet = option.dataSet;\r\n    return (\r\n      <storm-dropdown\r\n        disabled={this.isDisabled}\r\n        label={option.label}\r\n        value={getFieldValue(this.row, this.column.field) as string | string[]}\r\n        dataSet={dataSet}\r\n        nullable={option.nullable ?? false}\r\n        searchable={option.searchable ?? true}\r\n        selection={'single'}\r\n        timeStamp={this.timeStamp}\r\n        type={'select'}\r\n        onValueChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.valueChanged.emit(ev.detail);\r\n        }}\r\n      ></storm-dropdown>\r\n    );\r\n  }\r\n\r\n  renderDropdownTreeControl() {\r\n    const option = this.cellData as DropdownTreeControlOptionInterface;\r\n    let dataSet = option.dataSet;\r\n\r\n    if (option.dataSets && isConditionGroups(option.dataSets)) {\r\n      const matchingConditionGroup = option.dataSets.find(conditionGroup => isConditions(conditionGroup.conditions) && evaluateConditions(conditionGroup.conditions, this.row));\r\n      if (matchingConditionGroup) {\r\n        dataSet = matchingConditionGroup.value;\r\n      }\r\n    }\r\n    return (\r\n      <storm-dropdown-tree\r\n        disabled={this.isDisabled}\r\n        loading={option.loading}\r\n        partialLoad={option.partialLoad}\r\n        label={option.label}\r\n        value={getFieldValue(this.row, this.column.field) as string | string[]}\r\n        text={option.fieldText ? (getFieldValue(this.row, option.fieldText) as string) : null}\r\n        dataSet={dataSet}\r\n        dataSource={option.dataSource}\r\n        fieldId={option.fieldId ?? 'id'}\r\n        fieldLabel={option.fieldLabel ?? 'label'}\r\n        fieldChildren={option.fieldChildren ?? 'children'}\r\n        expandLevel={option.expandLevel ?? 2}\r\n        nodeSelectableRule={option.nodeSelectableRule}\r\n        nullable={option.nullable ?? false}\r\n        searchable={option.searchable ?? true}\r\n        selection={'single'}\r\n        timeStamp={this.timeStamp}\r\n        onValueChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.valueChanged.emit(ev.detail);\r\n        }}\r\n        onTextChanged={ev => {\r\n          ev.stopPropagation();\r\n          if (option.fieldText) setFieldValue(this.row, option.fieldText, ev.detail);\r\n        }}\r\n        onSearchChanged={ev => {\r\n          ev.stopPropagation();\r\n        }}\r\n      ></storm-dropdown-tree>\r\n    );\r\n  }\r\n\r\n  renderCheckControl() {\r\n    return (\r\n      <storm-checkbox\r\n        type={this.cellType === 'checkbox' ? 'checkbox' : 'radio'}\r\n        disabled={this.isDisabled}\r\n        checked={getFieldValue(this.row, this.column.field) as boolean}\r\n      ></storm-checkbox>\r\n    );\r\n  }\r\n\r\n  renderCheckboxGroupControl() {\r\n    const option = this.cellData as CheckboxGroupControlOptionInterface;\r\n    const value = getFieldValue(this.row, this.column.field) as any;\r\n    const dataSet = (option.dataSet as CheckboxGroupInterface[])\r\n      .filter(x => {\r\n        if (x.visible === undefined) return true;\r\n        return typeof x.visible === 'function' ? x.visible(this.row) : x.visible;\r\n      })\r\n      .map(\r\n        x =>\r\n          ({\r\n            id: x.id,\r\n            label: x.label,\r\n            labelClasses: x.labelClasses,\r\n            checked: x.checked,\r\n            disabled: x.disabled,\r\n          } as ICheckboxItem),\r\n      );\r\n    return (\r\n      <div class=\"input-group input-group-static\">\r\n        <storm-checkbox-group\r\n          disabled={this.isDisabled}\r\n          type={option.groupType}\r\n          value={value}\r\n          dataSet={dataSet}\r\n          isSwitch={option.isSwitch ?? false}\r\n          isInline={option.isInline ?? true}\r\n          onValueChanged={ev => {\r\n            ev.stopPropagation();\r\n            this.valueChanged.emit(ev.detail);\r\n          }}\r\n        ></storm-checkbox-group>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderCellContent() {\r\n    switch (this.cellType) {\r\n      case 'action':\r\n        return this.renderActionControl();\r\n      case 'input':\r\n        return this.renderInputControl();\r\n      case 'checkbox':\r\n      case 'radio':\r\n        return this.renderCheckControl();\r\n      case 'textarea':\r\n        return this.renderTextareaControl();\r\n      case 'dropdown':\r\n        return this.renderDropdownControl();\r\n      case 'dropdownTree':\r\n        return this.renderDropdownTreeControl();\r\n      case 'checkboxGroup':\r\n        return this.renderCheckboxGroupControl();\r\n      case 'serialNumber':\r\n        return this.renderSerialNumber();\r\n      case 'detail':\r\n        return this.renderDetail();\r\n      case 'text':\r\n        return this.renderCellValue();\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  renderCell() {\r\n    if (!this.prependText && !this.appendText) {\r\n      return this.renderCellContent();\r\n    } else {\r\n      return (\r\n        <div class=\"d-flex flex-row gap-1 align-items-center\">\r\n          {this.prependText && <span>{this.prependText}</span>}\r\n          {this.renderCellContent()}\r\n          {this.appendText && <span>{this.appendText}</span>}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderCellValue() {\r\n    let content = getFieldValue(this.row, this.column.field) as any;\r\n\r\n    if (typeof this.column.render === 'function') {\r\n      content = this.column.render(content, this.row, this.index);\r\n    } else {\r\n      if (Array.isArray(content)) {\r\n        content = content.filter(item => item != null && item !== '').join('、');\r\n      }\r\n\r\n      if (this.table.escape && typeof content !== 'boolean' && content != null) {\r\n        content = escapeHtml(content);\r\n      }\r\n\r\n      if (content != null && this.column.transform && this.column.transform[content.toString()]) {\r\n        content = this.column.transform[content];\r\n      } else if (content && this.table.searchable && this.table.searchText) {\r\n        content = appendHighlight(content, this.table.searchText);\r\n      }\r\n    }\r\n\r\n    const template = this.column.cellTemplate || this.table.cellTemplate;\r\n    const displayValue = content != null && content.toString().trim().length > 0 ? content : '-';\r\n    return (\r\n      <span\r\n        innerHTML={replacePlaceholders(template, {\r\n          value: displayValue,\r\n          row: this.row,\r\n          index: this.index,\r\n        })}\r\n      ></span>\r\n    );\r\n  }\r\n\r\n  async componentWillRender() {\r\n    if (!this.column) {\r\n      this.resetCellState();\r\n      return;\r\n    }\r\n\r\n    const [cellType, cellData] = await Promise.all([this.resolvePropertyValueAsync<string>(this.column, 'type'), this.resolvePropertyValueAsync(this.column, 'data')]);\r\n\r\n    this.cellType = cellType || 'text';\r\n    this.cellData = cellData;\r\n\r\n    if (cellData && typeof cellData === 'object' && !Array.isArray(cellData)) {\r\n      const [disabled, prependText, appendText] = await Promise.all([\r\n        this.resolvePropertyValueAsync<boolean>(cellData, 'disabled'),\r\n        this.resolvePropertyValueAsync<string>(cellData, 'prependText'),\r\n        this.resolvePropertyValueAsync<string>(cellData, 'appendText'),\r\n      ]);\r\n\r\n      this.isDisabled = disabled ?? false;\r\n      this.prependText = prependText;\r\n      this.appendText = appendText;\r\n\r\n      if (this.isDisabled && (cellType === 'input' || cellType === 'textarea')) {\r\n        this.cellType = 'text';\r\n      }\r\n    } else {\r\n      this.resetControlState();\r\n    }\r\n  }\r\n\r\n  private resetCellState(): void {\r\n    this.cellType = 'text';\r\n    this.cellData = undefined;\r\n    this.resetControlState();\r\n  }\r\n\r\n  private resetControlState(): void {\r\n    this.isDisabled = false;\r\n    this.prependText = undefined;\r\n    this.appendText = undefined;\r\n    this.__cellValueEditingEvent = undefined;\r\n  }\r\n\r\n  private async resolvePropertyValueAsync<T>(targetObject: any, propertyName: string): Promise<T> {\r\n    const result = resolvePropertyValue(targetObject, propertyName, [this.row, this.index, this.column]);\r\n    if (isCommandString(result)) {\r\n      const parsed = parseCommandString(result);\r\n      if (parsed.command === 'Invoke:DotNet') {\r\n        const rowId = getFieldValue(this.row, this.table?.fieldId) as string;\r\n        try {\r\n          return await invokeDotNetMethodAsync(parsed.value, [rowId, this.index, this.column.field], { cache: true });\r\n        } catch (error) {\r\n          console.error('InvokeDotNetMethod 執行失敗', error);\r\n          throw error;\r\n        }\r\n      }\r\n      if (parsed.command === 'Get:Field') {\r\n        return getFieldValue(this.row, parsed.value) as T;\r\n      }\r\n    }\r\n\r\n    if (isConditions(result)) {\r\n      return evaluateConditions(result, this.row) as T;\r\n    }\r\n\r\n    if (isConditionGroups(result)) {\r\n      for (const conditionGroup of result) {\r\n        if (isConditions(conditionGroup.conditions) && evaluateConditions(conditionGroup.conditions, this.row)) {\r\n          return conditionGroup.value as T;\r\n        }\r\n      }\r\n      return undefined;\r\n    }\r\n\r\n    if (result instanceof Promise) {\r\n      try {\r\n        const resolved = await result;\r\n        return resolved;\r\n      } catch (error) {\r\n        console.error('屬性 Promise 解析失敗', error);\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host\r\n        onClick={ev => {\r\n          if (this.cellType === 'checkbox' || this.cellType === 'radio') {\r\n            const option = this.cellData as CheckControlOptionInterface;\r\n            if (option && option.disabled) {\r\n              ev.stopPropagation();\r\n              ev.preventDefault();\r\n              return;\r\n            }\r\n          }\r\n          this.clickCell.emit({ id: getFieldValue(this.row, this.table.fieldId) as string, field: this.column.field });\r\n        }}\r\n      >\r\n        {this.renderCell()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}