{"file":"storm-select.entry.esm.js","mappings":"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","names":[],"sources":["src/components/storm-select/storm-select.css?tag=storm-select","src/components/storm-select/storm-select.tsx"],"sourcesContent":[".choices__list--dropdown,\r\n.choices__list[aria-expanded] {\r\n    z-index: 1030;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, Watch, h } from '@stencil/core';\r\nimport Choices from 'choices.js';\r\nimport type { Choice } from 'choices.js/src/scripts/interfaces/choice';\r\nimport { arrayEqual, debounce } from '../../utils/utils';\r\n\r\n@Component({\r\n  tag: 'storm-select',\r\n  styleUrl: 'storm-select.css',\r\n  shadow: false,\r\n})\r\nexport class StormSelect {\r\n  private _choices: Choices;\r\n  private _dataSet: Choice[];\r\n  private _selectRef: HTMLSelectElement;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() label: string;\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop() name: string;\r\n  @Prop({ mutable: true }) dataSet: IOption[] | string;\r\n  @Prop() shouldSort: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n  @Prop() removeItemButton: boolean = false;\r\n  @Prop() duplicateItemsAllowed: boolean = false;\r\n  @Prop() searchable?: boolean;\r\n  @Prop() searchTimeOut: number = 500;\r\n  @Prop() searchFilter: boolean = true;\r\n\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() change: EventEmitter<string | string[]>;\r\n  @Event() searchChange: EventEmitter<string>;\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher() {\r\n    this.initDataSet();\r\n    if (this._selectRef?.getAttribute('data-choice') === 'active' && this._dataSet) {\r\n      if (this._dataSet.length) {\r\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\r\n      } else {\r\n        this._choices.clearStore();\r\n      }\r\n    }\r\n  }\r\n\r\n  @Watch('value')\r\n  valueWatcher() {\r\n    if (this._choices) {\r\n      const newValue = this._choices.getValue(true) as string[] | string;\r\n\r\n      if (Array.isArray(newValue) && Array.isArray(this.value)) {\r\n        if (!arrayEqual(newValue, this.value)) {\r\n          this._choices.setChoiceByValue(this.value);\r\n        }\r\n      } else if (newValue !== this.value) {\r\n        this._choices.setChoiceByValue(this.value);\r\n      }\r\n    }\r\n\r\n    this.change.emit(this.value);\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  private readonly setSearch = debounce((value: string) => {\r\n    this.searchChange.emit(value);\r\n  }, this.searchTimeOut);\r\n\r\n  initSelection() {\r\n    if (this._dataSet) {\r\n      if (this.value) {\r\n        this._dataSet.forEach(item => {\r\n          item.selected = Array.isArray(this.value) ? this.value.includes(item.value) : this.value == item.value;\r\n        });\r\n      } else if (this._dataSet.some(item => item.selected)) {\r\n        const selectedItems = this._dataSet.filter(item => item.selected);\r\n        this.value = this.selection === 'single' ? selectedItems[0].value : selectedItems.map(item => item.value);\r\n      } else if (this.selection === 'single') {\r\n        this._dataSet[0].selected = true;\r\n\r\n        this.value = this._dataSet[0].value;\r\n      }\r\n    } else if (this.selection === 'multiple') {\r\n      this.value = Array.from(this.host.querySelectorAll('option:checked')).map(o => (o as HTMLOptionElement).value);\r\n    } else {\r\n      this.value = (this.host.querySelector('option:checked') as HTMLOptionElement).value;\r\n    }\r\n  }\r\n\r\n  initDataSet() {\r\n    if (!this.dataSet) {\r\n      this._dataSet = null;\r\n    } else if (typeof this.dataSet === 'string') {\r\n      this._dataSet = JSON.parse(this.dataSet);\r\n    } else if (Array.isArray(this.dataSet) && this.dataSet.length) {\r\n      this._dataSet = this.dataSet.map(item => ({\r\n        value: item.id,\r\n        label: item.title,\r\n        selected: item.selected,\r\n      }));\r\n    }\r\n  }\r\n\r\n  handleFocused = async e => {\r\n    e.target.parentElement.classList.add('is-focused');\r\n  };\r\n\r\n  handleFocusout = async e => {\r\n    const target = e.target;\r\n    if (target.value) {\r\n      target.parentElement.classList.add('is-filled');\r\n    }\r\n    target.parentElement.classList.remove('is-focused');\r\n  };\r\n\r\n  handleKeyUp = async e => {\r\n    const target = e.target;\r\n    if (target.value) {\r\n      target.parentElement.classList.add('is-filled');\r\n    } else {\r\n      target.parentElement.classList.remove('is-filled');\r\n    }\r\n  };\r\n\r\n  componentWillLoad() {\r\n    this.initDataSet();\r\n    this.initSelection();\r\n  }\r\n\r\n  labelRender() {\r\n    if (this.label) {\r\n      return <label class=\"form-label ms-0\">{this.label}</label>;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        {this.labelRender()}\r\n        <select\r\n          class=\"form-control\"\r\n          name={this.name}\r\n          onFocus={e => this.handleFocused(e)}\r\n          onFocusout={e => this.handleFocusout(e)}\r\n          onKeyUp={e => this.handleKeyUp(e)}\r\n          ref={el => (this._selectRef = el)}\r\n          multiple={this.selection === 'multiple'}\r\n        >\r\n          <slot name=\"option\" />\r\n        </select>\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (this._selectRef.getAttribute('data-choice') !== 'active') {\r\n      this._choices = new Choices(this._selectRef, {\r\n        searchEnabled: this.searchable ?? this.selection === 'multiple',\r\n        allowHTML: true,\r\n        removeItemButton: this.removeItemButton,\r\n        noChoicesText: '沒有可供選擇的選項',\r\n        noResultsText: '找不到任何結果',\r\n        duplicateItemsAllowed: this.duplicateItemsAllowed,\r\n        shouldSort: this.shouldSort,\r\n        searchPlaceholderValue: '搜尋',\r\n        searchChoices: this.searchFilter,\r\n        searchFloor: -1,\r\n      });\r\n      if (this._dataSet) {\r\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\r\n      }\r\n      this._choices.passedElement.element.addEventListener(\r\n        'change',\r\n        (e: CustomEvent) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          this.value = this._choices.getValue(true) as string[] | string;\r\n        },\r\n        false,\r\n      );\r\n      if (!this.searchFilter)\r\n        this._selectRef.addEventListener('search', e => {\r\n          const event = e as CustomEvent<{ value: string; resultCount: number }>;\r\n          this.setSearch(event.detail.value);\r\n        });\r\n    }\r\n  }\r\n}\r\n\r\nexport interface IOption {\r\n  id: string;\r\n  title: string;\r\n  selected: boolean;\r\n}\r\n"],"version":3}