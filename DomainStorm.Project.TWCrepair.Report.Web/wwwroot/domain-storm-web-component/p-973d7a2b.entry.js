import{r as e,c as t,a as i,f as s,h as a,H as c}from"./p-CQNG65Br.js";import{S as h}from"./p-CAnyxfG4.js";const r=class{constructor(i){e(this,i),this.scroll=t(this,"scroll"),this.checkedChanged=t(this,"checkedChanged")}_dataSet;verticalSLotRef;treeViewRef;verticalList;navigationList;verticalListReverse;verticals;isDebouncing=!1;ticking=!1;get host(){return i(this)}treeViewable=!0;dataSet;fixTop=10;scrollY;selectToCheck=!1;checkSelectable=!1;scroll;checked;checkedChanged;fieldIcon="icon";fieldSelected="_selected";value;dataSetWatcher(e){this._dataSet="string"==typeof e?JSON.parse(e):e}scrollHandler(e){if(this.isDebouncing)return;const t=e.detail??window.scrollY;this.scrollY!==t&&(this.scrollY=t,this.requestFrame(),e.stopPropagation())}innerScrollHandler(e){if(this.isDebouncing)return;const t=e.detail??window.scrollY;this.scrollY!==t&&(this.scrollY=t,this.requestFrame(),e.stopPropagation())}requestFrame(){this.ticking||(this.ticking=!0,requestAnimationFrame((()=>{this.ticking=!1,this.updateFrame()})))}updateFrame(){this.refresh(),this.triggerActive(),this.scroll.emit(this.scrollY)}async refresh(){this.setVerticalData()}async getChecked(){return this.treeViewRef?.checked??[]}async componentWillLoad(){await h.applyShadowRootStylesAsync(this.host,"material"),this.dataSet&&this.dataSetWatcher(this.dataSet)}componentDidRender(){this.verticalList&&this.navigationList||(this.getVertical(),this.setNavigationData())}componentDidLoad(){this.treeViewRef.addEventListener("nodeSelect",(async e=>{const t=await this.treeViewRef.getNodeById(e.detail);window.location.replace(window.location.origin+window.location.pathname+window.location.search+t.href),this.isDebouncing=!0,setTimeout((()=>{this.isDebouncing=!1}),1)}))}getVertical(){this.verticals=this.verticalSLotRef.assignedElements(),0!=this.verticals.length&&this.setVerticalData()}setVerticalData(){this.verticalList=[],this.verticals.map((e=>{this.verticalList.push({href:"#"+e.getAttribute("id"),top:e.getBoundingClientRect().top+this.scrollY})})),this.verticalListReverse=this.verticalList.slice().reverse()}setNavigationData(){let e=this.treeViewRef.shadowRoot.querySelectorAll("storm-tree-node");0!=e.length&&(this.navigationList=[],e.forEach((e=>{this.navigationList.push(e),e.children&&e.querySelectorAll("storm-tree-node").forEach((e=>this.navigationList.push(e)))})))}triggerActive(){const e=this.scrollY+window.innerHeight/2,t=this.verticalListReverse.find((t=>t.top<=e));this.navigationList.forEach((e=>{const i=e.dataSet.href===t?.href;i&&!e.dataSet[this.fieldSelected]?this.addActive(e):!i&&e.dataSet[this.fieldSelected]&&this.removeActive(e)}))}addActive(e){e.dataSet[this.fieldSelected]=!0,s(e)}removeActive(e){e.dataSet[this.fieldSelected]=!1,s(e)}treeViewRender(){if(this.treeViewable)return a("storm-tree-view",{class:"p-3",selection:"single",dataSet:this._dataSet,selectToCheck:this.selectToCheck,checkSelectable:this.checkSelectable,checked:this.checked,fieldIcon:this.fieldIcon,fieldSelected:this.fieldSelected,value:this.value,onCheckedChanged:e=>this.handleCheckedChanged(e),ref:e=>this.treeViewRef=e})}handleCheckedChanged(e){e.stopPropagation(),this.checkedChanged.emit(e.detail)}render(){return a(c,{key:"2fbfc170fa9a4c5c9862c572af4e36d0b81a1a6e"},a("div",{key:"4989da24c85c2170277313c863acf3abdfe7d908",class:"container-fluid my-3 py-3"},a("div",{key:"65269ad52aa365fb3b79db28381b58c46e60a337",class:"row mb-5"},a("div",{key:"d77889dc81bc0176d7f8ef13047d41c2371824c9",class:"col-lg-9 mt-lg-0 mt-4"},a("slot",{key:"8eb552436edf83e1af07c689eaaae2772b852927",name:"vertical",ref:e=>this.verticalSLotRef=e})),a("div",{key:"56f3e24ee78798a5b8e26c9a8ceb0f6c25d442e7",class:"col-lg-3"},a("div",{key:"6e21ca45bd43083e476384ae7cff9e346769e2ac",class:"position-sticky top-"+this.fixTop},a("slot",{key:"4432adc551d28abc116da6e993676691fd3817ab",name:"navigation-header"}),a("div",{key:"779f76911631b8b68629e27435af07a6a465ff32",class:"card"},this.treeViewRender()))))))}static get watchers(){return{dataSet:[{dataSetWatcher:0}]}}};r.style="";export{r as storm_vertical_navigation}