import{r as e,c as t,a as i,f as s,h as a,H as c}from"./p-D7_hI2Rs.js";import{S as h}from"./p-B0cWbvbo.js";const r="";const n=class{constructor(i){e(this,i);this.scroll=t(this,"scroll");this.checkedChanged=t(this,"checkedChanged")}_dataSet;verticalSLotRef;treeViewRef;verticalList;navigationList;verticalListReverse;verticals;isDebouncing=false;ticking=false;get host(){return i(this)}treeViewable=true;dataSet;fixTop=10;scrollY;selectToCheck=false;checkSelectable=false;scroll;checked;checkedChanged;fieldIcon="icon";fieldSelected="_selected";value;dataSetWatcher(e){if(typeof e==="string"){this._dataSet=JSON.parse(e)}else{this._dataSet=e}}scrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}innerScrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}requestFrame(){if(this.ticking)return;this.ticking=true;requestAnimationFrame((()=>{this.ticking=false;this.updateFrame()}))}updateFrame(){this.refresh();this.triggerActive();this.scroll.emit(this.scrollY)}async refresh(){this.setVerticalData()}async getChecked(){return this.treeViewRef.checked}async componentWillLoad(){await h.applyShadowRootStylesAsync(this.host,"material");if(!this.dataSet)return;this.dataSetWatcher(this.dataSet)}componentDidRender(){if(this.verticalList&&this.navigationList)return;this.getVertical();this.setNavigationData()}componentDidLoad(){this.treeViewRef.addEventListener("nodeSelect",(async e=>{const t=await this.treeViewRef.getNodeById(e.detail);window.location.replace(window.location.origin+window.location.pathname+window.location.search+t["href"]);this.isDebouncing=true;setTimeout((()=>{this.isDebouncing=false}),1)}))}getVertical(){this.verticals=this.verticalSLotRef.assignedElements();if(this.verticals.length==0)return;this.setVerticalData()}getScrollContainer(e){while(e){if(e.classList.contains("ps")){break}e=e.parentElement}return e}setVerticalData(){this.verticalList=[];this.verticals.map((e=>{this.verticalList.push({href:"#"+e.getAttribute("id"),top:e.getBoundingClientRect().top+this.scrollY})}));this.verticalListReverse=this.verticalList.slice().reverse()}setNavigationData(){let e=this.treeViewRef.shadowRoot.querySelectorAll("storm-tree-node");if(e.length==0)return;this.navigationList=[];e.forEach((e=>{this.navigationList.push(e);if(e.children){e.querySelectorAll("storm-tree-node").forEach((e=>this.navigationList.push(e)))}}))}triggerActive(){const e=this.scrollY+window.innerHeight/2;const t=this.verticalListReverse.find((t=>t.top<=e));this.navigationList.forEach((e=>{const i=e.dataSet["href"]===t?.href;if(i&&!e.dataSet[this.fieldSelected]){this.addActive(e)}else if(!i&&e.dataSet[this.fieldSelected]){this.removeActive(e)}}))}addActive(e){e.dataSet[this.fieldSelected]=true;s(e)}removeActive(e){e.dataSet[this.fieldSelected]=false;s(e)}treeViewRender(){if(!this.treeViewable)return;return a("storm-tree-view",{class:"p-3",selection:"single",dataSet:this._dataSet,selectToCheck:this.selectToCheck,checkSelectable:this.checkSelectable,checked:this.checked,fieldIcon:this.fieldIcon,fieldSelected:this.fieldSelected,value:this.value,onCheckedChanged:e=>this.handleCheckedChanged(e),ref:e=>this.treeViewRef=e})}handleCheckedChanged(e){e.stopPropagation();this.checkedChanged.emit(e.detail)}render(){return a(c,{key:"b45eb2656ae2c11b8e067bae461e065e091ccaec"},a("div",{key:"6e784b05f7a50b924624bb2dbed4e9b3f6767db5",class:"container-fluid my-3 py-3"},a("div",{key:"7e06a311f76c6a6cb99ff0c6ecfacbec5d3776b1",class:"row mb-5"},a("div",{key:"91f09840ab05075cc2fb0e5f80234c0a64636d92",class:"col-lg-9 mt-lg-0 mt-4"},a("slot",{key:"cdf5f1caa3441d68206b31d9081f25fb3ce8cc6f",name:"vertical",ref:e=>this.verticalSLotRef=e})),a("div",{key:"90692640f63b8033c1856f3aaeabe6324cebea14",class:"col-lg-3"},a("div",{key:"61bc8a699396f29cfd60a28abf7f349eb15b09c2",class:"position-sticky "+"top-"+this.fixTop},a("slot",{key:"0ed6f8983953541e8a03d0228e6d9a6aa879b0e4",name:"navigation-header"}),a("div",{key:"66aa7e7307d305400041609e5956278dd518bcd1",class:"card"},this.treeViewRender()))))))}static get watchers(){return{dataSet:["dataSetWatcher"]}}};n.style=r;export{n as storm_vertical_navigation};
//# sourceMappingURL=p-3a9384ff.entry.js.map