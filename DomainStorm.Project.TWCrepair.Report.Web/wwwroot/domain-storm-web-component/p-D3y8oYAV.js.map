{"version":3,"file":"p-D3y8oYAV.js","sources":["src/utils/cache/cache-service.ts"],"sourcesContent":["import type { CacheEntry, ICacheProvider } from './interface';\n\nexport interface CacheOptions {\n    /**\n     * 快取失效時間 (毫秒)。超過 timestamp + expiredMillis 視為過期\n     */\n    expiredMillis?: number;\n    /**\n     * 可選，預設為 'default'，用於區分不同的快取區域\n     * - 例如：'user', 'session', 'config' 等\n     */\n    regionName?: string;\n}\n\n/**\n * CacheService 統一快取服務，\n * - 可指定底層 provider (符合 ICacheProvider)\n * - 支援 regionName 機制，且有「預設 regionName」\n */\nexport class CacheService {\n    private readonly provider: ICacheProvider;\n    private readonly defaultOptions: CacheOptions;\n\n    /**\n     * @param provider       底層快取提供者 (MemoryCache、IndexedDBCache 等)\n     * @param options        (可選) 快取選項，沒傳入時使用預設值\n     */\n    constructor(provider: ICacheProvider, options: CacheOptions = {}) {\n        if (typeof options.regionName !== 'string') {\n            options.regionName = 'default'; // 預設 regionName\n        }\n        if (typeof options.expiredMillis !== 'number' || options.expiredMillis <= 0) {\n            options.expiredMillis = 1000 * 60 * 5; // 預設 5 分鐘\n        }\n        this.provider = provider;\n        this.defaultOptions = options;\n    }\n\n    /**\n     * 把 regionName 與 key 組成 compositeKey\n     * 例：如果 regionName='foo'、key='bar'，則 compositeKey='foo:bar'\n     */\n    private makeCompositeKey(regionName: string, key: string): string {\n        return `${regionName}:${key}`;\n    }\n\n    /**\n     * 取得快取值，若不存在或已過期，回傳 null\n     * @param key         真正的 key (不要包含 regionName)\n     * @param regionName  (可選) 命名空間，沒傳入則使用建構時的 defaultRegion\n     */\n    async get<T = any>(key: string, regionName: string = this.defaultOptions.regionName): Promise<T | null> {\n        const compositeKey = this.makeCompositeKey(regionName, key);\n        const entry = await this.provider.get(compositeKey);\n        return entry ? (entry.value as T) : null;\n    }\n\n    /**\n     * 寫入快取 (若同 compositeKey 存在，直接覆寫)\n     * @param key         真正的 key\n     * @param value       要快取的資料\n     * \n     */\n    async set(\n        key: string,\n        value: any,\n        regionName: string = this.defaultOptions.regionName,\n        expiredMillis: number = this.defaultOptions.expiredMillis\n    ): Promise<void> {\n        const compositeKey = this.makeCompositeKey(regionName, key);\n        const entry: CacheEntry = {\n            value,\n            timestamp: Date.now(),\n            expiredMillis: expiredMillis,\n        };\n        await this.provider.set(compositeKey, entry);\n    }\n\n    /**\n     * 刪除單一快取項目\n     * @param key         真正的 key\n     * @param options     快取選項\n     */\n    async delete(key: string, regionName: string = this.defaultOptions.regionName): Promise<void> {\n        const compositeKey = this.makeCompositeKey(regionName, key);\n        await this.provider.delete(compositeKey);\n    }\n\n    /**\n     * 清空某個 region 底下的所有快取\n     * - 如果 provider 支援 prefix 刪除 (例如 IndexedDBCache 加入 deleteByPrefix)，可改寫為逐筆刪除\n     * @param regionName  (可選) 命名空間，沒傳入則使用建構時的 defaultRegion\n     */\n    async clearRegion(regionName: string = this.defaultOptions.regionName): Promise<void> {\n        const prefix = `${regionName}:`;\n        await this.provider.deleteByPrefix(prefix);\n    }\n\n    /**\n     * 清空所有 region (完全清空底層 provider)\n     */\n    async clearAll(): Promise<void> {\n        await this.provider.clear();\n    }\n}\n"],"names":[],"mappings":"AAcA;;;;AAIG;MACU,YAAY,CAAA;AACJ,IAAA,QAAQ;AACR,IAAA,cAAc;AAE/B;;;AAGG;IACH,WAAY,CAAA,QAAwB,EAAE,OAAA,GAAwB,EAAE,EAAA;AAC5D,QAAA,IAAI,OAAO,OAAO,CAAC,UAAU,KAAK,QAAQ,EAAE;AACxC,YAAA,OAAO,CAAC,UAAU,GAAG,SAAS,CAAC;;AAEnC,QAAA,IAAI,OAAO,OAAO,CAAC,aAAa,KAAK,QAAQ,IAAI,OAAO,CAAC,aAAa,IAAI,CAAC,EAAE;YACzE,OAAO,CAAC,aAAa,GAAG,IAAI,GAAG,EAAE,GAAG,CAAC,CAAC;;AAE1C,QAAA,IAAI,CAAC,QAAQ,GAAG,QAAQ;AACxB,QAAA,IAAI,CAAC,cAAc,GAAG,OAAO;;AAGjC;;;AAGG;IACK,gBAAgB,CAAC,UAAkB,EAAE,GAAW,EAAA;AACpD,QAAA,OAAO,CAAG,EAAA,UAAU,CAAI,CAAA,EAAA,GAAG,EAAE;;AAGjC;;;;AAIG;IACH,MAAM,GAAG,CAAU,GAAW,EAAE,aAAqB,IAAI,CAAC,cAAc,CAAC,UAAU,EAAA;QAC/E,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,GAAG,CAAC;QAC3D,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC;QACnD,OAAO,KAAK,GAAI,KAAK,CAAC,KAAW,GAAG,IAAI;;AAG5C;;;;;AAKG;AACH,IAAA,MAAM,GAAG,CACL,GAAW,EACX,KAAU,EACV,UAAqB,GAAA,IAAI,CAAC,cAAc,CAAC,UAAU,EACnD,aAAA,GAAwB,IAAI,CAAC,cAAc,CAAC,aAAa,EAAA;QAEzD,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,GAAG,CAAC;AAC3D,QAAA,MAAM,KAAK,GAAe;YACtB,KAAK;AACL,YAAA,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;AACrB,YAAA,aAAa,EAAE,aAAa;SAC/B;QACD,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC;;AAGhD;;;;AAIG;IACH,MAAM,MAAM,CAAC,GAAW,EAAE,aAAqB,IAAI,CAAC,cAAc,CAAC,UAAU,EAAA;QACzE,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,GAAG,CAAC;QAC3D,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC;;AAG5C;;;;AAIG;IACH,MAAM,WAAW,CAAC,UAAA,GAAqB,IAAI,CAAC,cAAc,CAAC,UAAU,EAAA;AACjE,QAAA,MAAM,MAAM,GAAG,CAAG,EAAA,UAAU,GAAG;QAC/B,MAAM,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC;;AAG9C;;AAEG;AACH,IAAA,MAAM,QAAQ,GAAA;AACV,QAAA,MAAM,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE;;AAElC;;;;"}