import{e as n,h as t}from"./p-9Du3dL5x.js";function r(n){var t,e,o="";if("string"==typeof n||"number"==typeof n)o+=n;else if("object"==typeof n)if(Array.isArray(n)){var s=n.length;for(t=0;t<s;t++)n[t]&&(e=r(n[t]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function e(n="",t=""){const r=crypto.randomUUID(),e=[];return n&&e.push(n),e.push(r),t&&e.push(t),e.join("_")}function o(n){return null==n?{}:Object.fromEntries(Object.entries(n).filter((([n,t])=>null!=t)))}const s=new Map;function i(n,t){if(null==n)return n;if("number"==typeof t)return Array.isArray(n)?n[t]:void 0;if("string"!=typeof t)throw new Error("Field must be a string or a number");const r=t.trim();if(""===r)return;let e,o=s.get(r);if(!o){if(o=u(r),s.size>=500){const n=s.keys().next().value;s.delete(n)}s.set(r,o)}switch(o.type){case"pipe":e=function(n,t){for(const r of t){const t=r.trim();if(t){const r=i(n,t);if(null!=r)return r}}return null}(n,o.parts);break;case"ampersand":e=function(n,t){const r=[];for(const e of t){const t=e.trim();if(t){const e=i(n,t);null!=e&&(Array.isArray(e)?r.push(...e):r.push(e))}}return r}(n,o.parts);break;case"dot":{const t=o.subField,r=i(n,o.firstField);e=i(r,t);break}case"simple":{const t=o.firstField;e=Array.isArray(n)&&n.length>0&&"object"==typeof n[0]&&null!==n[0]?n.map((n=>i(n,t))):"object"==typeof n&&null!==n?n[t]:void 0;break}default:e=void 0}if(o.removeNull&&Array.isArray(e)){const n=[];for(let t=0;t<e.length;t++){const r=e[t];null!=r&&n.push(r)}return n}return e}function u(n){let t=n,r=-1,e=-1,o=-1;for(let n=0;n<t.length;n++){const s=t[n];"|"===s&&-1===r?r=n:"&"===s&&-1===e?e=n:"."===s&&-1===o&&(o=n)}return-1!==r?{type:"pipe",parts:t.split("|")}:-1!==e?{type:"ampersand",parts:t.split("&")}:-1!==o?{type:"dot",firstField:t.substring(0,o),subField:t.substring(o+1)}:{type:"simple",firstField:t.endsWith("!")?t.slice(0,-1):t,removeNull:t.endsWith("!")}}function c(n,t,r){if(null==n)return;if("number"==typeof t)return void(Array.isArray(n)&&(n[t]=r));if("string"!=typeof t)throw new Error("Field must be a string or a number");const e=t.trim();if(""===e)return;let o=s.get(e);if(!o){if(o=u(e),s.size>=500){const n=s.keys().next().value;s.delete(n)}s.set(e,o)}if("pipe"!==o.type&&"ampersand"!==o.type){if("dot"!==o.type)if(Array.isArray(n)&&n.length>0&&"object"==typeof n[0])for(let t=0;t<n.length;t++){const o=n[t];o&&"object"==typeof o&&(o[e]=r)}else"object"==typeof n&&(n[e]=r);else if("object"==typeof n){const t=n[o.firstField];void 0!==t&&c(t,o.subField,r)}}else{const t=o.parts;for(let e=0;e<t.length;e++){const o=t[e].trim();if(o&&void 0!==i(n,o))return void c(n,o,r)}const e=t[0]?.trim();e&&c(n,e,r)}}function f(n,t,...r){if(null==t)return t;if("string"==typeof t)if(l(t))t=a(t);else{const r=t.split(".");let e=n||("undefined"!=typeof window?window:globalThis);for(const n of r)if(e=e?.[n],void 0===e)break;"function"==typeof e&&(t=e)}return"function"==typeof t?w(n,t,...r):t}function a(n){if("string"!=typeof n||""===n.trim())throw new Error("Function string cannot be empty");const t=/^export default\s+(async\s+)?function\s*\(([^)]*)\)\s*{([\s\S]*)}$/.exec(n);if(!t)throw new Error("Invalid function string");const r=!!t[1],e=t[2].split(",").map((n=>n.trim())).filter(Boolean),o=t[3].trim(),s=new Compartment,i=r?Object.getPrototypeOf((async function(){})).constructor:Function;return new s.globalThis[i.name](...e,o)}function l(n){if("string"!=typeof n)return!1;const t=n.trim();return/^export\s+default\s+function\s*[a-zA-Z0-9_$]*\s*\([^)]*\)\s*{[\s\S]*}$/.test(t)}function p(n,t){const r=n.filter((n=>"or"!==n.conjunction)),e=n.filter((n=>"or"===n.conjunction));return!(r.some((n=>!y(n,t)))||e.length>0&&!e.some((n=>y(n,t))))}function y(n,t){try{const r=f(null,n.field,t),e=f(null,n.operator,t),o=f(null,n.value,t),s=m(t,r);if(null==s)return"="===e?null==o:"!="===e?null!=o:"empty"===e;switch(e){case">":{const n=+s,t=+o;return!isNaN(n)&&!isNaN(t)&&n>t}case"<":{const n=+s,t=+o;return!isNaN(n)&&!isNaN(t)&&n<t}case">=":{const n=+s,t=+o;return!isNaN(n)&&!isNaN(t)&&n>=t}case"<=":{const n=+s,t=+o;return!isNaN(n)&&!isNaN(t)&&n<=t}case"=":return s===o||"number"==typeof s&&"string"==typeof o&&s===+o&&!isNaN(+o)||"string"==typeof s&&"number"==typeof o&&+s===o&&!isNaN(+s);case"!=":return!(s===o||"number"==typeof s&&"string"==typeof o&&s===+o&&!isNaN(+o)||"string"==typeof s&&"number"==typeof o&&+s===o&&!isNaN(+s));case"like":{const n=String(s).toLowerCase(),t=String(o).toLowerCase();return n.includes(t)}case"include":return Array.isArray(s)&&s.includes(o);case"notinclude":return Array.isArray(s)&&!s.includes(o);case"in":return Array.isArray(o)&&o.includes(s);case"notin":return Array.isArray(o)&&!o.includes(s);case"typeof":return"string"!=typeof o?(console.warn("typeof 運算符需要字串型別的比較值"),!1):typeof s===o;case"instanceof":return"function"!=typeof o?(console.warn("instanceof 運算符需要函數型別的比較值"),!1):s instanceof o;case"empty":return""===s||Array.isArray(s)&&0===s.length||"object"==typeof s&&null!==s&&0===Object.keys(s).length;case"notempty":return!(""===s||Array.isArray(s)&&0===s.length||"object"==typeof s&&null!==s&&0===Object.keys(s).length);case"match":try{const n=String(o);return new RegExp(n).test(String(s))}catch(n){return console.error("無效的正則表達式:",o),!1}default:throw new Error(`不支援的運算符: ${e}`)}}catch(n){return console.error("條件檢查失敗:",n),!1}}function b(n,t){return n.replace(/\{([^}]+)\}/g,((n,r)=>{const e=i(t,r);return void 0!==e?String(e):""}))}function d(n){if(!n)return{};if("object"==typeof n)return n;const t=n.trim();return t?t.split(/\s+/).reduce(((n,t)=>(t&&(n[t]=!0),n)),{}):{}}function g(n,t){const e=function(){for(var n,t,e=0,o="",s=arguments.length;e<s;e++)(n=arguments[e])&&(t=r(n))&&(o&&(o+=" "),o+=t);return o}(n,t);return e?e.split(/\s+/).reduce(((n,t)=>(t&&(n[t]=!0),n)),{}):{}}function m(n,t,r){if(!n||"object"!=typeof n)return null;let e=i(n,t);if("string"==typeof e&&l(e))try{e=a(e),c(n,t,e)}catch(n){return console.error(`無法解析函式字串 '${t}':`,n),null}try{return w(n,e,...r||[])}catch(n){return console.error(`執行屬性 '${t}' 時發生錯誤:`,n),null}}function N(n,r,e='<span class="bg-warning text-dark">$1</span>'){if(!r||!n)return n;try{const o=t.encode(r),s=new RegExp(`(${o})`,"gi"),i=e.replace("$1","$&");return n.replace(s,i)}catch(t){return console.error("搜尋高亮處理錯誤:",t),n}}function w(n,t,...r){return"function"!=typeof t?t:t.apply(n,r)}function j(n){return!(null==n||!Array.isArray(n))&&n.every((n=>"object"==typeof n&&null!==n&&"field"in n&&"operator"in n&&"value"in n))}function A(n){return!(null==n||!Array.isArray(n))&&n.every((n=>"object"==typeof n&&null!==n&&"conditions"in n&&j(n.conditions)&&"value"in n))}function h(n,t,r="single"){if(!Array.isArray(n)||0===n.length)return null;const e=n.filter((n=>!0===n.selected&&n.id)).map((n=>String(n.id)));if(0===e.length){if(t||"none"===r)return null;const o=n.find((n=>n.id));if(!o)return null;e.push(String(o.id))}return"single"===r?e[0]:e}function v(n){return Array.isArray(n)?0!==n.length&&n.some((n=>v(n))):"string"==typeof n&&""!==n.trim()}function $(t,r){return t==r||n(t,r)}function S(){return()=>{}}export{i as a,a as b,S as c,$ as d,f as e,N as f,e as g,h,l as i,A as j,j as k,p as l,g as m,b as n,o,d as p,v as q,m as r,c as s}