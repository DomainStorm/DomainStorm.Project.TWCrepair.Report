{"version":3,"file":"p-CAnyxfG4.js","sources":["src/utils/shared-styles.ts"],"sourcesContent":["export class SharedStyles {\r\n    private static materialDashboardStyles: CSSStyleSheet | null = null;\r\n    private static readonly appliedHosts = new WeakSet<HTMLElement>();\r\n    private static isInitialized = false;\r\n    private static initializationPromise: Promise<void> | null = null;\r\n\r\n    private static async initializeAsync(): Promise<void> {\r\n        if (this.isInitialized) return;\r\n\r\n        if (this.initializationPromise) {\r\n            return this.initializationPromise;\r\n        }\r\n\r\n        this.initializationPromise = this.performInitialization();\r\n        return this.initializationPromise;\r\n    }\r\n\r\n    private static extractCssFromExistingSheet(): string | null {\r\n        const sheets = Array.from(document.styleSheets);\r\n        for (const sheet of sheets) {\r\n            if (sheet.href?.includes('material-dashboard')) {\r\n                try {\r\n                    const rules = Array.from(sheet.cssRules);\r\n                    return rules.map(rule => rule.cssText).join('\\n');\r\n                } catch {\r\n                    // CORS restriction - can't access cssRules from cross-origin stylesheet\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private static async performInitialization(): Promise<void> {\r\n        if (!('CSSStyleSheet' in globalThis) || !('adoptedStyleSheets' in Document.prototype)) {\r\n            console.warn('SharedStyles: Constructable Stylesheets not supported');\r\n            this.isInitialized = true;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Extract CSS from existing stylesheet loaded via <link> tag\r\n            const css = this.extractCssFromExistingSheet();\r\n\r\n            if (css) {\r\n                const sheet = new CSSStyleSheet();\r\n                await sheet.replace(css);\r\n                this.materialDashboardStyles = sheet;\r\n                this.isInitialized = true;\r\n                return;\r\n            }\r\n\r\n            // Fallback: stylesheet not found or not accessible\r\n            console.warn('SharedStyles: material-dashboard.css not found or not accessible. Ensure it is loaded via <link> tag.');\r\n            this.isInitialized = true;\r\n        } catch (error) {\r\n            console.error('Failed to initialize StyleSheets:', error);\r\n            this.initializationPromise = null;\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    private static getStyleSheet(type: 'material'): CSSStyleSheet | null {\r\n        return type === 'material' ? this.materialDashboardStyles : null;\r\n    }\r\n\r\n    static async applyShadowRootStylesAsync(\r\n        host: HTMLElement,\r\n        ...styles: ('material')[]\r\n    ): Promise<void> {\r\n        // 提早驗證\r\n        if (!styles.length || !host?.shadowRoot) {\r\n            return;\r\n        }\r\n        \r\n        if (this.appliedHosts.has(host)) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const startTime = performance.now();\r\n            await this.initializeAsync();\r\n            \r\n            const sheets = this.getRequestedSheets(styles);\r\n            if (sheets.length > 0) {\r\n                this.applyStyleSheets(host, sheets);\r\n            }\r\n            \r\n            const applyTime = performance.now() - startTime;\r\n            if (applyTime > 50) {\r\n                console.warn(`Style application took ${applyTime.toFixed(2)}ms for component:`, host.tagName);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to apply shadow root styles:', error);\r\n            // 適度降級 - 如果無法應用樣式，組件仍然可以正常運作\r\n        }\r\n    }\r\n\r\n    private static getRequestedSheets(styles: ('material')[]): CSSStyleSheet[] {\r\n        return styles\r\n            .map(style => this.getStyleSheet(style))\r\n            .filter((sheet): sheet is CSSStyleSheet => sheet !== null);\r\n    }\r\n\r\n    private static applyStyleSheets(host: HTMLElement, sheets: CSSStyleSheet[]): void {\r\n        try {\r\n            const shadowRoot = host.shadowRoot!;\r\n            const existingSheets = shadowRoot.adoptedStyleSheets || [];\r\n            \r\n            // 避免重複添加相同的 stylesheet\r\n            const newSheets = sheets.filter(sheet => !existingSheets.includes(sheet));\r\n            \r\n            if (newSheets.length > 0) {\r\n                shadowRoot.adoptedStyleSheets = [...existingSheets, ...newSheets];\r\n            }\r\n            \r\n            this.appliedHosts.add(host);\r\n        } catch (error) {\r\n            console.error('Failed to apply stylesheets:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    static removeStyles(host: HTMLElement): void {\r\n        if (!host?.shadowRoot || !this.appliedHosts.has(host)) return;\r\n\r\n        try {\r\n            const shadowRoot = host.shadowRoot;\r\n            if (this.materialDashboardStyles && shadowRoot.adoptedStyleSheets) {\r\n                const filteredSheets = shadowRoot.adoptedStyleSheets.filter(\r\n                    sheet => sheet !== this.materialDashboardStyles\r\n                );\r\n                \r\n                // 只有在實際有改變時才更新\r\n                if (filteredSheets.length !== shadowRoot.adoptedStyleSheets.length) {\r\n                    shadowRoot.adoptedStyleSheets = filteredSheets;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to remove styles:', error);\r\n        } finally {\r\n            this.appliedHosts.delete(host);\r\n        }\r\n    }\r\n\r\n    static async preloadStyles(): Promise<void> {\r\n        try {\r\n            await this.initializeAsync();\r\n        } catch (error) {\r\n            console.warn('Style preloading failed:', error);\r\n        }\r\n    }\r\n\r\n    static isReady(): boolean {\r\n        return this.isInitialized;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}