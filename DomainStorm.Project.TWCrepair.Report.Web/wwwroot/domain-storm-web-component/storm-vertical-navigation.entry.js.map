{"file":"storm-vertical-navigation.entry.esm.js","mappings":"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","names":[],"sources":["src/layouts/storm-vertical-navigation/storm-vertical-navigation.css?tag=storm-vertical-navigation&encapsulation=shadow","src/layouts/storm-vertical-navigation/storm-vertical-navigation.tsx"],"sourcesContent":["","import { Component, Element, Event, EventEmitter, Host, Listen, Method, Prop, Watch, forceUpdate, h } from '@stencil/core';\r\nimport type { StormTreeViewCustomEvent } from '../../components';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\n\r\n@Component({\r\n  tag: 'storm-vertical-navigation',\r\n  styleUrl: 'storm-vertical-navigation.css',\r\n  shadow: true,\r\n})\r\nexport class StormVerticalNavigation {\r\n  private _dataSet: object[];\r\n  private verticalSLotRef: HTMLSlotElement;\r\n  private treeViewRef: HTMLStormTreeViewElement;\r\n\r\n  private verticalList: VerticalData[];\r\n  private navigationList: HTMLStormTreeNodeElement[];\r\n  private verticalListReverse: VerticalData[];\r\n  private verticals: Element[];\r\n  private isDebouncing: boolean = false;\r\n  private ticking: boolean = false;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() treeViewable: boolean = true;\r\n  @Prop({ reflect: false }) dataSet: object[] | string;\r\n  @Prop() fixTop: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 = 10;\r\n  @Prop({ mutable: true }) scrollY: number;\r\n  @Prop({ mutable: true }) selectToCheck: boolean = false;\r\n  @Prop() checkSelectable: boolean = false;\r\n  @Event() scroll: EventEmitter<number>;\r\n  @Prop({ mutable: true }) checked?: string[];\r\n  @Event() checkedChanged: EventEmitter<string[]>;\r\n  @Prop({ reflect: false }) fieldIcon: string = 'icon';\r\n  @Prop() fieldSelected: string = '_selected';\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher(newValue: object[] | string) {\r\n    if (typeof newValue === 'string') {\r\n      this._dataSet = JSON.parse(newValue);\r\n    } else {\r\n      this._dataSet = newValue;\r\n    }\r\n  }\r\n\r\n  @Listen('scroll', { target: 'document' })\r\n  scrollHandler(e: CustomEvent) {\r\n    if (this.isDebouncing) return;\r\n    const newScrollY = e.detail | window.scrollY;\r\n    if (this.scrollY === newScrollY) return;\r\n    this.scrollY = newScrollY;\r\n\r\n    this.requestFrame();\r\n\r\n    e.stopPropagation();\r\n  }\r\n\r\n  @Listen('innerScroll', { target: 'document' })\r\n  innerScrollHandler(e: CustomEvent) {\r\n    if (this.isDebouncing) return;\r\n    const newScrollY = e.detail | window.scrollY;\r\n    if (this.scrollY === newScrollY) return;\r\n    this.scrollY = newScrollY;\r\n\r\n    this.requestFrame();\r\n\r\n    e.stopPropagation();\r\n  }\r\n\r\n  requestFrame() {\r\n    if (this.ticking) return;\r\n\r\n    this.ticking = true;\r\n    requestAnimationFrame(() => {\r\n      this.ticking = false;\r\n      this.updateFrame();\r\n    });\r\n  }\r\n\r\n  private updateFrame() {\r\n    this.refresh();\r\n    this.triggerActive();\r\n    this.scroll.emit(this.scrollY);\r\n  }\r\n\r\n  @Method()\r\n  async refresh() {\r\n    this.setVerticalData();\r\n  }\r\n\r\n  @Method()\r\n  async getChecked(): Promise<string[]> {\r\n    return this.treeViewRef.checked;\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n\r\n    if (!this.dataSet) return;\r\n    this.dataSetWatcher(this.dataSet);\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (this.verticalList && this.navigationList) return;\r\n    this.getVertical();\r\n    this.setNavigationData();\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.treeViewRef.addEventListener('nodeSelect', async (e: CustomEvent) => {\r\n      const node = await this.treeViewRef.getNodeById(e.detail);\r\n      window.location.replace(window.location.origin + window.location.pathname + window.location.search + node['href']);\r\n      this.isDebouncing = true;\r\n      setTimeout(() => {\r\n        this.isDebouncing = false;\r\n      }, 1);\r\n    });\r\n  }\r\n\r\n  getVertical() {\r\n    this.verticals = this.verticalSLotRef.assignedElements();\r\n    if (this.verticals.length == 0) return;\r\n    this.setVerticalData();\r\n  }\r\n\r\n  getScrollContainer(elem: Element) {\r\n    while (elem) {\r\n      if (elem.classList.contains('ps')) {\r\n        break;\r\n      }\r\n      elem = elem.parentElement;\r\n    }\r\n\r\n    return elem;\r\n  }\r\n\r\n  setVerticalData() {\r\n    this.verticalList = [];\r\n    this.verticals.map(elem => {\r\n      this.verticalList.push({\r\n        href: '#' + elem.getAttribute('id'),\r\n        top: elem.getBoundingClientRect().top + this.scrollY,\r\n      });\r\n    });\r\n    this.verticalListReverse = this.verticalList.slice().reverse();\r\n  }\r\n\r\n  setNavigationData() {\r\n    let treeNodes = this.treeViewRef.shadowRoot.querySelectorAll('storm-tree-node');\r\n    if (treeNodes.length == 0) return;\r\n    this.navigationList = [];\r\n    treeNodes.forEach(elem => {\r\n      this.navigationList.push(elem);\r\n      if (elem.children) {\r\n        elem.querySelectorAll('storm-tree-node').forEach(elemChild => this.navigationList.push(elemChild));\r\n      }\r\n    });\r\n  }\r\n\r\n  triggerActive() {\r\n    const viewportMidpoint = this.scrollY + window.innerHeight / 2;\r\n\r\n    const activeElem = this.verticalListReverse.find(elem => elem.top <= viewportMidpoint);\r\n\r\n    this.navigationList.forEach(navElem => {\r\n      const isActive = navElem.dataSet['href'] === activeElem?.href;\r\n      if (isActive && !navElem.dataSet[this.fieldSelected]) {\r\n        this.addActive(navElem);\r\n      } else if (!isActive && navElem.dataSet[this.fieldSelected]) {\r\n        this.removeActive(navElem);\r\n      }\r\n    });\r\n  }\r\n\r\n  addActive(elem: HTMLStormTreeNodeElement) {\r\n    //let listItem = elem.querySelector('a');\r\n    //listItem.classList.add('active');\r\n    elem.dataSet[this.fieldSelected] = true;\r\n    forceUpdate(elem);\r\n  }\r\n\r\n  removeActive(elem: HTMLStormTreeNodeElement) {\r\n    //let listItem = elem.querySelector('a');\r\n    //listItem.classList.remove('active');\r\n    elem.dataSet[this.fieldSelected] = false;\r\n    forceUpdate(elem);\r\n  }\r\n\r\n  treeViewRender() {\r\n    if (!this.treeViewable) return;\r\n    return (\r\n      <storm-tree-view\r\n        class=\"p-3\"\r\n        selection=\"single\"\r\n        dataSet={this._dataSet}\r\n        selectToCheck={this.selectToCheck}\r\n        checkSelectable={this.checkSelectable}\r\n        checked={this.checked}\r\n        fieldIcon={this.fieldIcon}\r\n        fieldSelected={this.fieldSelected}\r\n        value={this.value}\r\n        onCheckedChanged={ev => this.handleCheckedChanged(ev)}\r\n        ref={e => (this.treeViewRef = e)}\r\n      ></storm-tree-view>\r\n    );\r\n  }\r\n\r\n  handleCheckedChanged(ev: StormTreeViewCustomEvent<string[]>) {\r\n    ev.stopPropagation();\r\n    this.checkedChanged.emit(ev.detail);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class=\"container-fluid my-3 py-3\">\r\n          <div class=\"row mb-5\">\r\n            <div class=\"col-lg-9 mt-lg-0 mt-4\">\r\n              <slot name=\"vertical\" ref={(e: HTMLSlotElement) => (this.verticalSLotRef = e)} />\r\n            </div>\r\n\r\n            <div class=\"col-lg-3\">\r\n              <div class={'position-sticky ' + 'top-' + this.fixTop}>\r\n                <slot name=\"navigation-header\" />\r\n                <div class=\"card\">{this.treeViewRender()}</div>\r\n                {/* <ul class=\"nav flex-column bg-white border-radius-lg p-3\">\r\n                  {this.treeViewRender()}\r\n                  <slot name=\"navigation\"/>\r\n                </ul> */}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface VerticalData {\r\n  href: string;\r\n  top: number;\r\n}\r\n"],"version":3}