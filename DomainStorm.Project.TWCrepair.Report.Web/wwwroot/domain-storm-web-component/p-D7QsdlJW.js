import{h as n}from"./p-CSLe0qE2.js";function t(n){var r,e,o="";if("string"==typeof n||"number"==typeof n)o+=n;else if("object"==typeof n)if(Array.isArray(n)){var s=n.length;for(r=0;r<s;r++)n[r]&&(e=t(n[r]))&&(o&&(o+=" "),o+=e)}else for(e in n)n[e]&&(o&&(o+=" "),o+=e);return o}function r(){for(var n,r,e=0,o="",s=arguments.length;e<s;e++)(n=arguments[e])&&(r=t(n))&&(o&&(o+=" "),o+=r);return o}function e(n="",t=""){const r=crypto.randomUUID();const e=[];if(n)e.push(n);e.push(r);if(t)e.push(t);return e.join("_")}const o=new Map;const s=500;function i(n,t){if(n==null)return n;if(typeof t==="number"){return Array.isArray(n)?n[t]:undefined}if(typeof t!=="string"){throw new Error("Field must be a string or a number")}const r=t.trim();if(r==="")return undefined;let e=o.get(r);if(!e){e=f(r);if(o.size>=s){const n=o.keys().next().value;o.delete(n)}o.set(r,e)}switch(e.type){case"pipe":return c(n,e.parts);case"ampersand":return a(n,e.parts);case"dot":const t=i(n,e.firstField);return i(t,e.subField);case"simple":if(Array.isArray(n)&&n.length>0&&typeof n[0]==="object"){return n.map((n=>i(n,r)))}if(typeof n==="object"&&n!==null){return n[r]}return undefined;default:return undefined}}function f(n){const t=n.indexOf("|");const r=n.indexOf("&");const e=n.indexOf(".");if(t!==-1){return{type:"pipe",parts:n.split("|")}}if(r!==-1){return{type:"ampersand",parts:n.split("&")}}if(e!==-1){return{type:"dot",firstField:n.substring(0,e),subField:n.substring(e+1)}}return{type:"simple"}}function u(n,t,r){if(n==null){return}if(typeof t==="number"){if(Array.isArray(n)){n[t]=r}return}if(typeof t!=="string"){throw new Error("Field must be a string or a number")}const e=t.trim();if(e==="")return;let c=o.get(e);if(!c){c=f(e);if(o.size>=s){const n=o.keys().next().value;o.delete(n)}o.set(e,c)}if(c.type==="pipe"||c.type==="ampersand"){const t=c.parts;for(let e=0;e<t.length;e++){const o=t[e].trim();if(o&&i(n,o)!==undefined){u(n,o,r);return}}const e=t[0]?.trim();if(e){u(n,e,r)}return}if(c.type==="dot"){if(typeof n==="object"){const t=n[c.firstField];if(t!==undefined){u(t,c.subField,r)}}return}if(Array.isArray(n)&&n.length>0&&typeof n[0]==="object"){for(let t=0;t<n.length;t++){const o=n[t];if(o&&typeof o==="object"){o[e]=r}}}else if(typeof n==="object"){n[e]=r}}function c(n,t){for(const r of t){const t=r.trim();if(t){const r=i(n,t);if(r!=null)return r}}return null}function a(n,t){const r=[];for(const e of t){const t=e.trim();if(t){const e=i(n,t);if(e!=null){if(Array.isArray(e)){r.push(...e)}else{r.push(e)}}}}return r}function l(n,t,...r){if(t==null)return t;if(typeof t==="string"){if(y(t)){t=p(t)}else{const r=t.split(".");let e=n||(typeof window!=="undefined"?window:globalThis);for(const n of r){e=e?.[n];if(e===undefined)break}if(typeof e==="function"){t=e}}}if(typeof t==="function"){return A(n,t,...r)}return t}function p(n){if(typeof n!=="string"||n.trim()===""){throw new Error("Function string cannot be empty")}const t=/^export default\s+(async\s+)?function\s*\(([^)]*)\)\s*{([\s\S]*)}$/;const r=t.exec(n);if(!r){throw new Error("Invalid function string")}const e=!!r[1];const o=r[2].split(",").map((n=>n.trim())).filter(Boolean);const s=r[3].trim();const i=new Compartment;const f=e?Object.getPrototypeOf((async function(){})).constructor:Function;const u=new i.globalThis[f.name](...o,s);return u}function y(n){if(typeof n!=="string"){return false}const t=n.trim();const r=/^export\s+default\s+function\s*[a-zA-Z0-9_$]*\s*\([^)]*\)\s*{[\s\S]*}$/;return r.test(t)}function d(n,t){const r=n.filter((n=>n.conjunction!=="or"));const e=n.filter((n=>n.conjunction==="or"));if(r.some((n=>!b(n,t)))){return false}if(e.length>0&&!e.some((n=>b(n,t)))){return false}return true}function b(n,t){try{const r=l(null,n.field,t);const e=l(null,n.operator,t);const o=l(null,n.value,t);const s=w(t,r);if(s===null||s===undefined){if(e==="=")return o===null||o===undefined;if(e==="!=")return o!==null&&o!==undefined;if(e==="empty")return true;if(e==="notempty")return false;return false}switch(e){case">":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n>t}case"<":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n<t}case">=":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n>=t}case"<=":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n<=t}case"=":return s===o||typeof s==="number"&&typeof o==="string"&&s===+o&&!isNaN(+o)||typeof s==="string"&&typeof o==="number"&&+s===o&&!isNaN(+s);case"!=":return s!==o&&!(typeof s==="number"&&typeof o==="string"&&s===+o&&!isNaN(+o))&&!(typeof s==="string"&&typeof o==="number"&&+s===o&&!isNaN(+s));case"like":{const n=String(s).toLowerCase();const t=String(o).toLowerCase();return n.includes(t)}case"include":return Array.isArray(s)&&s.includes(o);case"notinclude":return Array.isArray(s)&&!s.includes(o);case"in":return Array.isArray(o)&&o.includes(s);case"notin":return Array.isArray(o)&&!o.includes(s);case"typeof":if(typeof o!=="string"){console.warn("typeof 運算符需要字串型別的比較值");return false}return typeof s===o;case"instanceof":if(typeof o!=="function"){console.warn("instanceof 運算符需要函數型別的比較值");return false}return s instanceof o;case"empty":return s===""||Array.isArray(s)&&s.length===0||typeof s==="object"&&s!==null&&Object.keys(s).length===0;case"notempty":return s!==""&&!(Array.isArray(s)&&s.length===0)&&!(typeof s==="object"&&s!==null&&Object.keys(s).length===0);case"match":try{const n=String(o);return new RegExp(n).test(String(s))}catch(n){console.error("無效的正則表達式:",o);return false}default:throw new Error(`不支援的運算符: ${e}`)}}catch(n){console.error("條件檢查失敗:",n);return false}}function g(n,t){const r=/\{([^}]+)\}/g;return n.replace(r,((n,r)=>{const e=i(t,r);return e!==undefined?String(e):""}))}function m(n){if(!n)return{};if(typeof n==="object")return n;const t=n.trim();if(!t)return{};return t.split(/\s+/).reduce(((n,t)=>{if(t)n[t]=true;return n}),{})}function N(n,t){const e=r(n,t);if(!e)return{};return e.split(/\s+/).reduce(((n,t)=>{if(t)n[t]=true;return n}),{})}function w(n,t,r){if(!n||typeof n!=="object"){return null}if(!Object.hasOwn(n,t)){if(t.includes(".")){const e=t.split(".");const o=e.shift();if(Object.hasOwn(n,o)){const t=n[o];return w(t,e.join("."),r)}}return null}let e=n[t];if(typeof e==="string"&&y(e)){try{e=n[t]=p(e)}catch(n){console.error(`無法解析函式字串 '${t}':`,n);return null}}try{return A(n,e,...r||[])}catch(n){console.error(`執行屬性 '${t}' 時發生錯誤:`,n);return null}}function j(t,r,e='<span class="bg-warning text-dark">$1</span>'){if(!r||!t){return t}try{const o=n.encode(r);const s=new RegExp(`(${o})`,"gi");const i=e.replace("$1","$&");return t.replace(s,i)}catch(n){console.error("搜尋高亮處理錯誤:",n);return t}}function A(n,t,...r){if(typeof t!=="function"){return t}return t.apply(n,r)}function h(n){if(n==null||!Array.isArray(n)){return false}return n.every((n=>typeof n==="object"&&n!==null&&"field"in n&&"operator"in n&&"value"in n))}function S(n){if(n==null||!Array.isArray(n)){return false}return n.every((n=>typeof n==="object"&&n!==null&&"conditions"in n&&h(n.conditions)&&"value"in n))}function $(n,t,r="single"){if(!Array.isArray(n)||n.length===0)return null;const e=n.filter((n=>n.selected===true&&n.id)).map((n=>String(n.id)));if(e.length===0){if(t||r==="none"){return null}const o=n.find((n=>n.id));if(o){e.push(String(o.id))}else{return null}}return r==="single"?e[0]:e}function E(n){if(Array.isArray(n)){if(n.length===0){return false}return n.some((n=>E(n)))}return typeof n==="string"&&n.trim()!==""}export{i as a,j as b,p as c,l as d,$ as e,S as f,e as g,h,y as i,d as j,g as k,E as l,N as m,m as p,w as r,u as s};
//# sourceMappingURL=p-D7QsdlJW.js.map