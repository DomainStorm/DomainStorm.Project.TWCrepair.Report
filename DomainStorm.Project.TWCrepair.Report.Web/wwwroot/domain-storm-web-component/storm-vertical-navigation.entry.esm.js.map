{"version":3,"file":"storm-vertical-navigation.entry.esm.js","sources":["src/layouts/storm-vertical-navigation/storm-vertical-navigation.css?tag=storm-vertical-navigation&encapsulation=shadow","src/layouts/storm-vertical-navigation/storm-vertical-navigation.tsx"],"sourcesContent":["","import { Component, Element, Event, EventEmitter, Host, Listen, Method, Prop, Watch, forceUpdate, h } from '@stencil/core';\nimport { SharedStyles } from '@utils/shared-styles';\nimport type { StormTreeViewCustomEvent } from '../../components';\n\n@Component({\n  tag: 'storm-vertical-navigation',\n  styleUrl: 'storm-vertical-navigation.css',\n  shadow: true,\n})\nexport class StormVerticalNavigation {\n  private _dataSet: object[];\n  private verticalSLotRef: HTMLSlotElement;\n  private treeViewRef: HTMLStormTreeViewElement;\n\n  private verticalList: VerticalData[];\n  private navigationList: HTMLStormTreeNodeElement[];\n  private verticalListReverse: VerticalData[];\n  private verticals: Element[];\n  private isDebouncing: boolean = false;\n  private ticking: boolean = false;\n\n  @Element() host: HTMLElement;\n\n  @Prop() treeViewable: boolean = true;\n  @Prop({ reflect: false }) dataSet: object[] | string;\n  @Prop() fixTop: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 = 10;\n  @Prop({ mutable: true }) scrollY: number;\n  @Prop({ mutable: true }) selectToCheck: boolean = false;\n  @Prop() checkSelectable: boolean = false;\n  @Event() scroll: EventEmitter<number>;\n  @Prop({ mutable: true }) checked?: string[];\n  @Event() checkedChanged: EventEmitter<string[]>;\n  @Prop({ reflect: false }) fieldIcon: string = 'icon';\n  @Prop() fieldSelected: string = '_selected';\n  @Prop({ mutable: true }) value?: string | string[];\n\n  @Watch('dataSet')\n  dataSetWatcher(newValue: object[] | string) {\n    if (typeof newValue === 'string') {\n      this._dataSet = JSON.parse(newValue);\n    } else {\n      this._dataSet = newValue;\n    }\n  }\n\n  @Listen('scroll', { target: 'document' })\n  scrollHandler(e: CustomEvent) {\n    if (this.isDebouncing) return;\n    const newScrollY = e.detail | window.scrollY;\n    if (this.scrollY === newScrollY) return;\n    this.scrollY = newScrollY;\n\n    this.requestFrame();\n\n    e.stopPropagation();\n  }\n\n  @Listen('innerScroll', { target: 'document' })\n  innerScrollHandler(e: CustomEvent) {\n    if (this.isDebouncing) return;\n    const newScrollY = e.detail | window.scrollY;\n    if (this.scrollY === newScrollY) return;\n    this.scrollY = newScrollY;\n\n    this.requestFrame();\n\n    e.stopPropagation();\n  }\n\n  requestFrame() {\n    if (this.ticking) return;\n\n    this.ticking = true;\n    requestAnimationFrame(() => {\n      this.ticking = false;\n      this.updateFrame();\n    });\n  }\n\n  private updateFrame() {\n    this.refresh();\n    this.triggerActive();\n    this.scroll.emit(this.scrollY);\n  }\n\n  @Method()\n  async refresh() {\n    this.setVerticalData();\n  }\n\n  @Method()\n  async getChecked(): Promise<string[]> {\n    return this.treeViewRef.checked;\n  }\n\n  async componentWillLoad() {\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\n\n    if (!this.dataSet) return;\n    this.dataSetWatcher(this.dataSet);\n  }\n\n  componentDidRender() {\n    if (this.verticalList && this.navigationList) return;\n    this.getVertical();\n    this.setNavigationData();\n  }\n\n  componentDidLoad() {\n    this.treeViewRef.addEventListener('nodeSelect', async (e: CustomEvent) => {\n      const node = await this.treeViewRef.getNodeById(e.detail);\n      window.location.replace(window.location.origin + window.location.pathname + window.location.search + node['href']);\n      this.isDebouncing = true;\n      setTimeout(() => {\n        this.isDebouncing = false;\n      }, 1);\n    });\n  }\n\n  getVertical() {\n    this.verticals = this.verticalSLotRef.assignedElements();\n    if (this.verticals.length == 0) return;\n    this.setVerticalData();\n  }\n\n  getScrollContainer(elem: Element) {\n    while (elem) {\n      if (elem.classList.contains('ps')) {\n        break;\n      }\n      elem = elem.parentElement;\n    }\n\n    return elem;\n  }\n\n  setVerticalData() {\n    this.verticalList = [];\n    this.verticals.map(elem => {\n      this.verticalList.push({\n        href: '#' + elem.getAttribute('id'),\n        top: elem.getBoundingClientRect().top + this.scrollY,\n      });\n    });\n    this.verticalListReverse = this.verticalList.slice().reverse();\n  }\n\n  setNavigationData() {\n    let treeNodes = this.treeViewRef.shadowRoot.querySelectorAll('storm-tree-node');\n    if (treeNodes.length == 0) return;\n    this.navigationList = [];\n    treeNodes.forEach(elem => {\n      this.navigationList.push(elem);\n      if (elem.children) {\n        elem.querySelectorAll('storm-tree-node').forEach(elemChild => this.navigationList.push(elemChild));\n      }\n    });\n  }\n\n  triggerActive() {\n    const viewportMidpoint = this.scrollY + window.innerHeight / 2;\n\n    const activeElem = this.verticalListReverse.find(elem => elem.top <= viewportMidpoint);\n\n    this.navigationList.forEach(navElem => {\n      const isActive = navElem.dataSet['href'] === activeElem?.href;\n      if (isActive && !navElem.dataSet[this.fieldSelected]) {\n        this.addActive(navElem);\n      } else if (!isActive && navElem.dataSet[this.fieldSelected]) {\n        this.removeActive(navElem);\n      }\n    });\n  }\n\n  addActive(elem: HTMLStormTreeNodeElement) {\n    //let listItem = elem.querySelector('a');\n    //listItem.classList.add('active');\n    elem.dataSet[this.fieldSelected] = true;\n    forceUpdate(elem);\n  }\n\n  removeActive(elem: HTMLStormTreeNodeElement) {\n    //let listItem = elem.querySelector('a');\n    //listItem.classList.remove('active');\n    elem.dataSet[this.fieldSelected] = false;\n    forceUpdate(elem);\n  }\n\n  treeViewRender() {\n    if (!this.treeViewable) return;\n    return (\n      <storm-tree-view\n        class=\"p-3\"\n        selection=\"single\"\n        dataSet={this._dataSet}\n        selectToCheck={this.selectToCheck}\n        checkSelectable={this.checkSelectable}\n        checked={this.checked}\n        fieldIcon={this.fieldIcon}\n        fieldSelected={this.fieldSelected}\n        value={this.value}\n        onCheckedChanged={ev => this.handleCheckedChanged(ev)}\n        ref={e => (this.treeViewRef = e)}\n      ></storm-tree-view>\n    );\n  }\n\n  handleCheckedChanged(ev: StormTreeViewCustomEvent<string[]>) {\n    ev.stopPropagation();\n    this.checkedChanged.emit(ev.detail);\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"container-fluid my-3 py-3\">\n          <div class=\"row mb-5\">\n            <div class=\"col-lg-9 mt-lg-0 mt-4\">\n              <slot name=\"vertical\" ref={(e: HTMLSlotElement) => (this.verticalSLotRef = e)} />\n            </div>\n\n            <div class=\"col-lg-3\">\n              <div class={'position-sticky ' + 'top-' + this.fixTop}>\n                <slot name=\"navigation-header\" />\n                <div class=\"card\">{this.treeViewRender()}</div>\n                {/* <ul class=\"nav flex-column bg-white border-radius-lg p-3\">\n                  {this.treeViewRender()}\n                  <slot name=\"navigation\"/>\n                </ul> */}\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n\nexport interface VerticalData {\n  href: string;\n  top: number;\n}\n"],"names":[],"mappings":"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"}