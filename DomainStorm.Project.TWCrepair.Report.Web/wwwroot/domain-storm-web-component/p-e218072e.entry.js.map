{"version":3,"names":["stormVerticalNavigationCss","StormVerticalNavigation","_dataSet","verticalSLotRef","treeViewRef","verticalList","navigationList","verticalListReverse","verticals","isDebouncing","ticking","treeViewable","dataSet","fixTop","scrollY","selectToCheck","checkSelectable","scroll","checked","checkedChanged","fieldIcon","fieldSelected","value","dataSetWatcher","newValue","this","JSON","parse","scrollHandler","e","newScrollY","detail","window","requestFrame","stopPropagation","innerScrollHandler","requestAnimationFrame","updateFrame","refresh","triggerActive","emit","setVerticalData","getChecked","componentWillLoad","SharedStyles","applyShadowRootStylesAsync","host","componentDidRender","getVertical","setNavigationData","componentDidLoad","addEventListener","async","node","getNodeById","location","replace","origin","pathname","search","setTimeout","assignedElements","length","getScrollContainer","elem","classList","contains","parentElement","map","push","href","getAttribute","top","getBoundingClientRect","slice","reverse","treeNodes","shadowRoot","querySelectorAll","forEach","children","elemChild","viewportMidpoint","innerHeight","activeElem","find","navElem","isActive","addActive","removeActive","forceUpdate","treeViewRender","h","class","selection","onCheckedChanged","ev","handleCheckedChanged","ref","render","Host","key","name"],"sources":["src/layouts/storm-vertical-navigation/storm-vertical-navigation.css?tag=storm-vertical-navigation&encapsulation=shadow","src/layouts/storm-vertical-navigation/storm-vertical-navigation.tsx"],"sourcesContent":[null,"import { Component, Element, Event, EventEmitter, Host, Listen, Method, Prop, Watch, forceUpdate, h } from '@stencil/core';\nimport { SharedStyles } from '@utils/shared-styles';\nimport type { StormTreeViewCustomEvent } from '../../components';\n\n@Component({\n  tag: 'storm-vertical-navigation',\n  styleUrl: 'storm-vertical-navigation.css',\n  shadow: true,\n})\nexport class StormVerticalNavigation {\n  private _dataSet: object[];\n  private verticalSLotRef: HTMLSlotElement;\n  private treeViewRef: HTMLStormTreeViewElement;\n\n  private verticalList: VerticalData[];\n  private navigationList: HTMLStormTreeNodeElement[];\n  private verticalListReverse: VerticalData[];\n  private verticals: Element[];\n  private isDebouncing: boolean = false;\n  private ticking: boolean = false;\n\n  @Element() host: HTMLElement;\n\n  @Prop() treeViewable: boolean = true;\n  @Prop({ reflect: false }) dataSet: object[] | string;\n  @Prop() fixTop: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 = 10;\n  @Prop({ mutable: true }) scrollY: number;\n  @Prop({ mutable: true }) selectToCheck: boolean = false;\n  @Prop() checkSelectable: boolean = false;\n  @Event() scroll: EventEmitter<number>;\n  @Prop({ mutable: true }) checked?: string[];\n  @Event() checkedChanged: EventEmitter<string[]>;\n  @Prop({ reflect: false }) fieldIcon: string = 'icon';\n  @Prop() fieldSelected: string = '_selected';\n  @Prop({ mutable: true }) value?: string | string[];\n\n  @Watch('dataSet')\n  dataSetWatcher(newValue: object[] | string) {\n    if (typeof newValue === 'string') {\n      this._dataSet = JSON.parse(newValue);\n    } else {\n      this._dataSet = newValue;\n    }\n  }\n\n  @Listen('scroll', { target: 'document' })\n  scrollHandler(e: CustomEvent) {\n    if (this.isDebouncing) return;\n    const newScrollY = e.detail | window.scrollY;\n    if (this.scrollY === newScrollY) return;\n    this.scrollY = newScrollY;\n\n    this.requestFrame();\n\n    e.stopPropagation();\n  }\n\n  @Listen('innerScroll', { target: 'document' })\n  innerScrollHandler(e: CustomEvent) {\n    if (this.isDebouncing) return;\n    const newScrollY = e.detail | window.scrollY;\n    if (this.scrollY === newScrollY) return;\n    this.scrollY = newScrollY;\n\n    this.requestFrame();\n\n    e.stopPropagation();\n  }\n\n  requestFrame() {\n    if (this.ticking) return;\n\n    this.ticking = true;\n    requestAnimationFrame(() => {\n      this.ticking = false;\n      this.updateFrame();\n    });\n  }\n\n  private updateFrame() {\n    this.refresh();\n    this.triggerActive();\n    this.scroll.emit(this.scrollY);\n  }\n\n  @Method()\n  async refresh() {\n    this.setVerticalData();\n  }\n\n  @Method()\n  async getChecked(): Promise<string[]> {\n    return this.treeViewRef.checked;\n  }\n\n  async componentWillLoad() {\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\n\n    if (!this.dataSet) return;\n    this.dataSetWatcher(this.dataSet);\n  }\n\n  componentDidRender() {\n    if (this.verticalList && this.navigationList) return;\n    this.getVertical();\n    this.setNavigationData();\n  }\n\n  componentDidLoad() {\n    this.treeViewRef.addEventListener('nodeSelect', async (e: CustomEvent) => {\n      const node = await this.treeViewRef.getNodeById(e.detail);\n      window.location.replace(window.location.origin + window.location.pathname + window.location.search + node['href']);\n      this.isDebouncing = true;\n      setTimeout(() => {\n        this.isDebouncing = false;\n      }, 1);\n    });\n  }\n\n  getVertical() {\n    this.verticals = this.verticalSLotRef.assignedElements();\n    if (this.verticals.length == 0) return;\n    this.setVerticalData();\n  }\n\n  getScrollContainer(elem: Element) {\n    while (elem) {\n      if (elem.classList.contains('ps')) {\n        break;\n      }\n      elem = elem.parentElement;\n    }\n\n    return elem;\n  }\n\n  setVerticalData() {\n    this.verticalList = [];\n    this.verticals.map(elem => {\n      this.verticalList.push({\n        href: '#' + elem.getAttribute('id'),\n        top: elem.getBoundingClientRect().top + this.scrollY,\n      });\n    });\n    this.verticalListReverse = this.verticalList.slice().reverse();\n  }\n\n  setNavigationData() {\n    let treeNodes = this.treeViewRef.shadowRoot.querySelectorAll('storm-tree-node');\n    if (treeNodes.length == 0) return;\n    this.navigationList = [];\n    treeNodes.forEach(elem => {\n      this.navigationList.push(elem);\n      if (elem.children) {\n        elem.querySelectorAll('storm-tree-node').forEach(elemChild => this.navigationList.push(elemChild));\n      }\n    });\n  }\n\n  triggerActive() {\n    const viewportMidpoint = this.scrollY + window.innerHeight / 2;\n\n    const activeElem = this.verticalListReverse.find(elem => elem.top <= viewportMidpoint);\n\n    this.navigationList.forEach(navElem => {\n      const isActive = navElem.dataSet['href'] === activeElem?.href;\n      if (isActive && !navElem.dataSet[this.fieldSelected]) {\n        this.addActive(navElem);\n      } else if (!isActive && navElem.dataSet[this.fieldSelected]) {\n        this.removeActive(navElem);\n      }\n    });\n  }\n\n  addActive(elem: HTMLStormTreeNodeElement) {\n    //let listItem = elem.querySelector('a');\n    //listItem.classList.add('active');\n    elem.dataSet[this.fieldSelected] = true;\n    forceUpdate(elem);\n  }\n\n  removeActive(elem: HTMLStormTreeNodeElement) {\n    //let listItem = elem.querySelector('a');\n    //listItem.classList.remove('active');\n    elem.dataSet[this.fieldSelected] = false;\n    forceUpdate(elem);\n  }\n\n  treeViewRender() {\n    if (!this.treeViewable) return;\n    return (\n      <storm-tree-view\n        class=\"p-3\"\n        selection=\"single\"\n        dataSet={this._dataSet}\n        selectToCheck={this.selectToCheck}\n        checkSelectable={this.checkSelectable}\n        checked={this.checked}\n        fieldIcon={this.fieldIcon}\n        fieldSelected={this.fieldSelected}\n        value={this.value}\n        onCheckedChanged={ev => this.handleCheckedChanged(ev)}\n        ref={e => (this.treeViewRef = e)}\n      ></storm-tree-view>\n    );\n  }\n\n  handleCheckedChanged(ev: StormTreeViewCustomEvent<string[]>) {\n    ev.stopPropagation();\n    this.checkedChanged.emit(ev.detail);\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"container-fluid my-3 py-3\">\n          <div class=\"row mb-5\">\n            <div class=\"col-lg-9 mt-lg-0 mt-4\">\n              <slot name=\"vertical\" ref={(e: HTMLSlotElement) => (this.verticalSLotRef = e)} />\n            </div>\n\n            <div class=\"col-lg-3\">\n              <div class={'position-sticky ' + 'top-' + this.fixTop}>\n                <slot name=\"navigation-header\" />\n                <div class=\"card\">{this.treeViewRender()}</div>\n                {/* <ul class=\"nav flex-column bg-white border-radius-lg p-3\">\n                  {this.treeViewRender()}\n                  <slot name=\"navigation\"/>\n                </ul> */}\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n\nexport interface VerticalData {\n  href: string;\n  top: number;\n}\n"],"mappings":"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","ignoreList":[]}