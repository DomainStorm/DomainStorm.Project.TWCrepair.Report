import{r as t,c as s,a as e,h as i,H as h}from"./p-D7_hI2Rs.js";import{a,d as l}from"./p-k7ub6n8r.js";import{C as c}from"./p-QhK_4StC.js";import"./p-BOWIeDdp.js";import"./p-E-ZsRS8r.js";const o=".choices__list--dropdown,.choices__list[aria-expanded]{z-index:1030}";const r=class{constructor(e){t(this,e);this.valueChanged=s(this,"valueChanged");this.change=s(this,"change");this.searchChange=s(this,"searchChange")}_choices;_dataSet;_selectRef;get host(){return e(this)}label;value;name;dataSet;shouldSort=false;selection="single";removeItemButton=false;duplicateItemsAllowed=false;searchable;searchTimeOut=500;searchFilter=true;valueChanged;change;searchChange;dataSetWatcher(){this.initDataSet();if(this._selectRef?.getAttribute("data-choice")==="active"&&this._dataSet){if(this._dataSet.length){this._choices.setChoices(this._dataSet,"value","label",true)}else{this._choices.clearStore()}}}valueWatcher(){if(this._choices){const t=this._choices.getValue(true);if(Array.isArray(t)&&Array.isArray(this.value)){if(!a(t,this.value)){this._choices.setChoiceByValue(this.value)}}else if(t!==this.value){this._choices.setChoiceByValue(this.value)}}this.change.emit(this.value);this.valueChanged.emit(this.value)}setSearch=l((t=>{this.searchChange.emit(t)}),this.searchTimeOut);initSelection(){if(this._dataSet){if(this.value){this._dataSet.forEach((t=>{t.selected=Array.isArray(this.value)?this.value.includes(t.value):this.value==t.value}))}else if(this._dataSet.some((t=>t.selected))){const t=this._dataSet.filter((t=>t.selected));this.value=this.selection==="single"?t[0].value:t.map((t=>t.value))}else if(this.selection==="single"){this._dataSet[0].selected=true;this.value=this._dataSet[0].value}}else if(this.selection==="multiple"){this.value=Array.from(this.host.querySelectorAll("option:checked")).map((t=>t.value))}else{this.value=this.host.querySelector("option:checked").value}}initDataSet(){if(!this.dataSet){this._dataSet=null}else if(typeof this.dataSet==="string"){this._dataSet=JSON.parse(this.dataSet)}else if(Array.isArray(this.dataSet)&&this.dataSet.length){this._dataSet=this.dataSet.map((t=>({value:t.id,label:t.title,selected:t.selected})))}}handleFocused=async t=>{t.target.parentElement.classList.add("is-focused")};handleFocusout=async t=>{const s=t.target;if(s.value){s.parentElement.classList.add("is-filled")}s.parentElement.classList.remove("is-focused")};handleKeyUp=async t=>{const s=t.target;if(s.value){s.parentElement.classList.add("is-filled")}else{s.parentElement.classList.remove("is-filled")}};componentWillLoad(){this.initDataSet();this.initSelection()}labelRender(){if(this.label){return i("label",{class:"form-label ms-0"},this.label)}}render(){return i(h,{key:"cd6b979c48143a02c1c37f7879b5bb0f9e2b4aff"},this.labelRender(),i("select",{key:"4c486af54c9e734e79af0ae3d5f6d8af201da013",class:"form-control",name:this.name,onFocus:t=>this.handleFocused(t),onFocusout:t=>this.handleFocusout(t),onKeyUp:t=>this.handleKeyUp(t),ref:t=>this._selectRef=t,multiple:this.selection==="multiple"},i("slot",{key:"2021144af1f2ec5e0863ea760314ebcf92665218",name:"option"})))}componentDidRender(){if(this._selectRef.getAttribute("data-choice")!=="active"){this._choices=new c(this._selectRef,{searchEnabled:this.searchable??this.selection==="multiple",allowHTML:true,removeItemButton:this.removeItemButton,noChoicesText:"沒有可供選擇的選項",noResultsText:"找不到任何結果",duplicateItemsAllowed:this.duplicateItemsAllowed,shouldSort:this.shouldSort,searchPlaceholderValue:"搜尋",searchChoices:this.searchFilter,searchFloor:-1});if(this._dataSet){this._choices.setChoices(this._dataSet,"value","label",true)}this._choices.passedElement.element.addEventListener("change",(t=>{t.preventDefault();t.stopPropagation();this.value=this._choices.getValue(true)}),false);if(!this.searchFilter)this._selectRef.addEventListener("search",(t=>{const s=t;this.setSearch(s.detail.value)}))}}static get watchers(){return{dataSet:["dataSetWatcher"],value:["valueWatcher"]}}};r.style=o;export{r as storm_select};
//# sourceMappingURL=p-819ae39a.entry.js.map