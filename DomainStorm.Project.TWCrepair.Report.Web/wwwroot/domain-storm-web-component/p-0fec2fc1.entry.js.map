{"version":3,"names":["stormCheckboxGroupCss","StormCheckboxGroup","_dataSet","type","labelClasses","isSwitch","isInline","dataSet","value","disabled","valueChanged","dataSetWatcher","newValue","this","JSON","parse","error","console","valueWatcher","find","x","checked","id","filter","map","checkedItems","length","reverse","slice","forEach","item","Array","isArray","includes","check","uncheckAll","uncheck","componentWillLoad","dataSetRender","label","h","onValueChanged","ev","detail","render","Host","key","stormDropdownTreeCss","StormDropdownTree","_dropdownRef","_treeRef","_text","heading","text","dataSource","nullable","fieldId","fieldLabel","fieldChildren","expandLevel","nodeSelectableRule","size","partialLoad","loading","class","valid","required","searchText","searchable","selection","timeStamp","textChanged","searchChanged","updateValue","emit","textWatcher","componentDidLoad","renderTree","ref","elm","stopPropagation","onNodeClick","async","hide","onSearchChanged","componentWillRender","values","texts","node","getNodeById","push","getLabel","join","undefined","showSelected","onUnselectedAll","unselectAll","onShowMenu","loadDataSet","requestAnimationFrame","setSearchFocus","stormTableToolbarCss","StormTableToolbar","_dateSet","table","column","row","isDynamicLabel","clickAction","buttons","tooltip","icon","buttonStyle","rounded","visible","isConditions","evaluateConditions","calculateObjectValue","getFieldValue","fieldIndex","items","y","title","selected","click","_","dropdownItem","action","field","actionId","dropdownItemId","align","stormToolbarCss","StormToolbar","toolbarAction","renderToolbarItem","renderDropdown","onToolbarAction","e","handleAction","isModuleFunctionString","Error","createFunctionFromString","trigger","toggleIcon","onItemClick","parseClassNames","DB_NAME","STORE_NAME","DB_VERSION","IndexedDBCache","dbPromise","isSupported","checkSupport","window","indexedDB","openDB","Promise","reject","resolve","request","open","onupgradeneeded","event","db","target","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","onclose","onversionchange","close","onerror","onblocked","warn","withTransaction","mode","operation","tx","transaction","store","objectStore","operationCompleted","oncomplete","onabort","then","abort","get","req","evt","record","now","Date","timestamp","expiredMillis","delete","catch","set","entry","put","clear","deleteByPrefix","prefix","range","IDBKeyRange","bound","openCursor","keysToDelete","cursor","toString","startsWith","continue","batchDelete","keys","completed","hasError","checkCompletion","batchSet","entries","cacheService","CacheService","regionName","fetchDataSource","options","method","contentType","stringify","cached","response","fetch","url","body","headers","Headers","ok","statusText","data","json","stormTreeViewCss","StormTreeView","_searchText","_items","_dataSource","_searchRef","_nodeSelectableRule","_nodeCheckRule","fieldSubId","fieldSubLabel","fieldSubChildren","fieldSelected","fieldChecked","fieldExpanded","fieldDisabled","fieldParent","fieldSelectable","fieldCheckSelectable","fieldIcon","fieldHref","fieldLevel","fieldChildLoaded","fieldElement","expandIconAlign","expandIcon","collapseIcon","color","structure","checkSelectable","nodeCheckRule","selectToCheck","dateSetLoaded","nodeSelect","nodeUnselect","nodeClick","nodeDblClick","nodeCheck","nodeUncheck","checkedChanged","keydown","searchChangedHandler","cleanNodes","rerender","nodeSelectHandler","currentValue","nodeUnselectHandler","nodeCheckHandler","nodeUncheckHandler","valueChangedHandler","valueArray","all","String","shouldSelect","promises","setNodeExpanded","setNodeSelectionState","checkedChangedHandler","checkedArray","shouldChecked","setNodeCheckedState","watchValueHandler","watchCheckedHandler","getTreeNode","select","unselect","setFieldValue","watchDataSourceHandler","endsWith","watchNodeSelectableRuleHandler","watchNodeCheckRuleHandler","watchDataSetHandler","getDataSource","setDataSet","getSelected","getSelectedById","setFocus","debounce","forceUpdate","renderNode","content","appendHighlight","tree","parent","expand","treeNode","loadChild","dataSetParse","mergeChild","split","trim","updateItems","source","dest","part","sourcePartValue","destPartValue","clonedValue","structureType","level","children","SharedStyles","applyShadowRootStylesAsync","host","handleSearchChanged","renderSearch","FnSearchInput","nodesRender","nodes"],"sources":["src/components/storm-checkbox-group/storm-checkbox-group.css?tag=storm-checkbox-group","src/components/storm-checkbox-group/storm-checkbox-group.tsx","src/components/storm-dropdown-tree/storm-dropdown-tree.css?tag=storm-dropdown-tree","src/components/storm-dropdown-tree/storm-dropdown-tree.tsx","src/components/storm-table/storm-table-toolbar/storm-table-toolbar.css?tag=storm-table-toolbar","src/components/storm-table/storm-table-toolbar/storm-table-toolbar.tsx","src/components/storm-toolbar/storm-toolbar.css?tag=storm-toolbar","src/components/storm-toolbar/storm-toolbar.tsx","src/utils/cache/indexed-db-cache.ts","src/utils/fetch-data-source/fetch-data-source.ts","src/components/storm-tree-view/storm-tree-view.css?tag=storm-tree-view&encapsulation=shadow","src/components/storm-tree-view/storm-tree-view.tsx"],"sourcesContent":[":host {\r\n    display: block;\r\n}","import { Component, Event, EventEmitter, h, Host, Prop, Watch } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'storm-checkbox-group',\r\n  styleUrl: 'storm-checkbox-group.css',\r\n  shadow: false,\r\n})\r\nexport class StormCheckboxGroup {\r\n  private _dataSet: ICheckboxItem[];\r\n\r\n  @Prop() type: 'checkbox' | 'radio' = 'checkbox';\r\n  @Prop() labelClasses: Record<string, boolean> | string = 'custom-control-label';\r\n  @Prop() isSwitch: boolean = false;\r\n  @Prop() isInline: boolean = false;\r\n  @Prop() dataSet: ICheckboxItem[] | string;\r\n  @Prop({ mutable: true }) value: string | string[];\r\n  @Prop({ mutable: true }) disabled?: boolean;\r\n\r\n  @Event() valueChanged: EventEmitter<string | string[] | null>;\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher(newValue: ICheckboxItem[] | string) {\r\n    try {\r\n      this._dataSet = typeof newValue === 'string' ? JSON.parse(newValue) : newValue;\r\n    } catch (error) {\r\n      console.error('Invalid JSON format:', error);\r\n      return;\r\n    }\r\n    if (this.value) {\r\n      this.valueWatcher(this.value);\r\n    } else this.value = this.type === 'checkbox' ? this._dataSet.find(x => x.checked)?.id : this._dataSet.filter(x => x.checked).map(x => x.id);\r\n    if (this.type === 'radio') {\r\n      const checkedItems = this._dataSet.filter(x => x.checked);\r\n      if (checkedItems.length === 0) {\r\n        this._dataSet[0].checked = true;\r\n      } else if (checkedItems.length > 1) {\r\n        checkedItems\r\n          .reverse()\r\n          .slice(1)\r\n          .forEach(item => (item.checked = false));\r\n      }\r\n    }\r\n  }\r\n\r\n  @Watch('value')\r\n  valueWatcher(newValue: string | string[]) {\r\n    if (Array.isArray(newValue)) this._dataSet.forEach(x => (x.checked = newValue.includes(x.id)));\r\n    else this._dataSet.forEach(x => (x.checked = x.id == newValue));\r\n  }\r\n\r\n  check(item: ICheckboxItem) {\r\n    if (this.type === 'radio') {\r\n      this.uncheckAll();\r\n    }\r\n    item.checked = true;\r\n    if (this.type === 'radio') {\r\n      this.value = item.id;\r\n    } else if (Array.isArray(this.value)) {\r\n      if (!this.value.includes(item.id)) this.value = [...this.value, item.id];\r\n    } else {\r\n      this.value = [item.id];\r\n    }\r\n  }\r\n\r\n  uncheck(item: ICheckboxItem) {\r\n    item.checked = false;\r\n    if (this.type === 'radio') {\r\n      if (this.value === item.id) {\r\n        this.value = null;\r\n      }\r\n    } else if (Array.isArray(this.value)) {\r\n      this.value = this.value.filter(id => id !== item.id);\r\n    }\r\n  }\r\n\r\n  uncheckAll() {\r\n    if (this._dataSet) {\r\n      this._dataSet.filter(x => x.checked).forEach(x => (x.checked = false));\r\n    }\r\n  }\r\n\r\n  componentWillLoad() {\r\n    if (this.dataSet) {\r\n      this.dataSetWatcher(this.dataSet);\r\n    }\r\n  }\r\n\r\n  dataSetRender() {\r\n    return this._dataSet.map(item => {\r\n      if (!item.id) item.id = item.label;\r\n      return (\r\n        <storm-checkbox\r\n          type={this.type}\r\n          label={item.label}\r\n          labelClasses={item.labelClasses ?? this.labelClasses}\r\n          disabled={this.disabled || item.disabled}\r\n          checked={item.checked}\r\n          isSwitch={this.isSwitch}\r\n          isInline={this.isInline}\r\n          onValueChanged={ev => {\r\n            if (ev.detail) {\r\n              this.check(item);\r\n            } else {\r\n              this.uncheck(item);\r\n            }\r\n          }}\r\n        ></storm-checkbox>\r\n      );\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return <Host>{this.dataSetRender()}</Host>;\r\n  }\r\n}\r\n\r\nexport interface ICheckboxItem {\r\n  id?: string;\r\n  label: string;\r\n  labelClasses?: string;\r\n  checked?: boolean;\r\n  disabled?: boolean;\r\n}\r\n",":host {\r\n  display: block;\r\n}","import { Component, Element, Event, EventEmitter, h, Host, Prop, Watch } from '@stencil/core';\r\nimport type { FetchOption } from '../../utils/fetch-data-source/interface';\r\n\r\n@Component({\r\n  tag: 'storm-dropdown-tree',\r\n  styleUrl: 'storm-dropdown-tree.css',\r\n  shadow: false,\r\n})\r\nexport class StormDropdownTree {\r\n  private _dropdownRef: HTMLStormDropdownElement;\r\n  private _treeRef: HTMLStormTreeViewElement;\r\n  private _text: string;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop({ mutable: true }) label: string;\r\n  @Prop({ mutable: true }) heading: string;\r\n  @Prop({ mutable: true }) text?: string;\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop({ mutable: true }) dataSet?: object | object[];\r\n  @Prop({ mutable: true }) dataSource?: FetchOption | Function | string;\r\n  @Prop({ mutable: true }) disabled?: boolean;\r\n  @Prop() nullable: boolean = false;\r\n  @Prop() fieldId: string = 'id';\r\n  @Prop() fieldLabel: string = 'label';\r\n  @Prop() fieldChildren: string = 'children';\r\n  @Prop() expandLevel: number = 2;\r\n  @Prop() nodeSelectableRule?: string | Function;\r\n  @Prop() size: 'Default' | 'Small' = 'Default';\r\n  @Prop() partialLoad: boolean = false;\r\n  @Prop() loading: 'eager' | 'lazy' = 'lazy';\r\n  @Prop() class: Record<string, boolean> | string;\r\n\r\n  @Prop({ mutable: true }) valid?: boolean;\r\n  @Prop() required?: boolean;\r\n\r\n  @Prop({ mutable: true }) searchText?: string;\r\n  @Prop() searchable: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() textChanged: EventEmitter<string>;\r\n  @Event() searchChanged: EventEmitter<string>;\r\n\r\n  @Watch('value')\r\n  valueWatcher() {\r\n    this.updateValue();\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  @Watch('text')\r\n  textWatcher() {\r\n    this.textChanged.emit(this.text);\r\n  }\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher() {\r\n    this._treeRef.dataSet = this.dataSet;\r\n  }\r\n\r\n  updateValue() {\r\n    if (this._treeRef.value != this.value) this._treeRef.value = this.value;\r\n    if (this._dropdownRef.value != this.value) this._dropdownRef.value = this.value;\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.updateValue();\r\n  }\r\n\r\n  renderTree() {\r\n    return (\r\n      <storm-tree-view\r\n        ref={elm => (this._treeRef = elm)}\r\n        partialLoad={this.partialLoad}\r\n        loading={this.loading}\r\n        value={this.value}\r\n        class={this.class}\r\n        dataSet={this.dataSet}\r\n        dataSource={this.dataSource}\r\n        fieldId={this.fieldId}\r\n        fieldLabel={this.fieldLabel}\r\n        fieldChildren={this.fieldChildren}\r\n        nullable={this.nullable}\r\n        selection={this.selection}\r\n        expandLevel={this.expandLevel}\r\n        nodeSelectableRule={this.nodeSelectableRule}\r\n        searchable={this.searchable}\r\n        onValueChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.value = ev.detail;\r\n        }}\r\n        onNodeClick={async ev => {\r\n          ev.stopPropagation();\r\n          await this._dropdownRef.hide();\r\n        }}\r\n        onSearchChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.searchChanged.emit(ev.detail);\r\n        }}\r\n      ></storm-tree-view>\r\n    );\r\n  }\r\n\r\n  async componentWillRender() {\r\n    this._text = this.text;\r\n    if (this._text == null) {\r\n      if (this._treeRef && this.value) {\r\n        const values = Array.isArray(this.value) ? this.value : [this.value];\r\n        const texts = [];\r\n        for (const value of values) {\r\n          const node = await this._treeRef.getNodeById(value);\r\n          if (node) {\r\n            texts.push(await this._treeRef.getLabel(node));\r\n          }\r\n        }\r\n        this._text = texts.join('、');\r\n      } else {\r\n        this._text = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <storm-dropdown\r\n          ref={elm => (this._dropdownRef = elm)}\r\n          nullable={this.nullable}\r\n          heading={this.heading}\r\n          label={this.label}\r\n          text={this._text}\r\n          value={this.value}\r\n          showSelected={true}\r\n          valid={this.valid}\r\n          required={this.required}\r\n          disabled={this.disabled}\r\n          timeStamp={this.timeStamp}\r\n          type=\"select\"\r\n          onValueChanged={ev => {\r\n            ev.stopPropagation();\r\n            this.value = ev.detail;\r\n            if (this.value == null) {\r\n              this.text = undefined;\r\n            }\r\n          }}\r\n          onUnselectedAll={async ev => {\r\n            ev.stopPropagation();\r\n            await this._treeRef.unselectAll();\r\n          }}\r\n          onShowMenu={async ev => {\r\n            ev.stopPropagation();\r\n            await this._treeRef.loadDataSet();\r\n            if (this.searchable && this._treeRef) {\r\n              requestAnimationFrame(async () => {\r\n                await this._treeRef.setSearchFocus();\r\n              });\r\n            }\r\n          }}\r\n        >\r\n          {this.renderTree()}\r\n        </storm-dropdown>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n}\r\n\r\n:host storm-button,\r\n:host storm-dropdown,\r\n:host div {\r\n  vertical-align: middle;\r\n}\r\n\r\n\r\n:host .btn:hover:not(.active) {\r\n  color: white;\r\n}\r\n\r\n:host .btn.btn-outline-primary:hover {\r\n  background-color: #e91e63;\r\n}\r\n\r\n:host .btn.disabled {\r\n  color: #7b809a;\r\n  border-color: #7b809a;\r\n  cursor: not-allowed;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, h } from '@stencil/core';\r\nimport type { ConditionInterface, ListItemInterface } from '../../../utils/interface';\r\nimport { calculateObjectValue, evaluateConditions, getFieldValue, isConditions } from '../../../utils/utils';\r\nimport type { ToolbarItemInterface } from '../../storm-toolbar/interface';\r\nimport type { TableColumnInterface } from '../interface';\r\nimport type { StormTable } from '../storm-table';\r\nimport type { ClickActionDetail } from '../storm-table-toolbar/interface';\r\n\r\n@Component({\r\n  tag: 'storm-table-toolbar',\r\n  styleUrl: 'storm-table-toolbar.css',\r\n  shadow: false,\r\n})\r\nexport class StormTableToolbar {\r\n  private _dateSet: ToolbarItemInterface[];\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() table: StormTable;\r\n  @Prop() column: TableColumnInterface;\r\n  @Prop() row: object;\r\n  @Prop() isDynamicLabel: boolean = true;\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n\r\n  @Event() clickAction: EventEmitter<ClickActionDetail>;\r\n\r\n  componentWillRender() {\r\n    this._dateSet = this.column.buttons?.map(x => {\r\n      const item: ToolbarItemInterface = {\r\n        id: x.id,\r\n        type: x.type,\r\n        label: x.label,\r\n        tooltip: x.tooltip,\r\n        icon: x.icon,\r\n        size: 'sm',\r\n        buttonStyle: 'outline-primary',\r\n        rounded: true,\r\n        visible: () => {\r\n          if (isConditions(x.visible)) {\r\n            return evaluateConditions(x.visible as ConditionInterface[], this.row);\r\n          }\r\n          return calculateObjectValue(this, x.visible, this.row, this.table, getFieldValue(this.row, this.table.fieldIndex)) ?? true;\r\n        },\r\n        disabled: () => {\r\n          if (isConditions(x.disabled)) {\r\n            return evaluateConditions(x.disabled as ConditionInterface[], this.row);\r\n          }\r\n          return calculateObjectValue(this, x.disabled, this.row, this.table, getFieldValue(this.row, this.table.fieldIndex)) ?? false;\r\n        },\r\n        items: x.items\r\n          ? x.items.map(\r\n              y =>\r\n                ({\r\n                  id: y.id,\r\n                  title: y.title,\r\n                  icon: y.icon,\r\n                  selected: y.selected,\r\n                  visible: () => {\r\n                    if (isConditions(y.visible)) {\r\n                      return evaluateConditions(y.visible as ConditionInterface[], this.row);\r\n                    }\r\n                    return calculateObjectValue(this, y.visible, this.row, this.table, getFieldValue(this.row, this.table.fieldIndex)) ?? true;\r\n                  },\r\n                  disabled: () => {\r\n                    if (isConditions(y.disabled)) {\r\n                      return evaluateConditions(y.disabled as ConditionInterface[], this.row);\r\n                    }\r\n                    return calculateObjectValue(this, y.disabled, this.row, this.table, getFieldValue(this.row, this.table.fieldIndex)) ?? false;\r\n                  },\r\n                } as ListItemInterface),\r\n            )\r\n          : null,\r\n        click: (_: ToolbarItemInterface, dropdownItem: ListItemInterface = null) => {\r\n          if (x.action) x.action(this.row, x, this.table, dropdownItem);\r\n          this.clickAction.emit({\r\n            id: getFieldValue(this.row, this.table.fieldId) as string,\r\n            field: this.column.field,\r\n            actionId: x.id,\r\n            dropdownItemId: dropdownItem ? dropdownItem.id : null,\r\n          });\r\n        },\r\n      } as ToolbarItemInterface;\r\n      return item;\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <storm-toolbar\r\n          class={{\r\n            'storm-dynamic-label': this.isDynamicLabel,\r\n            'justify-content-start': this.column.align === 'left',\r\n            'justify-content-center': this.column.align === 'center',\r\n            'justify-content-end': this.column.align === 'right',\r\n          }}\r\n          dataSet={this._dateSet}\r\n          timeStamp={this.timeStamp}\r\n        ></storm-toolbar>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\n    display: block;\n}","import { Component, Event, EventEmitter, h, Prop } from '@stencil/core';\r\nimport type { ListItemInterface } from '../../utils/interface';\r\nimport { createFunctionFromString, isModuleFunctionString, parseClassNames } from '../../utils/utils';\r\nimport type { ToolbarItemInterface } from './interface';\r\n\r\n@Component({\r\n  tag: 'storm-toolbar',\r\n  styleUrl: 'storm-toolbar.css',\r\n  shadow: false,\r\n})\r\nexport class StormToolbar {\r\n  @Prop() dataSet: ToolbarItemInterface[];\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n  @Prop({ mutable: true }) class: Record<string, boolean> | string;\r\n\r\n  @Event() toolbarAction: EventEmitter<string>;\r\n\r\n  renderToolbarItem(item: ToolbarItemInterface) {\r\n    if (typeof item.visible === 'function' && !item.visible()) return;\r\n    if (typeof item.visible === 'boolean' && !item.visible) return;\r\n    if (item.type === 'group') {\r\n      return this.renderDropdown(item);\r\n    } else if (item.type === 'divider') {\r\n      return (\r\n        <div class=\"d-inline-flex align-middle mx-2\">\r\n          <div class=\"vr\"></div>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <storm-toolbar-item\r\n          dataSet={item}\r\n          onToolbarAction={e => {\r\n            this.handleAction(e, item);\r\n          }}\r\n        ></storm-toolbar-item>\r\n      );\r\n    }\r\n  }\r\n\r\n  handleAction(_: Event, item: ToolbarItemInterface, dropdownItem: ListItemInterface = null) {\r\n    if (!item.click) return;\r\n    if (typeof item.click === 'string') {\r\n      if (!isModuleFunctionString(item.click)) {\r\n        throw new Error('Invalid function string');\r\n      }\r\n      item.click = createFunctionFromString(item.click);\r\n    }\r\n    item.click(item, dropdownItem);\r\n    this.toolbarAction.emit(dropdownItem ? dropdownItem.id : item.id);\r\n  }\r\n\r\n  renderDropdown(item: ToolbarItemInterface) {\r\n    if (!item || !item.items || item.items.length === 0) return;\r\n    return (\r\n      <div class=\"d-inline-flex align-middle\">\r\n        <storm-dropdown\r\n          dataSet={item.items}\r\n          trigger=\"click\"\r\n          toggleIcon=\"more_vert\"\r\n          type=\"none\"\r\n          selection=\"none\"\r\n          nullable={true}\r\n          showSelected={false}\r\n          onItemClick={e => {\r\n            this.handleAction(e, item, e.detail);\r\n          }}\r\n        ></storm-dropdown>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!this.dataSet) return;\r\n    return (\r\n      <div class=\"w-100\">\r\n        <div class={{ 'd-flex': true, ...parseClassNames(this.class) }}>\r\n          {this.dataSet.map(x => {\r\n            return this.renderToolbarItem(x);\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import type { CacheEntry, ICacheProvider } from './interface';\r\n\r\nconst DB_NAME = 'UnifiedCacheDB';\r\nconst STORE_NAME = 'cache';\r\nconst DB_VERSION = 1;\r\n\r\n/**\r\n * IndexedDB 快取 (IndexedDBCache) 的實作，\r\n * 底層以 IndexedDB 做資料儲存，keyPath 為 'key'，value 為 CacheEntry 內容\r\n */\r\nexport class IndexedDBCache implements ICacheProvider {\r\n    private dbPromise: Promise<IDBDatabase> | null = null;\r\n    private isSupported: boolean | null = null;\r\n\r\n    /**\r\n     * 檢查 IndexedDB 是否可用\r\n     */\r\n    private checkSupport(): boolean {\r\n        if (this.isSupported === null) {\r\n            this.isSupported = !!(typeof window !== 'undefined' && window.indexedDB);\r\n        }\r\n        return this.isSupported;\r\n    }\r\n\r\n    /**\r\n     * 取得已開啟的 IndexedDB 連線，若是首次開啟會建立 object store\r\n     * 使用連線快取避免重複開啟資料庫\r\n     */\r\n    private openDB(): Promise<IDBDatabase> {\r\n        if (!this.checkSupport()) {\r\n            return Promise.reject(new Error('IndexedDB is not supported'));\r\n        }\r\n\r\n        if (!this.dbPromise) {\r\n            this.dbPromise = new Promise((resolve, reject) => {\r\n                const request = window.indexedDB.open(DB_NAME, DB_VERSION);\r\n                \r\n                request.onupgradeneeded = (event) => {\r\n                    const db = (event.target as IDBOpenDBRequest).result;\r\n                    if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n                        db.createObjectStore(STORE_NAME, { keyPath: 'key' });\r\n                    }\r\n                };\r\n                \r\n                request.onsuccess = (event) => {\r\n                    const db = (event.target as IDBOpenDBRequest).result;\r\n                    \r\n                    // 監聽資料庫關閉事件，重置快取的連線\r\n                    db.onclose = () => {\r\n                        this.dbPromise = null;\r\n                    };\r\n                    \r\n                    // 監聽版本變更事件\r\n                    db.onversionchange = () => {\r\n                        db.close();\r\n                        this.dbPromise = null;\r\n                    };\r\n                    \r\n                    resolve(db);\r\n                };\r\n                \r\n                request.onerror = (event) => {\r\n                    this.dbPromise = null;\r\n                    reject((event.target as IDBOpenDBRequest).error);\r\n                };\r\n                \r\n                request.onblocked = () => {\r\n                    console.warn('IndexedDB connection is blocked');\r\n                };\r\n            });\r\n        }\r\n        \r\n        return this.dbPromise;\r\n    }\r\n\r\n    /**\r\n     * 安全執行資料庫操作，自動處理錯誤和資源清理\r\n     */\r\n    private async withTransaction<T>(\r\n        mode: IDBTransactionMode,\r\n        operation: (store: IDBObjectStore, tx: IDBTransaction) => Promise<T> | T\r\n    ): Promise<T> {\r\n        const db = await this.openDB();\r\n        \r\n        return new Promise((resolve, reject) => {\r\n            const tx = db.transaction(STORE_NAME, mode);\r\n            const store = tx.objectStore(STORE_NAME);\r\n            \r\n            let operationCompleted = false;\r\n            \r\n            tx.oncomplete = () => {\r\n                if (!operationCompleted) {\r\n                    resolve(undefined as T);\r\n                }\r\n            };\r\n            \r\n            tx.onerror = (event) => {\r\n                const error = (event.target as IDBRequest).error || new Error('Transaction failed');\r\n                reject(error);\r\n            };\r\n            \r\n            tx.onabort = (event) => {\r\n                const error = (event.target as IDBRequest).error || new Error('Transaction aborted');\r\n                reject(error);\r\n            };\r\n            \r\n            try {\r\n                const result = operation(store, tx);\r\n                if (result instanceof Promise) {\r\n                    result.then(\r\n                        (value) => {\r\n                            operationCompleted = true;\r\n                            resolve(value);\r\n                        },\r\n                        (error) => {\r\n                            tx.abort();\r\n                            reject(error);\r\n                        }\r\n                    );\r\n                } else {\r\n                    operationCompleted = true;\r\n                    resolve(result);\r\n                }\r\n            } catch (error) {\r\n                tx.abort();\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    async get(key: string): Promise<CacheEntry | null> {\r\n        return this.withTransaction('readonly', (store) => {\r\n            return new Promise<CacheEntry | null>((resolve, reject) => {\r\n                const req = store.get(key);\r\n                \r\n                req.onsuccess = async (evt) => {\r\n                    const record: (CacheEntry & { key: string }) | undefined = (evt.target as IDBRequest).result;\r\n                    if (!record) {\r\n                        resolve(null);\r\n                        return;\r\n                    }\r\n                    \r\n                    const now = Date.now();\r\n                    // 若過期，自動刪除並回傳 null\r\n                    if (typeof record.timestamp === 'number' && \r\n                        typeof record.expiredMillis === 'number' && \r\n                        now - record.timestamp >= record.expiredMillis) {\r\n                        \r\n                        // 非同步刪除過期項目，不阻塞當前讀取操作\r\n                        this.delete(key).catch(console.error);\r\n                        resolve(null);\r\n                    } else {\r\n                        resolve({\r\n                            value: record.value,\r\n                            timestamp: record.timestamp,\r\n                            expiredMillis: record.expiredMillis,\r\n                        });\r\n                    }\r\n                };\r\n                \r\n                req.onerror = (evt) => {\r\n                    reject((evt.target as IDBRequest).error);\r\n                };\r\n            });\r\n        });\r\n    }\r\n\r\n    async set(key: string, entry: CacheEntry): Promise<void> {\r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                const req = store.put({ key, ...entry });\r\n                req.onsuccess = () => resolve();\r\n                req.onerror = (evt) => reject((evt.target as IDBRequest).error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async delete(key: string): Promise<void> {\r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                const req = store.delete(key);\r\n                req.onsuccess = () => resolve();\r\n                req.onerror = (evt) => reject((evt.target as IDBRequest).error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                const req = store.clear();\r\n                req.onsuccess = () => resolve();\r\n                req.onerror = (evt) => reject((evt.target as IDBRequest).error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async deleteByPrefix(prefix: string): Promise<void> {\r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                // 使用 IDBKeyRange 優化效能，限制搜尋範圍\r\n                const range = IDBKeyRange.bound(\r\n                    prefix,\r\n                    prefix + '\\uffff',\r\n                    false,\r\n                    true\r\n                );\r\n                \r\n                const req = store.openCursor(range);\r\n                const keysToDelete: string[] = [];\r\n                \r\n                req.onsuccess = (event) => {\r\n                    const cursor = (event.target as IDBRequest<IDBCursorWithValue>).result;\r\n                    if (cursor) {\r\n                        const key = cursor.key.toString();\r\n                        if (key.startsWith(prefix)) {\r\n                            keysToDelete.push(key);\r\n                        }\r\n                        cursor.continue();\r\n                    } else {\r\n                        // 批次刪除提升效能\r\n                        if (keysToDelete.length > 0) {\r\n                            this.batchDelete(keysToDelete).then(\r\n                                () => resolve(),\r\n                                (error) => reject(error)\r\n                            );\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    }\r\n                };\r\n                \r\n                req.onerror = (event) => {\r\n                    reject((event.target as IDBRequest).error);\r\n                };\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 批次刪除多個鍵值，提升刪除效能\r\n     */\r\n    async batchDelete(keys: string[]): Promise<void> {\r\n        if (keys.length === 0) return;\r\n        \r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                let completed = 0;\r\n                let hasError = false;\r\n                \r\n                const checkCompletion = () => {\r\n                    if (completed === keys.length && !hasError) {\r\n                        resolve();\r\n                    }\r\n                };\r\n                \r\n                for (const key of keys) {\r\n                    const req = store.delete(key);\r\n                    req.onsuccess = () => {\r\n                        completed++;\r\n                        checkCompletion();\r\n                    };\r\n                    req.onerror = (evt) => {\r\n                        if (!hasError) {\r\n                            hasError = true;\r\n                            reject((evt.target as IDBRequest).error);\r\n                        }\r\n                    };\r\n                }\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 批次設定多個項目，提升寫入效能\r\n     */\r\n    async batchSet(entries: Array<{ key: string; entry: CacheEntry }>): Promise<void> {\r\n        if (entries.length === 0) return;\r\n        \r\n        return this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                let completed = 0;\r\n                let hasError = false;\r\n                \r\n                const checkCompletion = () => {\r\n                    if (completed === entries.length && !hasError) {\r\n                        resolve();\r\n                    }\r\n                };\r\n                \r\n                for (const { key, entry } of entries) {\r\n                    const req = store.put({ key, ...entry });\r\n                    req.onsuccess = () => {\r\n                        completed++;\r\n                        checkCompletion();\r\n                    };\r\n                    req.onerror = (evt) => {\r\n                        if (!hasError) {\r\n                            hasError = true;\r\n                            reject((evt.target as IDBRequest).error);\r\n                        }\r\n                    };\r\n                }\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * 清理資源，關閉資料庫連線\r\n     */\r\n    async close(): Promise<void> {\r\n        if (this.dbPromise) {\r\n            try {\r\n                const db = await this.dbPromise;\r\n                db.close();\r\n            } catch (error) {\r\n                console.error('Error closing IndexedDB:', error);\r\n            } finally {\r\n                this.dbPromise = null;\r\n            }\r\n        }\r\n    }\r\n}","\r\nimport { CacheService } from '../cache/cache-service';\r\nimport { IndexedDBCache } from '../cache/indexed-db-cache';\r\nimport type { FetchOption } from './interface';\r\n\r\nconst cacheService = new CacheService(new IndexedDBCache(), {\r\n    regionName: 'fetchDataSource',\r\n});\r\n\r\nexport async function fetchDataSource(options: FetchOption): Promise<any> {\r\n    // 1. 合併預設值\r\n    options = {\r\n        method: 'POST',\r\n        contentType: 'application/json',\r\n        ...options,\r\n    };\r\n\r\n    // 2. 以 JSON.stringify(options) 當作單筆快取的 key\r\n    const key = JSON.stringify(options);\r\n\r\n    // 3. 嘗試從快取讀取 (使用預設 region)\r\n    const cached = await cacheService.get<any>(key);\r\n    if (cached !== null) {\r\n        return cached;\r\n    }\r\n\r\n    // 4. 快取不存在或已過期，真正執行 fetch\r\n    const response = await fetch(options.url, {\r\n        method: options.method,\r\n        body: options.method !== 'GET' ? JSON.stringify(options.body ?? {}) : null,\r\n        headers: new Headers({\r\n            'Content-Type': options.contentType,\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error(`Network response was not ok: ${response.statusText}`);\r\n    }\r\n\r\n    const data =\r\n        options.contentType === 'application/json'\r\n            ? await response.json()\r\n            : await response.text();\r\n\r\n    // 5. 把新資料寫回快取 (使用預設 region)\r\n    await cacheService.set(key, data);\r\n\r\n    return data;\r\n}\r\n",":host {\r\n    display: block;\r\n    background-color: #fff;\r\n}\r\n\r\n:host .list-group-item {\r\n    border: none !important;\r\n    white-space: nowrap !important;\r\n    cursor: pointer !important;\r\n    margin-bottom: 0 !important;\r\n}\r\n\r\n:host .close.material-icons,\r\n:host .open.material-icons:hover {\r\n    opacity: 0.5;\r\n}\r\n\r\n:host .open.material-icons,\r\n:host .close.material-icons:hover {\r\n    opacity: 1;\r\n}\r\n\r\n:host .material-icons:empty {\r\n    width: 1.25rem;\r\n}\r\n\r\n:host .indent {\r\n    margin-left: 0.575rem;\r\n    margin-right: 0.575rem;\r\n}\r\n\r\n:host .leaf {\r\n    margin-left: 0.6rem;\r\n}","import { Component, Element, Event, EventEmitter, forceUpdate, h, Host, Listen, Method, Prop, Watch } from '@stencil/core';\r\nimport { fetchDataSource } from '../../utils/fetch-data-source/fetch-data-source';\r\nimport type { FetchOption } from '../../utils/fetch-data-source/interface';\r\nimport { FnSearchInput } from '../../utils/functional/functional';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\nimport { appendHighlight, calculateObjectValue, createFunctionFromString, debounce, getFieldValue, isModuleFunctionString, setFieldValue } from '../../utils/utils';\r\nimport type { StormTreeNode } from './storm-tree-node/storm-tree-node';\r\n\r\n@Component({\r\n  tag: 'storm-tree-view',\r\n  styleUrl: 'storm-tree-view.css',\r\n  shadow: true,\r\n})\r\nexport class StormTreeView {\r\n  private _searchText?: string;\r\n  private _dataSet?: object[];\r\n  private _items?: object[];\r\n  private _dataSource?: FetchOption | Function;\r\n  private _searchRef: HTMLStormInputGroupElement;\r\n  private _nodeSelectableRule?: Function;\r\n  private _nodeCheckRule?: Function;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() partialLoad: boolean = false;\r\n  @Prop() loading: 'eager' | 'lazy' = 'eager';\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop({ mutable: true }) checked: string[] = [];\r\n\r\n  @Prop() fieldId: string = 'id';\r\n  @Prop() fieldLabel: string = 'label';\r\n  @Prop() fieldChildren: string = 'children';\r\n\r\n  @Prop() fieldSubId: string = 'subId';\r\n  @Prop() fieldSubLabel: string = 'subLabel';\r\n  @Prop() fieldSubChildren: string = 'subChildren';\r\n\r\n  @Prop() fieldSelected: string = '_selected';\r\n  @Prop() fieldChecked: string = '_checked';\r\n  @Prop() fieldExpanded: string = '_expanded';\r\n  @Prop() fieldDisabled: string = '_disabled';\r\n  @Prop() fieldParent: string = '_parent';\r\n  @Prop() fieldSelectable: string = '_selectable';\r\n  @Prop() fieldCheckSelectable: string = '_checkSelectable';\r\n  @Prop() fieldIcon: string = '_icon';\r\n  @Prop() fieldHref: string = '_href';\r\n  @Prop() fieldLevel: string = '_level';\r\n  @Prop() fieldChildLoaded: string = '_loaded';\r\n  @Prop() fieldElement: string = '_element';\r\n\r\n  @Prop({ mutable: true }) expandIconAlign: 'left' | 'right' = 'left';\r\n  @Prop({ mutable: true }) expandIcon?: string;\r\n  @Prop({ mutable: true }) collapseIcon?: string;\r\n  @Prop() color?: string;\r\n\r\n  @Prop({ mutable: true }) dataSet?: object | object[];\r\n  @Prop({ mutable: true }) dataSource?: FetchOption | Function | string;\r\n  @Prop({ mutable: true }) fetch?: Function;\r\n  @Prop() nullable: boolean = true;\r\n  @Prop({ mutable: true }) expandLevel: number = 2;\r\n  @Prop() structure: 'tree' | 'array' | 'auto' = 'auto';\r\n  @Prop() searchable: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n  @Prop({ mutable: true }) nodeSelectableRule?: string | Function;\r\n  @Prop() checkSelectable: boolean = false;\r\n  @Prop({ mutable: true }) nodeCheckRule?: string | Function;\r\n  @Prop({ mutable: true }) selectToCheck: boolean = true;\r\n\r\n  @Event() dateSetLoaded: EventEmitter;\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() nodeSelect: EventEmitter<string>;\r\n  @Event() nodeUnselect: EventEmitter<string>;\r\n  @Event() nodeClick: EventEmitter<string>;\r\n  @Event() nodeDblClick: EventEmitter<string>;\r\n  @Event() nodeCheck: EventEmitter<string>;\r\n  @Event() nodeUncheck: EventEmitter<string>;\r\n  @Event() checkedChanged: EventEmitter<string[]>;\r\n\r\n  @Event() searchChanged: EventEmitter<string>;\r\n  @Event() keydown: EventEmitter<KeyboardEvent>;\r\n\r\n  @Listen('searchChanged')\r\n  async searchChangedHandler(ev: CustomEvent<string>) {\r\n    this._searchText = ev.detail;\r\n    if (this.partialLoad) {\r\n      this.cleanNodes();\r\n      await this.loadDataSet();\r\n    } else {\r\n      this.rerender();\r\n    }\r\n  }\r\n\r\n  @Listen('nodeSelect')\r\n  nodeSelectHandler(ev: CustomEvent<string>) {\r\n    switch (this.selection) {\r\n      case 'single':\r\n        this.value = ev.detail;\r\n        break;\r\n      case 'multiple': {\r\n        const currentValue = Array.isArray(this.value) ? this.value : this.value ? [this.value] : [];\r\n        if (!currentValue.includes(ev.detail)) this.value = [...currentValue, ev.detail];\r\n        break;\r\n      }\r\n      default:\r\n        console.warn(`Unknown selection mode: ${this.selection}`);\r\n    }\r\n  }\r\n\r\n  @Listen('nodeUnselect')\r\n  nodeUnselectHandler(ev: CustomEvent<string>) {\r\n    switch (this.selection) {\r\n      case 'single':\r\n        if (this.value === ev.detail) {\r\n          this.value = null;\r\n        }\r\n        break;\r\n      case 'multiple': {\r\n        const currentValue = Array.isArray(this.value) ? this.value : [];\r\n        if (currentValue.includes(ev.detail)) this.value = currentValue.filter(id => id !== ev.detail);\r\n        break;\r\n      }\r\n      default:\r\n        console.warn(`Unknown selection mode: ${this.selection}`);\r\n    }\r\n  }\r\n\r\n  @Listen('nodeCheck')\r\n  nodeCheckHandler(ev: CustomEvent<string>) {\r\n    if (this.selectToCheck) return;\r\n    if (!this.checked.includes(ev.detail)) this.checked = [...this.checked, ev.detail];\r\n  }\r\n\r\n  @Listen('nodeUncheck')\r\n  nodeUncheckHandler(ev: CustomEvent<string>) {\r\n    if (this.selectToCheck) return;\r\n    if (this.checked.includes(ev.detail)) this.checked = this.checked.filter(id => id !== ev.detail);\r\n  }\r\n\r\n  @Listen('valueChanged')\r\n  async valueChangedHandler(): Promise<void> {\r\n    if (!Array.isArray(this._items)) return;\r\n\r\n    const valueArray = Array.isArray(this.value) ? this.value : this.value ? [this.value] : [];\r\n\r\n    await Promise.all(\r\n      this._items.map(async item => {\r\n        const id = String(getFieldValue(item, this.fieldId) as string);\r\n        const shouldSelect = valueArray.includes(id);\r\n        const selected = (getFieldValue(item, this.fieldSelected) as boolean) === true;\r\n\r\n        const promises: Promise<void>[] = [];\r\n        if (shouldSelect) {\r\n          promises.push(this.setNodeExpanded(item));\r\n        }\r\n\r\n        if (selected !== shouldSelect) {\r\n          promises.push(this.setNodeSelectionState(item, shouldSelect));\r\n        }\r\n\r\n        return Promise.all(promises);\r\n      }),\r\n    );\r\n\r\n    if (this.checkSelectable && this.selectToCheck) {\r\n      this.checked = valueArray;\r\n    }\r\n  }\r\n\r\n  @Listen('checkedChanged')\r\n  async checkedChangedHandler(): Promise<void> {\r\n    if (!Array.isArray(this._items)) return;\r\n\r\n    await Promise.all(\r\n      this._items.map(item => {\r\n        const id = String(getFieldValue(item, this.fieldId) as string);\r\n        const checkedArray = Array.isArray(this.checked) ? this.checked : this.checked ? [this.checked] : [];\r\n        const shouldChecked = checkedArray.includes(id);\r\n        const checked = (getFieldValue(item, this.fieldChecked) as boolean) === true;\r\n\r\n        if (checked !== shouldChecked) {\r\n          return this.setNodeCheckedState(item, shouldChecked);\r\n        }\r\n        return Promise.resolve();\r\n      }),\r\n    );\r\n  }\r\n\r\n  @Watch('value')\r\n  async watchValueHandler() {\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  @Watch('checked')\r\n  async watchCheckedHandler() {\r\n    this.checkedChanged.emit(this.checked);\r\n  }\r\n\r\n  async setNodeSelectionState(item: object, shouldSelect: boolean): Promise<void> {\r\n    const node = await this.getTreeNode(item);\r\n\r\n    if (node) {\r\n      await (shouldSelect ? node.select() : node.unselect());\r\n    } else {\r\n      setFieldValue(item, this.fieldSelected, shouldSelect);\r\n    }\r\n    if (this.checkSelectable && this.selectToCheck) {\r\n      await this.setNodeCheckedState(item, shouldSelect);\r\n    }\r\n  }\r\n\r\n  async setNodeCheckedState(item: object, shouldChecked: boolean): Promise<void> {\r\n    const node = await this.getTreeNode(item);\r\n\r\n    if (node) {\r\n      await (shouldChecked ? node.check() : node.uncheck());\r\n    } else {\r\n      setFieldValue(item, this.fieldChecked, shouldChecked);\r\n    }\r\n  }\r\n\r\n  @Watch('dataSource')\r\n  watchDataSourceHandler() {\r\n    this.cleanNodes();\r\n    if (typeof this.dataSource === 'string') {\r\n      if (isModuleFunctionString(this.dataSource)) {\r\n        this._dataSource = createFunctionFromString(this.dataSource);\r\n      } else if (this.dataSource.startsWith('{') && this.dataSource.endsWith('}')) {\r\n        this._dataSource = JSON.parse(this.dataSource) as FetchOption;\r\n      } else {\r\n        this._dataSource = { url: this.dataSource } as FetchOption;\r\n      }\r\n    } else {\r\n      this._dataSource = this.dataSource;\r\n    }\r\n  }\r\n\r\n  @Watch('nodeSelectableRule')\r\n  watchNodeSelectableRuleHandler() {\r\n    if (typeof this.nodeSelectableRule === 'string') {\r\n      if (isModuleFunctionString(this.nodeSelectableRule)) {\r\n        this._nodeSelectableRule = createFunctionFromString(this.nodeSelectableRule);\r\n      }\r\n    } else {\r\n      this._nodeSelectableRule = this.nodeSelectableRule;\r\n    }\r\n  }\r\n\r\n  @Watch('nodeCheckRule')\r\n  watchNodeCheckRuleHandler() {\r\n    if (typeof this.nodeCheckRule === 'string') {\r\n      if (isModuleFunctionString(this.nodeCheckRule)) {\r\n        this._nodeCheckRule = createFunctionFromString(this.nodeCheckRule);\r\n      }\r\n    } else {\r\n      this._nodeCheckRule = this.nodeCheckRule;\r\n    }\r\n  }\r\n\r\n  @Watch('dataSet')\r\n  async watchDataSetHandler() {\r\n    this.cleanNodes();\r\n    await this.watchValueHandler();\r\n    await this.watchCheckedHandler();\r\n  }\r\n\r\n  @Method()\r\n  async getNodeById(id: string): Promise<object | null> {\r\n    if (!this._items) return null;\r\n    return this._items.find(x => (getFieldValue(x, this.fieldId) as string) === id);\r\n  }\r\n\r\n  @Method()\r\n  async getTreeNode(item: object): Promise<HTMLStormTreeNodeElement> {\r\n    return getFieldValue(item, this.fieldElement) as HTMLStormTreeNodeElement;\r\n  }\r\n\r\n  @Method()\r\n  async getLabel(item: object): Promise<string> {\r\n    return getFieldValue(item, this.fieldLabel) as string;\r\n  }\r\n\r\n  @Method()\r\n  async unselectAll() {\r\n    this.value = null;\r\n  }\r\n\r\n  @Method()\r\n  async loadDataSet() {\r\n    if (this._dataSet) return;\r\n    if (this.dataSource || this.fetch) {\r\n      try {\r\n        const dataSet = await this.getDataSource();\r\n        this.setDataSet(dataSet);\r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n      }\r\n    } else {\r\n      this.setDataSet(this.dataSet);\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async getSelected(): Promise<object[]> {\r\n    return this._items.filter(node => getFieldValue(node, this.fieldSelected) as boolean);\r\n  }\r\n\r\n  @Method()\r\n  async getSelectedById(): Promise<string[]> {\r\n    return await this.getSelected().then(x => x.map(y => getFieldValue(y, this.fieldId) as string));\r\n  }\r\n\r\n  @Method()\r\n  async setSearchFocus() {\r\n    if (this.searchable && this._searchRef) {\r\n      await this._searchRef.setFocus();\r\n    }\r\n  }\r\n\r\n  private readonly rerender = debounce(async (): Promise<void> => {\r\n    if (!Array.isArray(this._items) || this._items.length === 0) return;\r\n    await Promise.all(\r\n      this._items.map(async item => {\r\n        const node = await this.getTreeNode(item);\r\n        if (node) {\r\n          forceUpdate(node);\r\n        }\r\n      }),\r\n    );\r\n    forceUpdate(this);\r\n  }, 100);\r\n\r\n  renderNode(item: object): StormTreeNode {\r\n    let content = getFieldValue(item, this.fieldLabel) as string;\r\n    if (content && this._searchText) {\r\n      content = appendHighlight(content, this._searchText);\r\n    }\r\n\r\n    return <storm-tree-node tree={this} dataSet={item} content={content} searchText={this._searchText}></storm-tree-node>;\r\n  }\r\n\r\n  async setNodeExpanded(item: object) {\r\n    let parent = getFieldValue(item, this.fieldParent) as object;\r\n    while (parent) {\r\n      const node = await this.getTreeNode(parent);\r\n      if (node) {\r\n        await node.expand().catch(error => {\r\n          console.error('Failed to expand tree node:', error);\r\n        });\r\n      } else {\r\n        setFieldValue(parent, this.fieldExpanded, true);\r\n      }\r\n\r\n      parent = getFieldValue(parent, this.fieldParent) as object;\r\n    }\r\n  }\r\n\r\n  cleanNodes() {\r\n    this._dataSet = undefined;\r\n    this._items = undefined;\r\n  }\r\n\r\n  async getDataSource(treeNode: StormTreeNode | null = null): Promise<any> {\r\n    if (this.fetch) {\r\n      return this.fetch(treeNode?.dataSet);\r\n    } else {\r\n      const options: FetchOption = typeof this._dataSource === 'function' ? this._dataSource(treeNode?.dataSet, this._searchText) : this._dataSource;\r\n      return await fetchDataSource(options);\r\n    }\r\n  }\r\n\r\n  async loadChild(treeNode: StormTreeNode) {\r\n    try {\r\n      const dataSource = await this.getDataSource(treeNode);\r\n      const dataSet = this.dataSetParse(dataSource);\r\n\r\n      await this.mergeChild(\r\n        dataSet,\r\n        this.fieldChildren.split('&').map(x => x.trim()),\r\n      );\r\n      setFieldValue(treeNode.dataSet, this.fieldChildLoaded, true);\r\n\r\n      this._items = this.updateItems(this._dataSet);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    }\r\n  }\r\n\r\n  async mergeChild(source: any, fieldChildren: string[]): Promise<void> {\r\n    for (const item of source) {\r\n      const dest = await this.getNodeById(getFieldValue(item, this.fieldId) as string);\r\n\r\n      for (const part of fieldChildren) {\r\n        const sourcePartValue = getFieldValue(item, part) as object[];\r\n        const destPartValue = getFieldValue(dest, part) as object[];\r\n\r\n        if (!!sourcePartValue && (!destPartValue || destPartValue.length == 0)) {\r\n          setFieldValue(dest, part, sourcePartValue);\r\n        } else if (!!sourcePartValue && sourcePartValue.length > 0) {\r\n          await this.mergeChild(sourcePartValue, [part]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  dataSetParse(value: object | object[]): object[] {\r\n    const clonedValue = JSON.parse(JSON.stringify(value));\r\n    const structureType = this.structure === 'auto' ? (!Array.isArray(clonedValue) && !!this.fieldChildren ? 'tree' : 'array') : this.structure;\r\n\r\n    switch (structureType) {\r\n      case 'tree':\r\n        return getFieldValue(clonedValue, this.fieldChildren) as object[];\r\n      case 'array':\r\n        return clonedValue as object[];\r\n      default:\r\n        throw new Error(`Unsupported structure type: ${structureType}`);\r\n    }\r\n  }\r\n\r\n  setDataSet(value: object | object[]) {\r\n    if (!value) return;\r\n\r\n    this._dataSet = this.dataSetParse(value);\r\n    this._items = this.updateItems(this._dataSet);\r\n\r\n    this.rerender();\r\n  }\r\n\r\n  updateItems(value: object[], parent: object = null): object[] {\r\n    if (!value || value.length === 0) return [];\r\n\r\n    const items: object[] = [];\r\n    for (const item of value) {\r\n      let id = getFieldValue(item, this.fieldId) as string;\r\n      if (id == null) {\r\n        id = getFieldValue(item, this.fieldLabel) as string;\r\n        setFieldValue(item, this.fieldId, id);\r\n      }\r\n\r\n      if (this.selection != 'none' && item[this.fieldSelectable] == null) {\r\n        setFieldValue(item, this.fieldSelectable, calculateObjectValue(this, this._nodeSelectableRule, item) ?? true);\r\n      }\r\n      if (this.checkSelectable && item[this.fieldCheckSelectable] == null) {\r\n        setFieldValue(item, this.fieldCheckSelectable, calculateObjectValue(this, this._nodeCheckRule, item) ?? true);\r\n      }\r\n\r\n      let level: number = 1;\r\n      if (parent) {\r\n        setFieldValue(item, this.fieldParent, parent);\r\n        level = (getFieldValue(parent, this.fieldLevel) as number) + 1;\r\n      }\r\n\r\n      setFieldValue(item, this.fieldLevel, level);\r\n      if (!(getFieldValue(item, this.fieldChildLoaded) as boolean)) {\r\n        setFieldValue(item, this.fieldExpanded, this.expandLevel > level);\r\n        setFieldValue(item, this.fieldChildLoaded, !this.partialLoad || this.expandLevel > level);\r\n      }\r\n\r\n      items.push(item);\r\n\r\n      const children = getFieldValue(item, this.fieldChildren) as object[];\r\n      if (children && children.length > 0) {\r\n        items.push(...this.updateItems(children, item));\r\n      }\r\n    }\r\n\r\n    return items;\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n    this.expandIcon = this.expandIcon ?? (this.expandIconAlign === 'right' ? 'add' : 'chevron_right');\r\n    this.collapseIcon = this.collapseIcon ?? (this.expandIconAlign === 'right' ? 'remove' : 'expand_more');\r\n    this.watchDataSourceHandler();\r\n    this.watchNodeSelectableRuleHandler();\r\n    this.watchNodeCheckRuleHandler();\r\n  }\r\n\r\n  async componentWillRender() {\r\n    if (this.loading === 'eager' || !this.partialLoad) {\r\n      await this.loadDataSet();\r\n    }\r\n\r\n    if (this.selection != 'none' && !this.nullable && !this.value && this._items?.length) {\r\n      this.value = getFieldValue(\r\n        this._items.find(item => getFieldValue(item, this.fieldSelectable) as boolean),\r\n        this.fieldId,\r\n      ) as string;\r\n    }\r\n\r\n    await this.watchValueHandler();\r\n    await this.watchCheckedHandler();\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    if (this._items?.length) {\r\n      this.dateSetLoaded.emit();\r\n    }\r\n  }\r\n\r\n  handleSearchChanged(ev: CustomEvent<string>) {\r\n    ev.stopPropagation();\r\n    const value = ev.detail?.trim() ?? '';\r\n    if (this._searchText === value) return;\r\n    if (value) {\r\n      this.searchChanged.emit(value);\r\n    }\r\n  }\r\n\r\n  renderSearch() {\r\n    if (!this.searchable) return;\r\n    return <FnSearchInput ref={elm => (this._searchRef = elm)} value={this._searchText} onValueChanged={ev => this.handleSearchChanged(ev)} />;\r\n  }\r\n\r\n  nodesRender() {\r\n    let nodes: any[] = [];\r\n    if (this.partialLoad || !this.searchable || this._searchText == null || !this._searchText.length) {\r\n      nodes = this._dataSet;\r\n    } else {\r\n      nodes = this._items.filter(x => (getFieldValue(x, this.fieldLabel) as string).includes(this._searchText));\r\n    }\r\n    if (nodes.length === 0) return <div class=\"align-middle text-center p-4 h6\">沒有找到符合的結果</div>;\r\n    return nodes.map(item => this.renderNode(item));\r\n  }\r\n\r\n  render() {\r\n    if (!this._dataSet) return;\r\n\r\n    return (\r\n      <Host>\r\n        {this.renderSearch()}\r\n        {this.nodesRender()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}