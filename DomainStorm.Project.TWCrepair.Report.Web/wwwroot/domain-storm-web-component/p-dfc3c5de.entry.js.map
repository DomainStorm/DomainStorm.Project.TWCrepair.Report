{"version":3,"names":["stormSelectCss","StormSelect","_choices","_dataSet","_selectRef","label","value","name","dataSet","shouldSort","selection","removeItemButton","duplicateItemsAllowed","searchable","searchTimeOut","searchFilter","valueChanged","change","searchChange","dataSetWatcher","this","initDataSet","getAttribute","length","setChoices","clearStore","valueWatcher","newValue","getValue","Array","isArray","deepEqual","setChoiceByValue","emit","setSearch","debounce","initSelection","forEach","item","selected","includes","some","selectedItems","filter","map","from","host","querySelectorAll","o","querySelector","JSON","parse","id","title","handleFocused","async","e","target","parentElement","classList","add","handleFocusout","remove","handleKeyUp","componentWillLoad","labelRender","h","class","render","Host","key","onFocus","onFocusout","onKeyUp","ref","el","multiple","componentDidRender","Choices","searchEnabled","allowHTML","noChoicesText","noResultsText","searchPlaceholderValue","searchChoices","searchFloor","passedElement","element","addEventListener","preventDefault","stopPropagation","event","detail"],"sources":["src/components/storm-select/storm-select.css?tag=storm-select","src/components/storm-select/storm-select.tsx"],"sourcesContent":[".choices__list--dropdown,\r\n.choices__list[aria-expanded] {\r\n    z-index: 1030;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, Watch, h } from '@stencil/core';\r\nimport { debounce, deepEqual } from '@utils/utils';\r\nimport Choices from 'choices.js';\r\nimport type { Choice } from 'choices.js/src/scripts/interfaces/choice';\r\n\r\n@Component({\r\n  tag: 'storm-select',\r\n  styleUrl: 'storm-select.css',\r\n  shadow: false,\r\n})\r\nexport class StormSelect {\r\n  private _choices: Choices;\r\n  private _dataSet: Choice[];\r\n  private _selectRef: HTMLSelectElement;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() label: string;\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop() name: string;\r\n  @Prop({ mutable: true }) dataSet: IOption[] | string;\r\n  @Prop() shouldSort: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n  @Prop() removeItemButton: boolean = false;\r\n  @Prop() duplicateItemsAllowed: boolean = false;\r\n  @Prop() searchable?: boolean;\r\n  @Prop() searchTimeOut: number = 500;\r\n  @Prop() searchFilter: boolean = true;\r\n\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() change: EventEmitter<string | string[]>;\r\n  @Event() searchChange: EventEmitter<string>;\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher() {\r\n    this.initDataSet();\r\n    if (this._selectRef?.getAttribute('data-choice') === 'active' && this._dataSet) {\r\n      if (this._dataSet.length) {\r\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\r\n      } else {\r\n        this._choices.clearStore();\r\n      }\r\n    }\r\n  }\r\n\r\n  @Watch('value')\r\n  valueWatcher() {\r\n    if (this._choices) {\r\n      const newValue = this._choices.getValue(true) as string[] | string;\r\n\r\n      if (Array.isArray(newValue) && Array.isArray(this.value)) {\r\n        if (!deepEqual(newValue, this.value)) {\r\n          this._choices.setChoiceByValue(this.value);\r\n        }\r\n      } else if (newValue !== this.value) {\r\n        this._choices.setChoiceByValue(this.value);\r\n      }\r\n    }\r\n\r\n    this.change.emit(this.value);\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  private readonly setSearch = debounce((value: string) => {\r\n    this.searchChange.emit(value);\r\n  }, this.searchTimeOut);\r\n\r\n  initSelection() {\r\n    if (this._dataSet) {\r\n      if (this.value) {\r\n        this._dataSet.forEach(item => {\r\n          item.selected = Array.isArray(this.value) ? this.value.includes(item.value) : this.value == item.value;\r\n        });\r\n      } else if (this._dataSet.some(item => item.selected)) {\r\n        const selectedItems = this._dataSet.filter(item => item.selected);\r\n        this.value = this.selection === 'single' ? selectedItems[0].value : selectedItems.map(item => item.value);\r\n      } else if (this.selection === 'single') {\r\n        this._dataSet[0].selected = true;\r\n\r\n        this.value = this._dataSet[0].value;\r\n      }\r\n    } else if (this.selection === 'multiple') {\r\n      this.value = Array.from(this.host.querySelectorAll('option:checked')).map(o => (o as HTMLOptionElement).value);\r\n    } else {\r\n      this.value = (this.host.querySelector('option:checked') as HTMLOptionElement).value;\r\n    }\r\n  }\r\n\r\n  initDataSet() {\r\n    if (!this.dataSet) {\r\n      this._dataSet = null;\r\n    } else if (typeof this.dataSet === 'string') {\r\n      this._dataSet = JSON.parse(this.dataSet);\r\n    } else if (Array.isArray(this.dataSet) && this.dataSet.length) {\r\n      this._dataSet = this.dataSet.map(item => ({\r\n        value: item.id,\r\n        label: item.title,\r\n        selected: item.selected,\r\n      }));\r\n    }\r\n  }\r\n\r\n  handleFocused = async e => {\r\n    e.target.parentElement.classList.add('is-focused');\r\n  };\r\n\r\n  handleFocusout = async e => {\r\n    const target = e.target;\r\n    if (target.value) {\r\n      target.parentElement.classList.add('is-filled');\r\n    }\r\n    target.parentElement.classList.remove('is-focused');\r\n  };\r\n\r\n  handleKeyUp = async e => {\r\n    const target = e.target;\r\n    if (target.value) {\r\n      target.parentElement.classList.add('is-filled');\r\n    } else {\r\n      target.parentElement.classList.remove('is-filled');\r\n    }\r\n  };\r\n\r\n  componentWillLoad() {\r\n    this.initDataSet();\r\n    this.initSelection();\r\n  }\r\n\r\n  labelRender() {\r\n    if (this.label) {\r\n      return <label class=\"form-label ms-0\">{this.label}</label>;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        {this.labelRender()}\r\n        <select\r\n          class=\"form-control\"\r\n          name={this.name}\r\n          onFocus={e => this.handleFocused(e)}\r\n          onFocusout={e => this.handleFocusout(e)}\r\n          onKeyUp={e => this.handleKeyUp(e)}\r\n          ref={el => (this._selectRef = el)}\r\n          multiple={this.selection === 'multiple'}\r\n        >\r\n          <slot name=\"option\" />\r\n        </select>\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (this._selectRef.getAttribute('data-choice') !== 'active') {\r\n      this._choices = new Choices(this._selectRef, {\r\n        searchEnabled: this.searchable ?? this.selection === 'multiple',\r\n        allowHTML: true,\r\n        removeItemButton: this.removeItemButton,\r\n        noChoicesText: '沒有可供選擇的選項',\r\n        noResultsText: '找不到任何結果',\r\n        duplicateItemsAllowed: this.duplicateItemsAllowed,\r\n        shouldSort: this.shouldSort,\r\n        searchPlaceholderValue: '搜尋',\r\n        searchChoices: this.searchFilter,\r\n        searchFloor: -1,\r\n      });\r\n      if (this._dataSet) {\r\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\r\n      }\r\n      this._choices.passedElement.element.addEventListener(\r\n        'change',\r\n        (e: CustomEvent) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          this.value = this._choices.getValue(true) as string[] | string;\r\n        },\r\n        false,\r\n      );\r\n      if (!this.searchFilter)\r\n        this._selectRef.addEventListener('search', e => {\r\n          const event = e as CustomEvent<{ value: string; resultCount: number }>;\r\n          this.setSearch(event.detail.value);\r\n        });\r\n    }\r\n  }\r\n}\r\n\r\nexport interface IOption {\r\n  id: string;\r\n  title: string;\r\n  selected: boolean;\r\n}\r\n"],"mappings":"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","ignoreList":[]}