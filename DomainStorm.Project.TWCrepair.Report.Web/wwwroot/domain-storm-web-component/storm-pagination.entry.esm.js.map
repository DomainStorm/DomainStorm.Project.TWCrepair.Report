{"version":3,"file":"storm-pagination.entry.esm.js","sources":["src/components/storm-pagination/storm-pagination.css?tag=storm-pagination&encapsulation=shadow","src/components/storm-pagination/storm-pagination.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n\r\n:host dl,\r\n:host ol,\r\n:host ul {\r\n  margin-bottom: 0;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, h } from '@stencil/core';\r\nimport { FnIcon } from '../../utils/functional/functional';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\nimport type { PaginationItem } from './interface';\r\n\r\n@Component({\r\n  tag: 'storm-pagination',\r\n  styleUrl: 'storm-pagination.css',\r\n  shadow: true,\r\n})\r\nexport class StormPagination {\r\n  @Element() host: HTMLElement;\r\n  @Prop({ mutable: true }) pageNumber: number = 1;\r\n  @Prop() totalPages: number;\r\n  @Prop() paginationSuccessivelySize: number = 5;\r\n  @Prop() paginationPagesBySide = 1;\r\n\r\n  @Event() pageChange: EventEmitter<number>;\r\n\r\n  private pageFrom: number = -1;\r\n  private pageTo: number = -1;\r\n  private cachedPaginationItems: PaginationItem[] | null = null;\r\n  private lastCalculationKey: string = '';\r\n\r\n  setPage(newPageNumber: number) {\r\n    // 邊界檢查和驗證\r\n    if (newPageNumber < 1 || newPageNumber > this.totalPages || newPageNumber === this.pageNumber) {\r\n      return;\r\n    }\r\n\r\n    this.pageNumber = newPageNumber;\r\n    // 清除快取，因為頁碼已改變\r\n    this.cachedPaginationItems = null;\r\n    this.lastCalculationKey = '';\r\n    this.pageChange.emit(this.pageNumber);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    // 清理快取\r\n    this.cachedPaginationItems = null;\r\n    this.lastCalculationKey = '';\r\n  }\r\n\r\n  private calculatePageRange(): void {\r\n    // 提早返回避免不必要的計算\r\n    if (this.totalPages <= 0) {\r\n      this.pageFrom = 1;\r\n      this.pageTo = 0;\r\n      return;\r\n    }\r\n\r\n    // 邊界檢查和自動修正\r\n    if (this.pageNumber > this.totalPages) {\r\n      this.pageNumber = this.totalPages;\r\n    }\r\n    if (this.pageNumber < 1) {\r\n      this.pageNumber = 1;\r\n    }\r\n\r\n    // 簡化計算邏輯\r\n    if (this.totalPages <= this.paginationSuccessivelySize) {\r\n      this.pageFrom = 1;\r\n      this.pageTo = this.totalPages;\r\n      return;\r\n    }\r\n\r\n    // 計算顯示範圍\r\n    const halfSize = Math.floor(this.paginationSuccessivelySize / 2);\r\n    this.pageFrom = Math.max(1, this.pageNumber - halfSize);\r\n    this.pageTo = Math.min(this.totalPages, this.pageFrom + this.paginationSuccessivelySize - 1);\r\n\r\n    // 調整起始位置以保持固定數量的頁面\r\n    if (this.pageTo - this.pageFrom + 1 < this.paginationSuccessivelySize) {\r\n      this.pageFrom = Math.max(1, this.pageTo - this.paginationSuccessivelySize + 1);\r\n    }\r\n  }\r\n\r\n  componentWillRender() {\r\n    this.calculatePageRange();\r\n  }\r\n\r\n  private getPaginationItems(): PaginationItem[] {\r\n    // 使用快取避免重複計算\r\n    const currentKey = `${this.pageNumber}-${this.totalPages}-${this.paginationSuccessivelySize}-${this.paginationPagesBySide}`;\r\n    if (this.lastCalculationKey === currentKey && this.cachedPaginationItems) {\r\n      return this.cachedPaginationItems;\r\n    }\r\n\r\n    const paginationItems: PaginationItem[] = [];\r\n\r\n    // 左側頁面\r\n    if (this.pageFrom > 1) {\r\n      let max = this.paginationPagesBySide;\r\n      if (max >= this.pageFrom) max = this.pageFrom - 1;\r\n\r\n      for (let i = 1; i <= max; i++) {\r\n        paginationItems.push({ page: i });\r\n      }\r\n\r\n      if (this.pageFrom - 1 === max + 1) {\r\n        paginationItems.push({ page: this.pageFrom - 1 });\r\n      } else if (this.pageFrom - 1 > max) {\r\n        paginationItems.push({ title: '...' });\r\n      }\r\n    }\r\n\r\n    // 中間頁面\r\n    for (let i = this.pageFrom; i <= this.pageTo; i++) {\r\n      paginationItems.push({ page: i });\r\n    }\r\n\r\n    // 右側頁面\r\n    if (this.totalPages > this.pageTo) {\r\n      let min = this.totalPages - (this.paginationPagesBySide - 1);\r\n      if (this.pageTo >= min) min = this.pageTo + 1;\r\n\r\n      if (this.pageTo + 1 === min - 1) {\r\n        paginationItems.push({ page: this.pageTo + 1 });\r\n      } else {\r\n        paginationItems.push({ title: '...' });\r\n      }\r\n\r\n      for (let i = min; i <= this.totalPages; i++) {\r\n        paginationItems.push({ page: i });\r\n      }\r\n    }\r\n\r\n    // 快取結果\r\n    this.cachedPaginationItems = paginationItems;\r\n    this.lastCalculationKey = currentKey;\r\n\r\n    return paginationItems;\r\n  }\r\n\r\n  render() {\r\n    const paginationItems = this.getPaginationItems();\r\n\r\n    return (\r\n      <Host>\r\n        <ul class=\"pagination pagination-primary\">\r\n          <li class=\"page-item\">\r\n            <a\r\n              class=\"page-link\"\r\n              href=\"javascript:;\"\r\n              aria-label=\"上一頁\"\r\n              onClick={() => {\r\n                const newPage = this.pageNumber === 1 ? this.totalPages : this.pageNumber - 1;\r\n                this.setPage(newPage);\r\n              }}\r\n            >\r\n              <span aria-hidden=\"true\">\r\n                <FnIcon>keyboard_arrow_left</FnIcon>\r\n              </span>\r\n            </a>\r\n          </li>\r\n          {paginationItems.map((x, index) => {\r\n            const isActive = x.page === this.pageNumber;\r\n            const isDisabled = x.page == null;\r\n\r\n            return (\r\n              <li\r\n                key={x.page ? `page-${x.page}` : `ellipsis-${index}`}\r\n                class={{ 'page-item': true, active: isActive, disabled: isDisabled }}\r\n                onClick={() => {\r\n                  if (x.page && !isActive) this.setPage(x.page);\r\n                }}\r\n              >\r\n                <a class=\"page-link\" href=\"javascript:;\" aria-current={isActive ? 'page' : undefined} aria-label={x.page ? `第 ${x.page} 頁` : undefined}>\r\n                  {x.title || x.page?.toString()}\r\n                </a>\r\n              </li>\r\n            );\r\n          })}\r\n          <li class=\"page-item\">\r\n            <a\r\n              class=\"page-link\"\r\n              href=\"javascript:;\"\r\n              aria-label=\"下一頁\"\r\n              onClick={() => {\r\n                const newPage = this.pageNumber === this.totalPages ? 1 : this.pageNumber + 1;\r\n                this.setPage(newPage);\r\n              }}\r\n            >\r\n              <span aria-hidden=\"true\">\r\n                <FnIcon>keyboard_arrow_right</FnIcon>\r\n              </span>\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}