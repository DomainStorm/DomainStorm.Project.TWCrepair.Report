import{r as t,c as e,a as s,h as i,H as h,f as l}from"./p-CSg1USUf.js";import{a}from"./p-DpqGDzhD.js";import{S as r}from"./p-CZZ7aWyk.js";import{g as n,s as o,b as c,c as d,r as f,d as u,i as b,e as p,p as g}from"./p-C51KEHDy.js";const m=':host{display:block;line-height:1}:host .table td,:host .table th{white-space:pre-wrap}:host .table td.text-truncate,:host .table th.text-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host .table thead{z-index:1}:host .table.table-sm thead th{padding:0.5rem 0.25rem}:host .table thead th{padding:0.75rem 0.5rem}:host .table thead th.thead-xxs{width:2.3rem}:host .table-sm thead th.thead-xxs{padding:0.25rem}:host .form-check{padding:0}:host .table-sorter{cursor:pointer}:host .table-sorter>.cell{display:inline-block;height:100%;position:relative;width:100%;line-height:1.1}:host .table-sorter>.cell:before{border-top:5px solid #000;bottom:.15rem}:host .table-sorter>.cell:after{border-bottom:5px solid #000;border-top:5px solid transparent;top:-.2rem}:host .table-sorter>.cell:after,:host .table-sorter>.cell:before{content:"";height:0;width:0;position:absolute;right:5px;border-left:5px solid transparent;border-right:5px solid transparent;opacity:.3}:host .table-sorter.asc>.cell:after,:host .table-sorter.desc>.cell:before{opacity:.7}:host .table-sorter.asc>.cell:before,:host .table-sorter.desc>.cell:after{opacity:0}:host table{table-layout:fixed}:host .no-records-found{height:30vh}:host .fixed-table-header th{position:sticky;top:0}:host .fixed-table-header thead{position:sticky;top:0;background:white}:host .fixed-table-header thead tr{border-top-width:0}:host .table-description{font-size:0.5rem;font-weight:normal !important}:host .table-top,:host .table-bottom{padding:0.5rem}:host .table-top label{margin-bottom:0}:host .table-selectedInfo,:host .table-pageSizeMenu,:host .table-pageInfo{float:left;color:#7b809a;font-size:.875rem}:host .table-selectedInfo,:host .table-pageInfo{margin:0.7rem 0;padding-right:2rem}:host .table-search,:host .table-pagination{float:right}:host .table .form-check>.form-check-input[type=radio]{background-color:#fff;cursor:pointer}:host .table-bottom:after,:host .table-top:after{clear:both;content:" ";display:table}:host .table-search input{font-size:.875rem;color:#495057;border:1px solid #f0f2f5;border-radius:0.375rem;padding:6px 12px}:host .table-top .table-pageSizeMenu label select{border-color:#f0f2f5;border-radius:0.375rem;padding:6px}:host .tr.table-sorter{cursor:pointer}:host tr storm-toolbar storm-button .btn{width:1.5rem;height:1.5rem;padding:0.3rem 0.3rem}:host tr:hover storm-toolbar.storm-dynamic-label storm-button .btn:not(.btn-icon-only){width:auto;height:auto;padding:.06rem .5rem .06rem .2rem}:host tr storm-toolbar.storm-dynamic-label storm-button .storm-button-label{display:none}:host tr:hover storm-toolbar.storm-dynamic-label storm-button .storm-button-label{display:block}';const w=class{constructor(s){t(this,s);this.pageNumberChange=e(this,"pageNumberChange");this.pageSizeChange=e(this,"pageSizeChange");this.sortChange=e(this,"sortChange");this.searchChanged=e(this,"searchChanged");this.tableWillRender=e(this,"tableWillRender");this.rowMove=e(this,"rowMove");this.rowWillSelect=e(this,"rowWillSelect");this.rowWillUnselect=e(this,"rowWillUnselect");this.rowSelect=e(this,"rowSelect");this.rowUnselect=e(this,"rowUnselect");this.rowDidSelect=e(this,"rowDidSelect");this.rowDidUnselect=e(this,"rowDidUnselect");this.rowSelectChange=e(this,"rowSelectChange");this.selectWillChange=e(this,"selectWillChange");this.selectChange=e(this,"selectChange");this.selectDidChange=e(this,"selectDidChange");this.cellWillCheck=e(this,"cellWillCheck");this.cellWillUncheck=e(this,"cellWillUncheck");this.cellCheck=e(this,"cellCheck");this.cellUncheck=e(this,"cellUncheck");this.cellDidCheck=e(this,"cellDidCheck");this.cellDidUncheck=e(this,"cellDidUncheck");this.cellCheckChange=e(this,"cellCheckChange");this.checkWillChange=e(this,"checkWillChange");this.checkChange=e(this,"checkChange");this.checkDidChange=e(this,"checkDidChange");this.clickRow=e(this,"clickRow")}_pageDate;_cellCheckChangeTimeoutRafId={};_bodyRef;_selectedInfoRef;_breakpoints=[{size:"4xs",width:239},{size:"3xs",width:359},{size:"xxs",width:479},{size:"xs",width:576},{size:"sm",width:768},{size:"md",width:992},{size:"lg",width:1200},{size:"xl",width:1400},{size:"xxl",width:1600},{size:"3xl",width:1920},{size:"4xl",width:Infinity}];get host(){return s(this)}uid=n("storm-table");fieldId="id";fieldSelected="__selected";fieldIndex="__index";pagination=false;sidePagination="stencil";searchable=false;pageSizeMenu=true;pageInfo=true;selectedInfo=true;escape=true;classes;cellTemplate="{value}";clickRowTo;selection="single";pageList=[5,10,15,20,25];tableHeight;columns;dataSet;pageNumber=1;pageSize=10;searchText;sortName;sortOrder;groupBy;totalRows;totalSelected;totalChecked;isColumnResponsive=false;expand={visibleColumnCount:0};pageNumberChange;pageSizeChange;sortChange;searchChanged;tableWillRender;rowMove;rowWillSelect;rowWillUnselect;rowSelect;rowUnselect;rowDidSelect;rowDidUnselect;rowSelectChange;selectWillChange;selectChange;selectDidChange;cellWillCheck;cellWillUncheck;cellCheck;cellUncheck;cellDidCheck;cellDidUncheck;cellCheckChange;checkWillChange;checkChange;checkDidChange;clickRow;watchDataSetHandler(){this.initDataSet();this.rerender()}async watchColumnsHandler(){this.initColumns()}watchTotalSelectedHandler(t,e){this.debouncedDisplaySelectedCount()}searchChangedHandler(t){if(this.sidePagination==="stencil"){this.searchText=t.detail}else{this.tableWillRender.emit({pageNumber:this.pageNumber,pageSize:this.pageSize,sortName:this.sortName,sortOrder:this.sortOrder,searchText:t.detail})}}pageNumberChangeHandler(t){if(this.sidePagination==="stencil"){this.pageNumber=t.detail}else{this.tableWillRender.emit({pageNumber:t.detail,pageSize:this.pageSize,sortName:this.sortName,sortOrder:this.sortOrder,searchText:this.searchText})}}pageSizeChangeHandler(t){if(this.sidePagination==="stencil"){this.pageSize=t.detail}else{this.tableWillRender.emit({pageNumber:this.pageNumber,pageSize:t.detail,sortName:this.sortName,sortOrder:this.sortOrder,searchText:this.searchText})}}sortChangeHandler(t){if(this.sidePagination==="stencil"){this.sortName=t.detail.sortName;this.sortOrder=t.detail.sortOrder}else{this.tableWillRender.emit({pageNumber:this.pageNumber,pageSize:this.pageSize,sortName:t.detail.sortName,sortOrder:t.detail.sortOrder,searchText:this.searchText})}}async rowWillSelectHandler(t){if(this.sidePagination==="stencil"){if(this.selection==="single"){await this.unselectAll()}this.rowSelect.emit(t.detail)}}async rowSelectHandler(t){const e=await this.getRowById(t.detail);o(e,this.fieldSelected,true);this._bodyRef.updateRowSelection(e);this.rowDidSelect.emit(e)}rowDidSelectHandler(t){this.rowSelectChange.emit(t.detail)}rowWillUnselectHandler(t){if(this.sidePagination==="stencil"){this.rowUnselect.emit(t.detail)}}async rowUnselectHandler(t){const e=await this.getRowById(t.detail);o(e,this.fieldSelected,false);this._bodyRef.updateRowSelection(e);this.rowDidSelect.emit(e)}rowDidUnselectHandler(t){this.rowSelectChange.emit(t.detail)}rowSelectChangeHandler(t){this.debouncedRowSelectionUpdate()}async selectWillChangeHandler(t){if(this.sidePagination==="stencil"){const t=await this.getSelected();this.selectChange.emit(t.length)}}selectChangeHandler(t){this.totalSelected=t.detail;this.debouncedDisplaySelectedCount();this.selectDidChange.emit(t.detail)}async cellWillCheckHandler(t){if(this.sidePagination==="stencil"){const e=await this.getColumnByField(t.detail.field);if(e.type==="radio"){await this.uncheckAll(e.field)}this.cellCheck.emit(t.detail)}}async cellCheckHandler(t){const e=await this.getColumnByField(t.detail.field);const s=await this.getRowById(t.detail.id);o(s,e.field,true);this._bodyRef.updateRowCheckbox(s,e);this.cellDidCheck.emit({row:s,column:e})}cellDidCheckHandler(t){this.cellCheckChange.emit(t.detail)}cellWillUncheckHandler(t){if(this.sidePagination==="stencil"){this.cellUncheck.emit(t.detail)}}async cellUncheckHandler(t){const e=await this.getColumnByField(t.detail.field);const s=await this.getRowById(t.detail.id);o(s,e.field,false);this._bodyRef.updateRowCheckbox(s,e);this.cellDidCheck.emit({row:s,column:e})}cellDidUncheckHandler(t){this.cellCheckChange.emit(t.detail)}cellCheckChangeHandler(t){const e=t.detail.column;const s=this._cellCheckChangeTimeoutRafId[e.field];if(s){clearTimeout(s);this._cellCheckChangeTimeoutRafId[e.field]=undefined}this._cellCheckChangeTimeoutRafId[e.field]=setTimeout((()=>{this._cellCheckChangeTimeoutRafId[e.field]=undefined;this.checkWillChange.emit(e.field)}),100)}async checkWillChangeHandler(t){if(this.sidePagination==="stencil"){const e=await this.getChecked(t.detail);this.checkChange.emit({total:e.length,field:t.detail})}}async checkChangeHandler(t){this.setTotalChecked(t.detail.field,t.detail.total);if(t.detail.field===this.fieldSelected){this.totalSelected=t.detail.total}const e=await this.getColumnByField(t.detail.field);await this._bodyRef.updateColumnCheckbox(e);this.checkDidChange.emit({total:t.detail.total,column:e})}async clickCellHandler(t){const e=await this.getColumnByField(t.detail.field);if(e.type==="checkbox"||e.type==="radio"){await this.checkClick(t.detail.id,t.detail.field)}else{this.clickRow.emit(t.detail.id)}}async clickRowHandler(t){if(this.clickRowTo==="check"){await this.checkClick(t.detail,this.fieldSelected)}else if(this.clickRowTo==="select"){const e=await this.getRowById(t.detail);c(e,this.fieldSelected)?this.unselect(t.detail):this.select(t.detail)}}async moveRow(t,e){d(this.dataSet,t,e);this.dataSet.forEach(((t,e)=>{const s=c(t,this.fieldIndex);if(s!==e){this.rowMove.emit({row:t,from:s,to:e});o(t,this.fieldIndex,e)}}));this.rerender()}async dispatchCustomEvent(t,e){this[t].emit(e)}async getRowAt(t){return this.dataSet.find((e=>c(e,this.fieldIndex)===t))}async getRowById(t){if(typeof t==="object")return t;return this.dataSet.find((e=>c(e,this.fieldId)===t))}async getColumnByField(t){if(typeof t==="object")return t;return this.columns.find((e=>e.field===t))}async getSelected(){if(this.sidePagination==="stencil"){return this.dataSet.filter((t=>c(t,this.fieldSelected)))}return null}async getChecked(t){if(this.sidePagination==="stencil"){const e=await this.getColumnByField(t);return this.dataSet.filter((t=>c(t,e.field)!==null&&c(t,e.field)))}return null}async select(t){this.rowWillSelect.emit(t)}async selectAll(){this.dataSet.filter((t=>!c(t,this.fieldSelected))).forEach((t=>{this.select(c(t,this.fieldId))}))}async unselect(t){this.rowWillUnselect.emit(t)}async unselectAll(){this.dataSet.filter((t=>c(t,this.fieldSelected))).forEach((t=>{this.unselect(c(t,this.fieldId))}))}async check(t,e){const s=await this.getRowById(t);if(c(s,e))return;this.cellWillCheck.emit({id:t,field:e})}async uncheck(t,e){const s=await this.getRowById(t);if(!c(s,e))return;this.cellWillUncheck.emit({id:t,field:e})}async checkAll(t){const e=await this.getColumnByField(t);this.dataSet.filter((e=>!c(e,t))).forEach((async s=>{const i=await this.resolveColumnData(e,[s,c(s,this.fieldIndex),e]);if(i&&i.disabled)return;this.check(c(s,this.fieldId),t)}))}async uncheckAll(t){const e=await this.getColumnByField(t);this.dataSet.filter((e=>c(e,t))).forEach((async s=>{const i=await this.resolveColumnData(e,[s,c(s,this.fieldIndex),e]);if(i&&i.disabled)return;this.uncheck(c(s,this.fieldId),t)}))}async resolveColumnData(t,e){const s=f(t,"data",e);return s instanceof Promise?await s:s}rerender=u((async()=>{l(this)}),100);debouncedDisplaySelectedCount=u((async()=>{if(!this.isSelectedInfoVisible()||!this._selectedInfoRef)return;this._selectedInfoRef.innerHTML=this.totalSelected?`已選取 ${this.totalSelected} 筆`:""}),100);debouncedRowSelectionUpdate=u((async()=>{this.selectWillChange.emit()}),100);async checkClick(t,e){const s=await this.getColumnByField(e);const i=await this.getRowById(t);if(c(i,s.field)){if(s.type==="radio"&&(!s.data||!s.data.unchecked))return;this.uncheck(t,s.field)}else this.check(t,s.field)}isPaginationVisible(){return this.columns&&this.pageInfo&&this.pagination&&this._pageDate&&this._pageDate.length>0}isPageSizeMenuVisible(){return this.pageSizeMenu&&this.isPaginationVisible()}isSelectedInfoVisible(){return this.selectedInfo&&this.clickRowTo!=null}getTotalChecked(t){if(!this.totalChecked)return 0;return this.totalChecked[t]}handleSearchChanged(t){t.stopPropagation();const e=t.detail?.trim();if(this.searchText===e)return;this.searchChanged.emit(e)}handleColumnCheckChange(t,e){const s=t.target["checked"];if(s)this.checkAll(e.field);else this.uncheckAll(e.field)}handleColumnClick(t){if(!t.sortable)return;if(t.field==this.sortName){if(this.sortOrder=="desc")this.sortChange.emit({sortName:undefined,sortOrder:undefined});else this.sortChange.emit({sortName:this.sortName,sortOrder:"desc"})}else this.sortChange.emit({sortName:t.field,sortOrder:"asc"})}renderPagination(){if(!this.isPaginationVisible())return;return i("div",{class:"table-pagination"},i("storm-pagination",{"page-number":this.pageNumber,"total-pages":Math.ceil(this.totalRows/this.pageSize),onPageChange:t=>{this.pageNumberChange.emit(t.detail)}}))}renderPageSizeMenu(){if(!this.isPageSizeMenuVisible())return;return i("div",{class:"table-pageSizeMenu"},i("label",null,"顯示"," ",i("select",{class:"table-selector",onChange:t=>this.pageSizeChange.emit(Number(t.currentTarget.value))},this.pageList.map((t=>i("option",{value:t,selected:this.pageSize==t},t))))," ","筆結果"))}renderSearch(){if(!this.searchable)return;return i("div",{class:"table-search"},i(a,{placeholder:"請輸入關鍵字",onValueChanged:t=>this.handleSearchChanged(t)}))}renderPageInfo(){if(!this.pageInfo)return;return i("div",{class:"table-pageInfo"},this.searchable&&this.searchText?`篩選 ${this._pageDate.length} 筆，`:"",this.pagination&&this._pageDate.length>0?`顯示第 ${(this.pageNumber-1)*this.pageSize+1} 至 ${this.totalRows<this.pageNumber*this.pageSize?this.totalRows:this.pageNumber*this.pageSize} 筆，`:"","共 ",this.totalRows," 筆")}renderSelectedInfo(){if(!this.isSelectedInfoVisible())return;return i("div",{ref:t=>this._selectedInfoRef=t,class:"table-selectedInfo"})}renderTableTop(){if(!this.isPageSizeMenuVisible()&&!this.searchable)return;return i("div",{class:"table-top p-1"},this.renderPageSizeMenu(),this.renderSearch())}renderTableBottom(){if(!this.isSelectedInfoVisible()&&!this.isPaginationVisible())return;return i("div",{class:"table-bottom p-1"},this.renderPageInfo(),this.renderSelectedInfo(),this.renderPagination())}initDataSet(){if(!this.dataSet?.length||!this.columns?.length)return;const t=this.columns.filter((t=>t.type==="checkbox"||t.type==="radio"));let e=0;const s=new Map;t.forEach((t=>{s.set(t.field,0)}));this.dataSet.forEach(((i,h)=>{this.ensureFieldValue(i,this.fieldId,(()=>n("row")));this.ensureFieldValue(i,this.fieldIndex,(()=>h));this.ensureFieldValue(i,this.fieldSelected,(()=>false));t.forEach((t=>{this.ensureFieldValue(i,t.field,(()=>false));if(this.sidePagination==="stencil"&&c(i,t.field)){s.set(t.field,s.get(t.field)+1)}}));if(this.sidePagination==="stencil"&&c(i,this.fieldSelected)){e++}}));if(this.sidePagination==="stencil"){this.totalSelected=e;this.totalRows=this.dataSet.length;s.forEach(((t,e)=>{this.setTotalChecked(e,t)}))}}ensureFieldValue(t,e,s){if(c(t,e)==null){o(t,e,s())}}initColumns(){if(!this.columns)return;this.columns.forEach(((t,e)=>{if(t.type==null){t.type="text"}else if(typeof t.type==="string"&&b(t.type)){t.type=p(t.type)}if(t.type!=="action"){t.field??=["checkbox","radio"].includes(t.type)?n(t.type,e.toString()):e;t.searchable??=this.searchable}const s=t.classes??{};const i=Object.entries(s).filter((([t,e])=>t.startsWith("d-table-")&&t!=="d-table-none"&&t!=="d-table-cell"&&e===true));if(i.length>0){t.responsive=true;t.rwdClassReversal={};const e=i.some((([t])=>t.endsWith("-none")));const h=i.some((([t])=>t.endsWith("-cell")));if(e&&h){t.rwdClassReversal["d-table-none"]=s["d-table-none"]!==true}else if(e&&!h){t.rwdClassReversal["d-table-none"]=s["d-table-none"]!==true}for(const[e]of i){if(e.endsWith("-cell")){const s=e.replace(/-cell$/,"-none");t.rwdClassReversal[s]=true}else if(e.endsWith("-none")){const s=e.replace(/-none$/,"-cell");t.rwdClassReversal[s]=true}}}if(typeof t.data==="string"){if(b(t.data)){t.data=p(t.data)}else if(t.data.startsWith("{")&&t.data.endsWith("}")){try{t.data=JSON.parse(t.data)}catch(e){console.warn("無法解析欄位 data JSON：",t.data)}}}}));if(this.columns.some((t=>t.responsive===true))){this.isColumnResponsive=true;this.columns.unshift({type:"detail"})}this.expand.visibleColumnCount=this.columns.filter((t=>t.visible!==false)).length;if(this.clickRowTo==="check"){const t=this.columns.find((t=>t.type==="checkbox"||t.type==="radio"));if(t&&(!this.fieldSelected||this.fieldSelected==="__selected")){this.fieldSelected=t.field?.toString()}}if(!this.dataSet){this.tableWillRender.emit({pageNumber:this.pageNumber,pageSize:this.pageSize,sortName:this.sortName,sortOrder:this.sortOrder,searchText:this.searchText})}else{this.initDataSet()}}_resizeObserver;responsiveResize(){if(this._resizeObserver)return;this._resizeObserver=new ResizeObserver((()=>{this.refreshColumnVisibility()}));this._resizeObserver.observe(this.host)}_breakpointIndex;refreshColumnVisibility=u((()=>{const t=this.host.shadowRoot?.querySelector("table");if(!t)return;const e=t.offsetWidth;if(this._breakpointIndex!=null){const t=this._breakpoints[this._breakpointIndex];const s=this._breakpoints[this._breakpointIndex-1];if(e>=t.width&&(!s||e<s.width)){return}}let s;const i=this._breakpoints.length;for(let h=0;h<i;h++){const{size:l,width:a}=this._breakpoints[h];const r=h===i-1;const n=e>=a&&(r||e<this._breakpoints[h+1].width);t.classList.toggle(`storm-table-${l}`,n);if(n){s=h}}this._breakpointIndex=s;const h=[];let l=false;for(const t of this.columns){const e=this.isColumnVisible(t);t["__columnVisible"]=e;if(e){h.push(t)}else if(t.responsive===true){l=true}}const a=this._bodyRef?.querySelectorAll(".detail-toggle, .row-detail");if(l){this.expand.visibleColumnCount=h.length;a?.forEach((t=>{t.classList.toggle("d-table-none",false)}))}else{this.expand.visibleColumnCount=h.filter((t=>t.type!=="detail")).length;a?.forEach((t=>{t.classList.toggle("d-table-none",true)}))}const r=this.expand.visibleColumnCount.toString();this._bodyRef?.querySelectorAll(".full-cell[colspan]").forEach((t=>{t.setAttribute("colspan",r)}))}),100);isColumnVisible(t){if(t.visible===false)return false;if(!t.classes||t.responsive!==true)return true;let e=true;if(t.classes["d-table-none"]===true)e=false;if(t.classes["d-table-cell"]===true)e=true;if(typeof this._breakpointIndex==="number"&&Array.isArray(this._breakpoints)){for(let s=0;s<=this._breakpointIndex;s++){const i=this._breakpoints[s]?.size;if(!i)continue;if(t.classes[`d-table-${i}-none`]===true)e=false;if(t.classes[`d-table-${i}-cell`]===true)e=true}}return e}setTotalChecked(t,e){this.totalChecked??={};this.totalChecked[t]=e}componentWillLoad(){r.applyShadowRootStyles(this.host);this.initColumns()}_searchableColumns=null;componentWillRender(){if(!this.dataSet||!this.columns)return;this.classes=g(this.classes);this._pageDate=this.dataSet;if(this.sidePagination==="stencil"){if(this.searchable&&this.searchText){const t=this.searchText.toLowerCase();if(!this._searchableColumns){this._searchableColumns=this.columns.filter((t=>t.searchable))}this._pageDate=this._pageDate.filter((e=>this._searchableColumns.some((s=>{const i=c(e,s.field);return(i+"").toLowerCase().includes(t)}))))}const t=this.sortName||this.fieldIndex;if(t){const e=this.sortOrder==="desc";this._pageDate.sort(((s,i)=>{const h=c(s,t);const l=c(i,t);if(this.groupBy){const t=c(s,this.groupBy);const e=c(i,this.groupBy);if(h==l){return t.localeCompare(e)}}if(this.sortName){const t=(h+"").localeCompare(l+"");return e?-t:t}else{return h-l}}))}}}render(){if(!this._pageDate)return;let t=this._pageDate;if(this.pagination&&this.sidePagination=="stencil"){const e=(this.pageNumber-1)*this.pageSize+1;const s=this.pageNumber*this.pageSize;t=t.slice(e-1,s)}return i(h,null,this.renderTableTop(),i("div",{class:{"text-sm":true,"table-responsive":true,border:this.classes&&!!this.classes["table-bordered"]}},i("div",{class:{"table-container":true,"fixed-table-header":!!this.tableHeight},style:{height:!!this.tableHeight?this.tableHeight:"inherit"}},i("storm-table-body",{ref:t=>this._bodyRef=t,table:this,dataSet:t,timeStamp:Date.now()}))),this.renderTableBottom())}componentDidRender(){this.debouncedDisplaySelectedCount();if(this.isColumnResponsive){this.responsiveResize()}}static get watchers(){return{dataSet:["watchDataSetHandler"],columns:["watchColumnsHandler"],totalSelected:["watchTotalSelectedHandler"]}}};w.style=m;export{w as storm_table};
//# sourceMappingURL=p-2652ff56.entry.js.map