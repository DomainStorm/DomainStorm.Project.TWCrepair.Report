{"version":3,"names":["stormEditTableCss","StormEditTable","dataSet","columns","classes","clickRowTo","pagination","searchable","viewable","editable","deletable","orderable","escape","change","rowView","rowUpdate","rowDelete","tableRef","tableResponsiveRef","viewAnchors","deleteAnchors","value","componentWillLoad","SharedStyles","applyShadowRootStylesAsync","this","host","componentWillRender","addActionColumnRender","actionColumns","filter","c","type","length","buttons","push","label","icon","action","row","_action","table","from","to","moveRow","visible","i","_table","emit","render","h","Host","key","parseClassNames","ref","el"],"sources":["src/components/storm-edit-table/storm-edit-table.css?tag=storm-edit-table&encapsulation=shadow","src/components/storm-edit-table/storm-edit-table.tsx"],"sourcesContent":[null,"import { Component, Element, Event, EventEmitter, h, Host, Prop } from '@stencil/core';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\nimport { parseClassNames } from '../../utils/utils';\r\nimport type { TableColumnInterface } from '../storm-table/interface';\r\nimport { StormTable } from '../storm-table/storm-table';\r\n\r\n@Component({\r\n  tag: 'storm-edit-table',\r\n  styleUrl: 'storm-edit-table.css',\r\n  shadow: true,\r\n})\r\nexport class StormEditTable {\r\n  @Element() host: HTMLElement;\r\n  @Prop() dataSet: object[];\r\n  @Prop() columns: TableColumnInterface[];\r\n  @Prop() classes: Record<string, boolean> | string = 'table-hover table-striped table-dark table-sm table-borderless';\r\n  @Prop() clickRowTo?: 'select' | 'check';\r\n  @Prop() pagination: boolean = false;\r\n  @Prop() searchable: boolean = false;\r\n  @Prop() viewable: boolean = true;\r\n  @Prop() editable: boolean = true;\r\n  @Prop() deletable: boolean = true;\r\n  @Prop() orderable: boolean = false;\r\n  @Prop() escape: boolean = true;\r\n  // @Prop() actionColumn: ITableColumn\r\n\r\n  @Event() change: EventEmitter;\r\n  @Event() rowView: EventEmitter<object>;\r\n  @Event() rowUpdate: EventEmitter<object>;\r\n  @Event() rowDelete: EventEmitter<object>;\r\n\r\n  tableRef: HTMLStormTableElement;\r\n  tableResponsiveRef: any;\r\n  viewAnchors: HTMLAnchorElement[];\r\n  deleteAnchors: HTMLAnchorElement[];\r\n  value: any;\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n  }\r\n\r\n  componentWillRender() {\r\n    if (!this.columns) return;\r\n    this.addActionColumnRender();\r\n  }\r\n\r\n  addActionColumnRender() {\r\n    const actionColumns = this.columns.filter(c => c.type == 'action');\r\n    if (actionColumns.length == 0) return;\r\n\r\n    for (var c of actionColumns) {\r\n      c.buttons = [];\r\n    }\r\n\r\n    if (this.orderable) {\r\n      actionColumns[0].buttons.push(\r\n        {\r\n          label: '上移',\r\n          icon: 'arrow_upward',\r\n          action: (row: object, _action: object, table: StormTable) => {\r\n            (async () => {\r\n              let from = row['__index'];\r\n              let to = row['__index'] - 1;\r\n              await table.moveRow(from, to);\r\n            })();\r\n          },\r\n          visible: row => {\r\n            return row['__index'] > 0;\r\n          },\r\n        },\r\n        {\r\n          label: '下移',\r\n          icon: 'arrow_downward',\r\n          action: (row: object, _action: object, table: StormTable) => {\r\n            (async () => {\r\n              let from = row['__index'];\r\n              let to = row['__index'] + 1;\r\n              await table.moveRow(from, to);\r\n            })();\r\n          },\r\n          visible: row => {\r\n            return row['__index'] < this.dataSet?.length - 1;\r\n          },\r\n        },\r\n      );\r\n    }\r\n\r\n    let i = actionColumns.length == 2 ? 1 : 0;\r\n    if (this.viewable) {\r\n      actionColumns[i].buttons.push({\r\n        label: '觀看',\r\n        icon: 'visibility',\r\n        action: (row: object, _action: object, _table: StormTable) => {\r\n          (async () => {\r\n            this.rowView.emit(row);\r\n          })();\r\n        },\r\n      });\r\n    }\r\n    if (this.editable) {\r\n      actionColumns[i].buttons.push({\r\n        label: '修改',\r\n        icon: 'drive_file_rename_outline',\r\n        action: (row: object, _action: object, _table: StormTable) => {\r\n          (async () => {\r\n            this.rowUpdate.emit(row);\r\n          })();\r\n        },\r\n      });\r\n    }\r\n    if (this.deletable) {\r\n      actionColumns[i].buttons.push({\r\n        label: '刪除',\r\n        icon: 'delete',\r\n        action: (row: object, _action: object, _table: StormTable) => {\r\n          (async () => {\r\n            this.rowDelete.emit(row);\r\n          })();\r\n        },\r\n      });\r\n    }\r\n\r\n    // const actionColumns = this.columns.filter(c => c.type == \"action\");\r\n    // if(actionColumns.length == 0)\r\n    //   return;\r\n\r\n    // actionColumns[0].render = (value, row, index) => {\r\n    //   let renderList = []\r\n    //   if(this.viewable){\r\n    //     renderList.push('<storm-tooltip title=\"觀看\">',\r\n    //     '<a role=\"button\" class=\"mx-1 editor-view\" data-index=\"'+index+'\">',\r\n    //     '<i class=\"material-icons\">visibility</i>',\r\n    //     '</a>',\r\n    //     '</storm-tooltip>')\r\n    //   }\r\n    //   if(this.editable){\r\n    //     renderList.push('<storm-tooltip title=\"修改\">',\r\n    //     '<a role=\"button\" class=\"mx-1 editor-update\" data-index=\"'+index+'\">',\r\n    //     '<i class=\"material-icons\">drive_file_rename_outline</i>',\r\n    //     '</a>',\r\n    //     '</storm-tooltip>')\r\n    //   }\r\n    //   if(this.deletable){\r\n    //     renderList.push('<storm-tooltip title=\"刪除\">',\r\n    //     '<a role=\"button\" class=\"mx-1 editor-delete\" data-index=\"'+index+'\">',\r\n    //     '<i class=\"material-icons\">delete</i>',\r\n    //     '</a>',\r\n    //     '</storm-tooltip>')\r\n    //   }\r\n    //   return renderList.join('')};\r\n  }\r\n\r\n  // async componentDidRender() {\r\n  //   this.tableRef.shadowRoot.querySelectorAll(\".editor-view\").forEach((element) => {\r\n  //     element.addEventListener('click', (e) => {\r\n  //       const rowIndex = parseInt((e.currentTarget as HTMLElement).getAttribute(\"data-index\"))\r\n  //       this.rowView.emit(this.dataSet[rowIndex]);\r\n  //       e.stopPropagation();\r\n  //     })\r\n  //   });\r\n\r\n  //   this.tableRef.shadowRoot.querySelectorAll(\".editor-update\").forEach((element) => {\r\n  //     element.addEventListener('click', (e) => {\r\n  //       const rowIndex = parseInt((e.currentTarget as HTMLElement).getAttribute(\"data-index\"))\r\n  //       this.rowUpdate.emit(this.dataSet[rowIndex]);\r\n  //       e.stopPropagation();\r\n  //     })\r\n  //   });\r\n\r\n  //   this.tableRef.shadowRoot.querySelectorAll(\".editor-delete\").forEach((element) => {\r\n  //     element.addEventListener('click', (e) => {\r\n  //       const rowIndex = parseInt((e.currentTarget as HTMLElement).getAttribute(\"data-index\"))\r\n  //       this.rowDelete.emit(this.dataSet[rowIndex]);\r\n  //       e.stopPropagation();\r\n  //     })\r\n  //   });\r\n  // }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <storm-table\r\n          searchable={this.searchable}\r\n          pagination={this.pagination}\r\n          classes={parseClassNames(this.classes)}\r\n          columns={this.columns}\r\n          dataSet={this.dataSet}\r\n          clickRowTo={this.clickRowTo}\r\n          escape={this.escape}\r\n          ref={el => (this.tableRef = el)}\r\n        />\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"mIAAA,MAAMA,EAAoB,G,MCWbC,EAAc,M,qLAEjBC,QACAC,QACAC,QAA4C,iEAC5CC,WACAC,WAAsB,MACtBC,WAAsB,MACtBC,SAAoB,KACpBC,SAAoB,KACpBC,UAAqB,KACrBC,UAAqB,MACrBC,OAAkB,KAGjBC,OACAC,QACAC,UACAC,UAETC,SACAC,mBACAC,YACAC,cACAC,MAEA,uBAAMC,SACEC,EAAaC,2BAA2BC,KAAKC,KAAM,W,CAG3D,mBAAAC,GACE,IAAKF,KAAKtB,QAAS,OACnBsB,KAAKG,uB,CAGP,qBAAAA,GACE,MAAMC,EAAgBJ,KAAKtB,QAAQ2B,QAAOC,GAAKA,EAAEC,MAAQ,WACzD,GAAIH,EAAcI,QAAU,EAAG,OAE/B,IAAK,IAAIF,KAAKF,EAAe,CAC3BE,EAAEG,QAAU,E,CAGd,GAAIT,KAAKd,UAAW,CAClBkB,EAAc,GAAGK,QAAQC,KACvB,CACEC,MAAO,KACPC,KAAM,eACNC,OAAQ,CAACC,EAAaC,EAAiBC,KACrC,WACE,IAAIC,EAAOH,EAAI,WACf,IAAII,EAAKJ,EAAI,WAAa,QACpBE,EAAMG,QAAQF,EAAMC,EAC3B,EAJD,EAII,EAENE,QAASN,GACAA,EAAI,WAAa,GAG5B,CACEH,MAAO,KACPC,KAAM,iBACNC,OAAQ,CAACC,EAAaC,EAAiBC,KACrC,WACE,IAAIC,EAAOH,EAAI,WACf,IAAII,EAAKJ,EAAI,WAAa,QACpBE,EAAMG,QAAQF,EAAMC,EAC3B,EAJD,EAII,EAENE,QAASN,GACAA,EAAI,WAAad,KAAKvB,SAAS+B,OAAS,G,CAMvD,IAAIa,EAAIjB,EAAcI,QAAU,EAAI,EAAI,EACxC,GAAIR,KAAKjB,SAAU,CACjBqB,EAAciB,GAAGZ,QAAQC,KAAK,CAC5BC,MAAO,KACPC,KAAM,aACNC,OAAQ,CAACC,EAAaC,EAAiBO,KACrC,WACEtB,KAAKX,QAAQkC,KAAKT,EACnB,EAFD,EAEI,G,CAIV,GAAId,KAAKhB,SAAU,CACjBoB,EAAciB,GAAGZ,QAAQC,KAAK,CAC5BC,MAAO,KACPC,KAAM,4BACNC,OAAQ,CAACC,EAAaC,EAAiBO,KACrC,WACEtB,KAAKV,UAAUiC,KAAKT,EACrB,EAFD,EAEI,G,CAIV,GAAId,KAAKf,UAAW,CAClBmB,EAAciB,GAAGZ,QAAQC,KAAK,CAC5BC,MAAO,KACPC,KAAM,SACNC,OAAQ,CAACC,EAAaC,EAAiBO,KACrC,WACEtB,KAAKT,UAAUgC,KAAKT,EACrB,EAFD,EAEI,G,EA6DZ,MAAAU,GACE,OACEC,EAACC,EAAI,CAAAC,IAAA,4CACHF,EAAA,eAAAE,IAAA,2CACE7C,WAAYkB,KAAKlB,WACjBD,WAAYmB,KAAKnB,WACjBF,QAASiD,EAAgB5B,KAAKrB,SAC9BD,QAASsB,KAAKtB,QACdD,QAASuB,KAAKvB,QACdG,WAAYoB,KAAKpB,WACjBO,OAAQa,KAAKb,OACb0C,IAAKC,GAAO9B,KAAKR,SAAWsC,I","ignoreList":[]}