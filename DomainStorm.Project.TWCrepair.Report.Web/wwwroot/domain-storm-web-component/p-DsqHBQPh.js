import{e as n,h as t}from"./p-9Du3dL5x.js";function e(n){var t,r,o="";if("string"==typeof n||"number"==typeof n)o+=n;else if("object"==typeof n)if(Array.isArray(n)){var s=n.length;for(t=0;t<s;t++)n[t]&&(r=e(n[t]))&&(o&&(o+=" "),o+=r)}else for(r in n)n[r]&&(o&&(o+=" "),o+=r);return o}function r(){for(var n,t,r=0,o="",s=arguments.length;r<s;r++)(n=arguments[r])&&(t=e(n))&&(o&&(o+=" "),o+=t);return o}function o(n="",t=""){const e=crypto.randomUUID();const r=[];if(n)r.push(n);r.push(e);if(t)r.push(t);return r.join("_")}function s(n){if(n==null)return{};return Object.fromEntries(Object.entries(n).filter((([n,t])=>t!=null)))}const i=new Map;const f=500;function u(n,t){if(n==null)return n;if(typeof t==="number"){return Array.isArray(n)?n[t]:undefined}if(typeof t!=="string"){throw new Error("Field must be a string or a number")}const e=t.trim();if(e==="")return undefined;let r=i.get(e);if(!r){r=c(e);if(i.size>=f){const n=i.keys().next().value;i.delete(n)}i.set(e,r)}let o;switch(r.type){case"pipe":{o=l(n,r.parts);break}case"ampersand":{o=p(n,r.parts);break}case"dot":{const t=r.firstField;const e=r.subField;const s=u(n,t);o=u(s,e);break}case"simple":{const t=r.firstField;if(Array.isArray(n)&&n.length>0&&typeof n[0]==="object"&&n[0]!==null){o=n.map((n=>u(n,t)))}else if(typeof n==="object"&&n!==null){o=n[t]}else{o=undefined}break}default:{o=undefined;break}}if(r.removeNull&&Array.isArray(o)){const n=[];for(let t=0;t<o.length;t++){const e=o[t];if(e!=null)n.push(e)}return n}return o}function c(n){let t=n;let e=-1;let r=-1;let o=-1;for(let n=0;n<t.length;n++){const s=t[n];if(s==="|"&&e===-1)e=n;else if(s==="&"&&r===-1)r=n;else if(s==="."&&o===-1)o=n}if(e!==-1){return{type:"pipe",parts:t.split("|")}}if(r!==-1){return{type:"ampersand",parts:t.split("&")}}if(o!==-1){return{type:"dot",firstField:t.substring(0,o),subField:t.substring(o+1)}}return{type:"simple",firstField:t.endsWith("!")?t.slice(0,-1):t,removeNull:t.endsWith("!")}}function a(n,t,e){if(n==null){return}if(typeof t==="number"){if(Array.isArray(n)){n[t]=e}return}if(typeof t!=="string"){throw new Error("Field must be a string or a number")}const r=t.trim();if(r==="")return;let o=i.get(r);if(!o){o=c(r);if(i.size>=f){const n=i.keys().next().value;i.delete(n)}i.set(r,o)}if(o.type==="pipe"||o.type==="ampersand"){const t=o.parts;for(let r=0;r<t.length;r++){const o=t[r].trim();if(o&&u(n,o)!==undefined){a(n,o,e);return}}const r=t[0]?.trim();if(r){a(n,r,e)}return}if(o.type==="dot"){if(typeof n==="object"){const t=n[o.firstField];if(t!==undefined){a(t,o.subField,e)}}return}if(Array.isArray(n)&&n.length>0&&typeof n[0]==="object"){for(let t=0;t<n.length;t++){const o=n[t];if(o&&typeof o==="object"){o[r]=e}}}else if(typeof n==="object"){n[r]=e}}function l(n,t){for(const e of t){const t=e.trim();if(t){const e=u(n,t);if(e!=null)return e}}return null}function p(n,t){const e=[];for(const r of t){const t=r.trim();if(t){const r=u(n,t);if(r!=null){if(Array.isArray(r)){e.push(...r)}else{e.push(r)}}}}return e}function y(n,t,...e){if(t==null)return t;if(typeof t==="string"){if(b(t)){t=d(t)}else{const e=t.split(".");let r=n||(typeof window!=="undefined"?window:globalThis);for(const n of e){r=r?.[n];if(r===undefined)break}if(typeof r==="function"){t=r}}}if(typeof t==="function"){return $(n,t,...e)}return t}function d(n){if(typeof n!=="string"||n.trim()===""){throw new Error("Function string cannot be empty")}const t=/^export default\s+(async\s+)?function\s*\(([^)]*)\)\s*{([\s\S]*)}$/;const e=t.exec(n);if(!e){throw new Error("Invalid function string")}const r=!!e[1];const o=e[2].split(",").map((n=>n.trim())).filter(Boolean);const s=e[3].trim();const i=new Compartment;const f=r?Object.getPrototypeOf((async function(){})).constructor:Function;const u=new i.globalThis[f.name](...o,s);return u}function b(n){if(typeof n!=="string"){return false}const t=n.trim();const e=/^export\s+default\s+function\s*[a-zA-Z0-9_$]*\s*\([^)]*\)\s*{[\s\S]*}$/;return e.test(t)}function g(n,t){const e=n.filter((n=>n.conjunction!=="or"));const r=n.filter((n=>n.conjunction==="or"));if(e.some((n=>!m(n,t)))){return false}if(r.length>0&&!r.some((n=>m(n,t)))){return false}return true}function m(n,t){try{const e=y(null,n.field,t);const r=y(null,n.operator,t);const o=y(null,n.value,t);const s=A(t,e);if(s===null||s===undefined){if(r==="=")return o===null||o===undefined;if(r==="!=")return o!==null&&o!==undefined;if(r==="empty")return true;if(r==="notempty")return false;return false}switch(r){case">":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n>t}case"<":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n<t}case">=":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n>=t}case"<=":{const n=+s;const t=+o;return!isNaN(n)&&!isNaN(t)&&n<=t}case"=":return s===o||typeof s==="number"&&typeof o==="string"&&s===+o&&!isNaN(+o)||typeof s==="string"&&typeof o==="number"&&+s===o&&!isNaN(+s);case"!=":return s!==o&&!(typeof s==="number"&&typeof o==="string"&&s===+o&&!isNaN(+o))&&!(typeof s==="string"&&typeof o==="number"&&+s===o&&!isNaN(+s));case"like":{const n=String(s).toLowerCase();const t=String(o).toLowerCase();return n.includes(t)}case"include":return Array.isArray(s)&&s.includes(o);case"notinclude":return Array.isArray(s)&&!s.includes(o);case"in":return Array.isArray(o)&&o.includes(s);case"notin":return Array.isArray(o)&&!o.includes(s);case"typeof":if(typeof o!=="string"){console.warn("typeof 運算符需要字串型別的比較值");return false}return typeof s===o;case"instanceof":if(typeof o!=="function"){console.warn("instanceof 運算符需要函數型別的比較值");return false}return s instanceof o;case"empty":return s===""||Array.isArray(s)&&s.length===0||typeof s==="object"&&s!==null&&Object.keys(s).length===0;case"notempty":return s!==""&&!(Array.isArray(s)&&s.length===0)&&!(typeof s==="object"&&s!==null&&Object.keys(s).length===0);case"match":try{const n=String(o);return new RegExp(n).test(String(s))}catch(n){console.error("無效的正則表達式:",o);return false}default:throw new Error(`不支援的運算符: ${r}`)}}catch(n){console.error("條件檢查失敗:",n);return false}}function N(n,t){const e=/\{([^}]+)\}/g;return n.replace(e,((n,e)=>{const r=u(t,e);return r!==undefined?String(r):""}))}function w(n){if(!n)return{};if(typeof n==="object")return n;const t=n.trim();if(!t)return{};return t.split(/\s+/).reduce(((n,t)=>{if(t)n[t]=true;return n}),{})}function j(n,t){const e=r(n,t);if(!e)return{};return e.split(/\s+/).reduce(((n,t)=>{if(t)n[t]=true;return n}),{})}function A(n,t,e){if(!n||typeof n!=="object"){return null}let r=u(n,t);if(typeof r==="string"&&b(r)){try{r=d(r);a(n,t,r)}catch(n){console.error(`無法解析函式字串 '${t}':`,n);return null}}try{return $(n,r,...e||[])}catch(n){console.error(`執行屬性 '${t}' 時發生錯誤:`,n);return null}}function h(n,e,r='<span class="bg-warning text-dark">$1</span>'){if(!e||!n){return n}try{const o=t.encode(e);const s=new RegExp(`(${o})`,"gi");const i=r.replace("$1","$&");return n.replace(s,i)}catch(t){console.error("搜尋高亮處理錯誤:",t);return n}}function $(n,t,...e){if(typeof t!=="function"){return t}return t.apply(n,e)}function S(n){if(n==null||!Array.isArray(n)){return false}return n.every((n=>typeof n==="object"&&n!==null&&"field"in n&&"operator"in n&&"value"in n))}function k(n){if(n==null||!Array.isArray(n)){return false}return n.every((n=>typeof n==="object"&&n!==null&&"conditions"in n&&S(n.conditions)&&"value"in n))}function v(n,t,e="single"){if(!Array.isArray(n)||n.length===0)return null;const r=n.filter((n=>n.selected===true&&n.id)).map((n=>String(n.id)));if(r.length===0){if(t||e==="none"){return null}const o=n.find((n=>n.id));if(o){r.push(String(o.id))}else{return null}}return e==="single"?r[0]:r}function x(n){if(Array.isArray(n)){if(n.length===0){return false}return n.some((n=>x(n)))}return typeof n==="string"&&n.trim()!==""}function E(t,e){return t==e||n(t,e)}function F(n,t){return(t,...e)=>{{const r=new Date;const o=r.toTimeString().split(" ")[0]+"."+String(r.getMilliseconds()).padStart(3,"0");console.log(`[${o}][${n}::${t}]`,...e)}}}export{u as a,d as b,F as c,E as d,y as e,h as f,o as g,v as h,b as i,k as j,S as k,g as l,j as m,N as n,s as o,w as p,x as q,A as r,a as s};
//# sourceMappingURL=p-DsqHBQPh.js.map