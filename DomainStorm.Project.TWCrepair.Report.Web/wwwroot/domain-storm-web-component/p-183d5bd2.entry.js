import{r as t,c as e,h as i,H as s,a,f as h}from"./p-CSg1USUf.js";import{j as n,k as r,n as l,b as o,i as c,e as d,p as u,s as f,d as m,f as w}from"./p-BArszdml.js";import{C as b}from"./p-Dk4EqV8F.js";import{a as y}from"./p-B6gbR0LJ.js";import{S as p}from"./p-B0cWbvbo.js";const S=":host{display:block}";const g=class{constructor(i){t(this,i);this.valueChanged=e(this,"valueChanged")}_dataSet;type="checkbox";labelClasses="custom-control-label";isSwitch=false;isInline=false;dataSet;value;disabled;valueChanged;dataSetWatcher(t){try{this._dataSet=typeof t==="string"?JSON.parse(t):t}catch(t){console.error("Invalid JSON format:",t);return}if(this.value){this.valueWatcher(this.value)}else this.value=this.type==="checkbox"?this._dataSet.find((t=>t.checked))?.id:this._dataSet.filter((t=>t.checked)).map((t=>t.id));if(this.type==="radio"){const t=this._dataSet.filter((t=>t.checked));if(t.length===0){this._dataSet[0].checked=true}else if(t.length>1){t.reverse().slice(1).forEach((t=>t.checked=false))}}}valueWatcher(t){if(Array.isArray(t))this._dataSet.forEach((e=>e.checked=t.includes(e.id)));else this._dataSet.forEach((e=>e.checked=e.id==t))}check(t){if(this.type==="radio"){this.uncheckAll()}t.checked=true;if(this.type==="radio"){this.value=t.id}else if(Array.isArray(this.value)){if(!this.value.includes(t.id))this.value=[...this.value,t.id]}else{this.value=[t.id]}}uncheck(t){t.checked=false;if(this.type==="radio"){if(this.value===t.id){this.value=null}}else if(Array.isArray(this.value)){this.value=this.value.filter((e=>e!==t.id))}}uncheckAll(){if(this._dataSet){this._dataSet.filter((t=>t.checked)).forEach((t=>t.checked=false))}}componentWillLoad(){if(this.dataSet){this.dataSetWatcher(this.dataSet)}}dataSetRender(){return this._dataSet.map((t=>{if(!t.id)t.id=t.label;return i("storm-checkbox",{type:this.type,label:t.label,labelClasses:t.labelClasses??this.labelClasses,disabled:this.disabled||t.disabled,checked:t.checked,isSwitch:this.isSwitch,isInline:this.isInline,onValueChanged:e=>{if(e.detail){this.check(t)}else{this.uncheck(t)}}})}))}render(){return i(s,{key:"f965177356115f1631386a8f879d73d6878d7420"},this.dataSetRender())}static get watchers(){return{dataSet:["dataSetWatcher"],value:["valueWatcher"]}}};g.style=S;const k=":host{display:block}";const C=class{constructor(i){t(this,i);this.valueChanged=e(this,"valueChanged");this.textChanged=e(this,"textChanged");this.searchChanged=e(this,"searchChanged")}_dropdownRef;_treeRef;_text;get host(){return a(this)}label;heading;text;value;dataSet;dataSource;disabled;nullable=false;fieldId="id";fieldLabel="label";fieldChildren="children";expandLevel=2;nodeSelectableRule;size="Default";partialLoad=false;loading="lazy";class;valid;required;searchText;searchable=false;selection="single";timeStamp;valueChanged;textChanged;searchChanged;valueWatcher(){this.updateValue();this.valueChanged.emit(this.value)}textWatcher(){this.textChanged.emit(this.text)}dataSetWatcher(){this._treeRef.dataSet=this.dataSet}updateValue(){if(this._treeRef.value!=this.value)this._treeRef.value=this.value;if(this._dropdownRef.value!=this.value)this._dropdownRef.value=this.value}componentDidLoad(){this.updateValue()}renderTree(){return i("storm-tree-view",{ref:t=>this._treeRef=t,partialLoad:this.partialLoad,loading:this.loading,value:this.value,class:this.class,dataSet:this.dataSet,dataSource:this.dataSource,fieldId:this.fieldId,fieldLabel:this.fieldLabel,fieldChildren:this.fieldChildren,nullable:this.nullable,selection:this.selection,expandLevel:this.expandLevel,nodeSelectableRule:this.nodeSelectableRule,searchable:this.searchable,onValueChanged:t=>{t.stopPropagation();this.value=t.detail},onNodeClick:async t=>{t.stopPropagation();await this._dropdownRef.hide()},onSearchChanged:t=>{t.stopPropagation();this.searchChanged.emit(t.detail)}})}async componentWillRender(){this._text=this.text;if(this._text==null){if(this._treeRef&&this.value){const t=Array.isArray(this.value)?this.value:[this.value];const e=[];for(const i of t){const t=await this._treeRef.getNodeById(i);if(t){e.push(await this._treeRef.getLabel(t))}}this._text=e.join("、")}else{this._text=undefined}}}render(){return i(s,{key:"a4647520c2758797c77c49969fb51ed1a1f97a9e"},i("storm-dropdown",{key:"68b78235cb56b109ccacc049f9171ee807da72c8",ref:t=>this._dropdownRef=t,nullable:this.nullable,heading:this.heading,label:this.label,text:this._text,value:this.value,showSelected:true,valid:this.valid,required:this.required,disabled:this.disabled,timeStamp:this.timeStamp,type:"select",onValueChanged:t=>{t.stopPropagation();this.value=t.detail;if(this.value==null){this.text=undefined}},onUnselectedAll:async t=>{t.stopPropagation();await this._treeRef.unselectAll()},onShowMenu:async t=>{t.stopPropagation();await this._treeRef.loadDataSet();if(this.searchable&&this._treeRef){requestAnimationFrame((async()=>{await this._treeRef.setSearchFocus()}))}}},this.renderTree()))}static get watchers(){return{value:["valueWatcher"],text:["textWatcher"],dataSet:["dataSetWatcher"]}}};C.style=k;const v=":host{display:block}:host storm-button,:host storm-dropdown,:host div{vertical-align:middle}:host .btn:hover:not(.active){color:white}:host .btn.btn-outline-primary:hover{background-color:#e91e63}:host .btn.disabled{color:#7b809a;border-color:#7b809a;cursor:not-allowed}";const _=class{constructor(i){t(this,i);this.clickAction=e(this,"clickAction")}_dateSet;get host(){return a(this)}table;column;row;isDynamicLabel=true;timeStamp;clickAction;componentWillRender(){this._dateSet=this.column.buttons?.map((t=>{const e={id:t.id,type:t.type,label:t.label,tooltip:t.tooltip,icon:t.icon,size:"sm",buttonStyle:"outline-primary",rounded:true,visible:()=>{if(n(t.visible)){return r(t.visible,this.row)}return l(this,t.visible,this.row,this.table,o(this.row,this.table.fieldIndex))??true},disabled:()=>{if(n(t.disabled)){return r(t.disabled,this.row)}return l(this,t.disabled,this.row,this.table,o(this.row,this.table.fieldIndex))??false},items:t.items?t.items.map((t=>({id:t.id,title:t.title,icon:t.icon,selected:t.selected,visible:()=>{if(n(t.visible)){return r(t.visible,this.row)}return l(this,t.visible,this.row,this.table,o(this.row,this.table.fieldIndex))??true},disabled:()=>{if(n(t.disabled)){return r(t.disabled,this.row)}return l(this,t.disabled,this.row,this.table,o(this.row,this.table.fieldIndex))??false}}))):null,click:(e,i=null)=>{if(t.action)t.action(this.row,t,this.table,i);this.clickAction.emit({id:o(this.row,this.table.fieldId),field:this.column.field,actionId:t.id,dropdownItemId:i?i.id:null})}};return e}))}render(){return i(s,{key:"2ca137adfca720aa641beb012d95cddce600ea18"},i("storm-toolbar",{key:"5fa06bcf50e094dd834d3f820f223a31624142a8",class:{"storm-dynamic-label":this.isDynamicLabel,"justify-content-start":this.column.align==="left","justify-content-center":this.column.align==="center","justify-content-end":this.column.align==="right"},dataSet:this._dateSet,timeStamp:this.timeStamp}))}};_.style=v;const x=":host{display:block}";const A=class{constructor(i){t(this,i);this.toolbarAction=e(this,"toolbarAction")}dataSet;timeStamp;class;toolbarAction;renderToolbarItem(t){if(typeof t.visible==="function"&&!t.visible())return;if(typeof t.visible==="boolean"&&!t.visible)return;if(t.type==="group"){return this.renderDropdown(t)}else if(t.type==="divider"){return i("div",{class:"d-inline-flex align-middle mx-2"},i("div",{class:"vr"}))}else{return i("storm-toolbar-item",{dataSet:t,onToolbarAction:e=>{this.handleAction(e,t)}})}}handleAction(t,e,i=null){if(!e.click)return;if(typeof e.click==="string"){if(!c(e.click)){throw new Error("Invalid function string")}e.click=d(e.click)}e.click(e,i);this.toolbarAction.emit(i?i.id:e.id)}renderDropdown(t){if(!t||!t.items||t.items.length===0)return;return i("div",{class:"d-inline-flex align-middle"},i("storm-dropdown",{dataSet:t.items,trigger:"click",toggleIcon:"more_vert",type:"none",selection:"none",nullable:true,showSelected:false,onItemClick:e=>{this.handleAction(e,t,e.detail)}}))}render(){if(!this.dataSet)return;return i("div",{class:"w-100"},i("div",{class:{"d-flex":true,...u(this.class)}},this.dataSet.map((t=>this.renderToolbarItem(t)))))}};A.style=x;class H{dbPromise=null;maxEntries;dbName;dbVersion;constructor(t=1e3,e="StencilCacheDB",i=1){this.maxEntries=t;this.dbName=e;this.dbVersion=i}openDB(){if(!this.dbPromise){this.dbPromise=new Promise(((t,e)=>{const i=window.indexedDB.open(this.dbName,this.dbVersion);i.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains("cache")){const t=e.createObjectStore("cache",{keyPath:"key"});t.createIndex("timestamp","timestamp",{unique:false})}};i.onsuccess=e=>{t(e.target.result)};i.onerror=()=>{this.dbPromise=null;e(i.error)}}))}return this.dbPromise}async withTransaction(t,e){const i=await this.openDB();const s=i.transaction("cache",t);return await e(s.objectStore("cache"))}async get(t){return await this.withTransaction("readonly",(e=>new Promise(((i,s)=>{const a=e.get(t);a.onsuccess=()=>{const t=a.result;i(t?{value:t.value,timestamp:t.timestamp,ttlMillis:t.expiredMillis}:null)};a.onerror=()=>s(a.error)}))))}async set(t,e){await this.withTransaction("readwrite",(async i=>new Promise(((s,a)=>{const h=i.count();h.onsuccess=()=>{const n=h.result;const r=()=>{const h=i.put({key:t,...e});h.onsuccess=()=>s();h.onerror=()=>a(h.error)};if(n>=this.maxEntries){const t=i.index("timestamp");const e=t.openCursor();e.onsuccess=t=>{const e=t.target.result;if(e){const t=e.delete();t.onsuccess=r;t.onerror=()=>a(t.error)}else{r()}};e.onerror=()=>a(e.error)}else{r()}};h.onerror=()=>a(h.error)}))))}async delete(t){await this.withTransaction("readwrite",(e=>new Promise(((i,s)=>{const a=e.delete(t);a.onsuccess=()=>i();a.onerror=()=>s(a.error)}))))}async clear(){await this.withTransaction("readwrite",(t=>new Promise(((e,i)=>{const s=t.clear();s.onsuccess=()=>e();s.onerror=()=>i(s.error)}))))}get defaultKeyPrefix(){return"idb"}async size(){return await this.withTransaction("readonly",(t=>new Promise(((e,i)=>{const s=t.count();s.onsuccess=()=>e(s.result);s.onerror=()=>i(s.error)}))))}setMaxEntries(t){this.maxEntries=t}getMaxEntries(){return this.maxEntries}}const I=new b(new H,{regionName:"fetchDataSource"});async function L(t){t={method:"POST",contentType:"application/json",...t};const e=JSON.stringify(t);const i=await I.get(e);if(i!==null){return i}const s=await fetch(t.url,{method:t.method,body:t.method!=="GET"?JSON.stringify(t.body??{}):null,headers:new Headers({"Content-Type":t.contentType})});if(!s.ok){throw new Error(`Network response was not ok: ${s.statusText}`)}const a=t.contentType==="application/json"?await s.json():await s.text();await I.set(e,a);return a}const N=":host{display:block;background-color:#fff}:host .list-group-item{border:none !important;white-space:nowrap !important;cursor:pointer !important;margin-bottom:0 !important}:host .close.material-icons,:host .open.material-icons:hover{opacity:0.5}:host .open.material-icons,:host .close.material-icons:hover{opacity:1}:host .material-icons:empty{width:1.25rem}:host .indent{margin-left:0.575rem;margin-right:0.575rem}:host .leaf{margin-left:0.6rem}";const R=class{constructor(i){t(this,i);this.dateSetLoaded=e(this,"dateSetLoaded");this.valueChanged=e(this,"valueChanged");this.nodeSelect=e(this,"nodeSelect");this.nodeUnselect=e(this,"nodeUnselect");this.nodeClick=e(this,"nodeClick");this.nodeDblClick=e(this,"nodeDblClick");this.nodeCheck=e(this,"nodeCheck");this.nodeUncheck=e(this,"nodeUncheck");this.checkedChanged=e(this,"checkedChanged");this.searchChanged=e(this,"searchChanged");this.keydown=e(this,"keydown")}_searchText;_dataSet;_items;_dataSource;_searchRef;_nodeSelectableRule;_nodeCheckRule;get host(){return a(this)}partialLoad=false;loading="eager";value;checked=[];fieldId="id";fieldLabel="label";fieldChildren="children";fieldSubId="subId";fieldSubLabel="subLabel";fieldSubChildren="subChildren";fieldSelected="_selected";fieldChecked="_checked";fieldExpanded="_expanded";fieldDisabled="_disabled";fieldParent="_parent";fieldSelectable="_selectable";fieldCheckSelectable="_checkSelectable";fieldIcon="_icon";fieldHref="_href";fieldLevel="_level";fieldChildLoaded="_loaded";fieldElement="_element";expandIconAlign="left";expandIcon;collapseIcon;color;dataSet;dataSource;fetch;nullable=true;expandLevel=2;structure="auto";searchable=false;selection="single";nodeSelectableRule;checkSelectable=false;nodeCheckRule;selectToCheck=true;dateSetLoaded;valueChanged;nodeSelect;nodeUnselect;nodeClick;nodeDblClick;nodeCheck;nodeUncheck;checkedChanged;searchChanged;keydown;async searchChangedHandler(t){this._searchText=t.detail;if(this.partialLoad){this.cleanNodes();await this.loadDataSet()}else{this.rerender()}}nodeSelectHandler(t){switch(this.selection){case"single":this.value=t.detail;break;case"multiple":{const e=Array.isArray(this.value)?this.value:this.value?[this.value]:[];if(!e.includes(t.detail))this.value=[...e,t.detail];break}default:console.warn(`Unknown selection mode: ${this.selection}`)}}nodeUnselectHandler(t){switch(this.selection){case"single":if(this.value===t.detail){this.value=null}break;case"multiple":{const e=Array.isArray(this.value)?this.value:[];if(e.includes(t.detail))this.value=e.filter((e=>e!==t.detail));break}default:console.warn(`Unknown selection mode: ${this.selection}`)}}nodeCheckHandler(t){if(this.selectToCheck)return;if(!this.checked.includes(t.detail))this.checked=[...this.checked,t.detail]}nodeUncheckHandler(t){if(this.selectToCheck)return;if(this.checked.includes(t.detail))this.checked=this.checked.filter((e=>e!==t.detail))}async valueChangedHandler(){if(!Array.isArray(this._items))return;const t=Array.isArray(this.value)?this.value:this.value?[this.value]:[];await Promise.all(this._items.map((async e=>{const i=String(o(e,this.fieldId));const s=t.includes(i);const a=o(e,this.fieldSelected)===true;const h=[];if(s){h.push(this.setNodeExpanded(e))}if(a!==s){h.push(this.setNodeSelectionState(e,s))}return Promise.all(h)})));if(this.checkSelectable&&this.selectToCheck){this.checked=t}}async checkedChangedHandler(){if(!Array.isArray(this._items))return;await Promise.all(this._items.map((t=>{const e=String(o(t,this.fieldId));const i=Array.isArray(this.checked)?this.checked:this.checked?[this.checked]:[];const s=i.includes(e);const a=o(t,this.fieldChecked)===true;if(a!==s){return this.setNodeCheckedState(t,s)}return Promise.resolve()})))}async watchValueHandler(){this.valueChanged.emit(this.value)}async watchCheckedHandler(){this.checkedChanged.emit(this.checked)}async setNodeSelectionState(t,e){const i=await this.getTreeNode(t);if(i){await(e?i.select():i.unselect())}else{f(t,this.fieldSelected,e)}if(this.checkSelectable&&this.selectToCheck){await this.setNodeCheckedState(t,e)}}async setNodeCheckedState(t,e){const i=await this.getTreeNode(t);if(i){await(e?i.check():i.uncheck())}else{f(t,this.fieldChecked,e)}}watchDataSourceHandler(){this.cleanNodes();if(typeof this.dataSource==="string"){if(c(this.dataSource)){this._dataSource=d(this.dataSource)}else if(this.dataSource.startsWith("{")&&this.dataSource.endsWith("}")){this._dataSource=JSON.parse(this.dataSource)}else{this._dataSource={url:this.dataSource}}}else{this._dataSource=this.dataSource}}watchNodeSelectableRuleHandler(){if(typeof this.nodeSelectableRule==="string"){if(c(this.nodeSelectableRule)){this._nodeSelectableRule=d(this.nodeSelectableRule)}}else{this._nodeSelectableRule=this.nodeSelectableRule}}watchNodeCheckRuleHandler(){if(typeof this.nodeCheckRule==="string"){if(c(this.nodeCheckRule)){this._nodeCheckRule=d(this.nodeCheckRule)}}else{this._nodeCheckRule=this.nodeCheckRule}}async watchDataSetHandler(){this.cleanNodes();await this.watchValueHandler();await this.watchCheckedHandler()}async getNodeById(t){if(!this._items)return null;return this._items.find((e=>o(e,this.fieldId)===t))}async getTreeNode(t){return o(t,this.fieldElement)}async getLabel(t){return o(t,this.fieldLabel)}async unselectAll(){this.value=null}async loadDataSet(){if(this._dataSet)return;if(this.dataSource||this.fetch){try{const t=await this.getDataSource();this.setDataSet(t)}catch(t){console.error("Error loading data:",t)}}else{this.setDataSet(this.dataSet)}}async getSelected(){return this._items.filter((t=>o(t,this.fieldSelected)))}async getSelectedById(){return await this.getSelected().then((t=>t.map((t=>o(t,this.fieldId)))))}async setSearchFocus(){if(this.searchable&&this._searchRef){await this._searchRef.setFocus()}}rerender=m((async()=>{if(!Array.isArray(this._items)||this._items.length===0)return;await Promise.all(this._items.map((async t=>{const e=await this.getTreeNode(t);if(e){h(e)}})));h(this)}),100);renderNode(t){let e=o(t,this.fieldLabel);if(e&&this._searchText){e=w(e,this._searchText)}return i("storm-tree-node",{tree:this,dataSet:t,content:e,searchText:this._searchText})}async setNodeExpanded(t){let e=o(t,this.fieldParent);while(e){const t=await this.getTreeNode(e);if(t){await t.expand().catch((t=>{console.error("Failed to expand tree node:",t)}))}else{f(e,this.fieldExpanded,true)}e=o(e,this.fieldParent)}}cleanNodes(){this._dataSet=undefined;this._items=undefined}async getDataSource(t=null){if(this.fetch){return this.fetch(t?.dataSet)}else{const e=typeof this._dataSource==="function"?this._dataSource(t?.dataSet,this._searchText):this._dataSource;return await L(e)}}async loadChild(t){try{const e=await this.getDataSource(t);const i=this.dataSetParse(e);await this.mergeChild(i,this.fieldChildren.split("&").map((t=>t.trim())));f(t.dataSet,this.fieldChildLoaded,true);this._items=this.updateItems(this._dataSet)}catch(t){console.error("Error loading data:",t)}}async mergeChild(t,e){for(const i of t){const t=await this.getNodeById(o(i,this.fieldId));for(const s of e){const e=o(i,s);const a=o(t,s);if(!!e&&(!a||a.length==0)){f(t,s,e)}else if(!!e&&e.length>0){await this.mergeChild(e,[s])}}}}dataSetParse(t){const e=JSON.parse(JSON.stringify(t));const i=this.structure==="auto"?!Array.isArray(e)&&!!this.fieldChildren?"tree":"array":this.structure;switch(i){case"tree":return o(e,this.fieldChildren);case"array":return e;default:throw new Error(`Unsupported structure type: ${i}`)}}setDataSet(t){if(!t)return;this._dataSet=this.dataSetParse(t);this._items=this.updateItems(this._dataSet);this.rerender()}updateItems(t,e=null){if(!t||t.length===0)return[];const i=[];for(const s of t){let t=o(s,this.fieldId);if(t==null){t=o(s,this.fieldLabel);f(s,this.fieldId,t)}if(this.selection!="none"&&s[this.fieldSelectable]==null){f(s,this.fieldSelectable,l(this,this._nodeSelectableRule,s)??true)}if(this.checkSelectable&&s[this.fieldCheckSelectable]==null){f(s,this.fieldCheckSelectable,l(this,this._nodeCheckRule,s)??true)}let a=1;if(e){f(s,this.fieldParent,e);a=o(e,this.fieldLevel)+1}f(s,this.fieldLevel,a);if(!o(s,this.fieldChildLoaded)){f(s,this.fieldExpanded,this.expandLevel>a);f(s,this.fieldChildLoaded,!this.partialLoad||this.expandLevel>a)}i.push(s);const h=o(s,this.fieldChildren);if(h&&h.length>0){i.push(...this.updateItems(h,s))}}return i}async componentWillLoad(){await p.applyShadowRootStylesAsync(this.host,"material");this.expandIcon=this.expandIcon??(this.expandIconAlign==="right"?"add":"chevron_right");this.collapseIcon=this.collapseIcon??(this.expandIconAlign==="right"?"remove":"expand_more");this.watchDataSourceHandler();this.watchNodeSelectableRuleHandler();this.watchNodeCheckRuleHandler()}async componentWillRender(){if(this.loading==="eager"||!this.partialLoad){await this.loadDataSet()}if(this.selection!="none"&&!this.nullable&&!this.value&&this._items?.length){this.value=o(this._items.find((t=>o(t,this.fieldSelectable))),this.fieldId)}await this.watchValueHandler();await this.watchCheckedHandler()}async componentDidLoad(){if(this._items?.length){this.dateSetLoaded.emit()}}handleSearchChanged(t){t.stopPropagation();const e=t.detail?.trim()??"";if(this._searchText===e)return;if(e){this.searchChanged.emit(e)}}renderSearch(){if(!this.searchable)return;return i(y,{ref:t=>this._searchRef=t,value:this._searchText,onValueChanged:t=>this.handleSearchChanged(t)})}nodesRender(){let t=[];if(this.partialLoad||!this.searchable||this._searchText==null||!this._searchText.length){t=this._dataSet}else{t=this._items.filter((t=>o(t,this.fieldLabel).includes(this._searchText)))}if(t.length===0)return i("div",{class:"align-middle text-center p-4 h6"},"沒有找到符合的結果");return t.map((t=>this.renderNode(t)))}render(){if(!this._dataSet)return;return i(s,null,this.renderSearch(),this.nodesRender())}static get watchers(){return{value:["watchValueHandler"],checked:["watchCheckedHandler"],dataSource:["watchDataSourceHandler"],nodeSelectableRule:["watchNodeSelectableRuleHandler"],nodeCheckRule:["watchNodeCheckRuleHandler"],dataSet:["watchDataSetHandler"]}}};R.style=N;export{g as storm_checkbox_group,C as storm_dropdown_tree,_ as storm_table_toolbar,A as storm_toolbar,R as storm_tree_view};
//# sourceMappingURL=p-183d5bd2.entry.js.map