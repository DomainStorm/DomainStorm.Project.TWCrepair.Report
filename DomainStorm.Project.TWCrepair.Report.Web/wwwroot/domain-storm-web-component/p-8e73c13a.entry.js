import{r as e,c as t,a as i,f as s,h as a,H as c}from"./p-SZOiivfx.js";import{S as r}from"./p-B0cWbvbo.js";const h="";const n=class{constructor(i){e(this,i);this.scroll=t(this,"scroll");this.checkedChanged=t(this,"checkedChanged")}_dataSet;verticalSLotRef;treeViewRef;verticalList;navigationList;verticalListReverse;verticals;isDebouncing=false;ticking=false;get host(){return i(this)}treeViewable=true;dataSet;fixTop=10;scrollY;selectToCheck=false;checkSelectable=false;scroll;checked;checkedChanged;fieldIcon="icon";fieldSelected="_selected";value;dataSetWatcher(e){if(typeof e==="string"){this._dataSet=JSON.parse(e)}else{this._dataSet=e}}scrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}innerScrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}requestFrame(){if(this.ticking)return;this.ticking=true;requestAnimationFrame((()=>{this.ticking=false;this.updateFrame()}))}updateFrame(){this.refresh();this.triggerActive();this.scroll.emit(this.scrollY)}refresh(){this.setVerticalData()}async getChecked(){return this.treeViewRef.checked}async componentWillLoad(){await r.applyShadowRootStylesAsync(this.host,"material");if(!this.dataSet)return;this.dataSetWatcher(this.dataSet)}componentDidRender(){if(this.verticalList&&this.navigationList)return;this.getVertical();this.setNavigationData()}componentDidLoad(){this.treeViewRef.addEventListener("nodeSelect",(async e=>{const t=await this.treeViewRef.getNodeById(e.detail);window.location.replace(window.location.origin+window.location.pathname+window.location.search+t["href"]);this.isDebouncing=true;setTimeout((()=>{this.isDebouncing=false}),1)}))}getVertical(){this.verticals=this.verticalSLotRef.assignedElements();if(this.verticals.length==0)return;this.setVerticalData()}getScrollContainer(e){while(e){if(e.classList.contains("ps")){break}e=e.parentElement}return e}setVerticalData(){this.verticalList=[];this.verticals.map((e=>{this.verticalList.push({href:"#"+e.getAttribute("id"),top:e.getBoundingClientRect().top+this.scrollY})}));this.verticalListReverse=this.verticalList.slice().reverse()}setNavigationData(){let e=this.treeViewRef.shadowRoot.querySelectorAll("storm-tree-node");if(e.length==0)return;this.navigationList=[];e.forEach((e=>{this.navigationList.push(e);if(e.children){e.querySelectorAll("storm-tree-node").forEach((e=>this.navigationList.push(e)))}}))}triggerActive(){const e=this.scrollY+window.innerHeight/2;const t=this.verticalListReverse.find((t=>t.top<=e));this.navigationList.forEach((e=>{const i=e.dataSet["href"]===t?.href;if(i&&!e.dataSet[this.fieldSelected]){this.addActive(e)}else if(!i&&e.dataSet[this.fieldSelected]){this.removeActive(e)}}))}addActive(e){e.dataSet[this.fieldSelected]=true;s(e)}removeActive(e){e.dataSet[this.fieldSelected]=false;s(e)}treeViewRender(){if(!this.treeViewable)return;return a("storm-tree-view",{class:"p-3",selection:"single",dataSet:this._dataSet,selectToCheck:this.selectToCheck,checkSelectable:this.checkSelectable,checked:this.checked,fieldIcon:this.fieldIcon,fieldSelected:this.fieldSelected,value:this.value,onCheckedChanged:e=>this.handleCheckedChanged(e),ref:e=>this.treeViewRef=e})}handleCheckedChanged(e){e.stopPropagation();this.checkedChanged.emit(e.detail)}render(){return a(c,{key:"e591ca9ee6365b8b682a7f7be39d82404fbb731d"},a("div",{key:"6978cb53ca795e2720b94516d90e5f64ab2f2bde",class:"container-fluid my-3 py-3"},a("div",{key:"8af6e746a876e908b0c2f1d45eaaa7fef86a7ae3",class:"row mb-5"},a("div",{key:"838ea706fd1aeaa9c3edd4e95a4690acf07fb5c1",class:"col-lg-9 mt-lg-0 mt-4"},a("slot",{key:"e3d60b361d6a3c90245ceb508505b2413dd0cd49",name:"vertical",ref:e=>this.verticalSLotRef=e})),a("div",{key:"dc5f64bad37f23137243fd0985ec5c4059f4a57d",class:"col-lg-3"},a("div",{key:"93565ff7dde00577f415f493b98083307d55a23e",class:"position-sticky "+"top-"+this.fixTop},a("slot",{key:"f679a8fe43fa5a634c0c0aeb3c67cb9f71e4f4b8",name:"navigation-header"}),a("div",{key:"4628d0124e0af104185f950c313cf7da305f3807",class:"card"},this.treeViewRender()))))))}static get watchers(){return{dataSet:["dataSetWatcher"]}}};n.style=h;export{n as storm_vertical_navigation};
//# sourceMappingURL=p-8e73c13a.entry.js.map