{"version":3,"file":"p-COi_sR8I.js","sources":["src/utils/cache/cache-service.ts"],"sourcesContent":["import type { CacheEntry, ICacheProvider } from './interface';\n\nexport interface CacheOptions {\n    expiredMillis?: number;\n    regionName?: string;\n}\n\nexport class CacheService {\n    private readonly provider: ICacheProvider;\n    private readonly defaultOptions: CacheOptions;\n\n    constructor(provider: ICacheProvider, options: CacheOptions = {}) {\n        if (!provider) {\n            throw new Error('CacheService requires a valid provider');\n        }\n        \n        this.provider = provider;\n        this.defaultOptions = {\n            regionName: (typeof options.regionName === 'string' && options.regionName.trim()) ? options.regionName : 'default',\n            expiredMillis: (typeof options.expiredMillis === 'number' && options.expiredMillis > 0) ? options.expiredMillis : 300000\n        };\n    }\n\n    private makeCompositeKey(regionName: string, key: string): string {\n        return `${regionName}:${key}`;\n    }\n\n    async get<T = any>(key: string, regionName = this.defaultOptions.regionName): Promise<T | null> {\n        if (!key || typeof key !== 'string') {\n            throw new Error('Cache key must be a non-empty string');\n        }\n        \n        const compositeKey = this.makeCompositeKey(regionName, key);\n        const entry = await this.provider.get(compositeKey);\n        \n        if (!entry) return null;\n        \n        const now = Date.now();\n        if (now - entry.timestamp > entry.expiredMillis) {\n            await this.provider.delete(compositeKey);\n            return null;\n        }\n        \n        return entry.value as T;\n    }\n\n    async set(\n        key: string,\n        value: any,\n        regionName = this.defaultOptions.regionName,\n        expiredMillis = this.defaultOptions.expiredMillis\n    ): Promise<void> {\n        if (!key || typeof key !== 'string') {\n            throw new Error('Cache key must be a non-empty string');\n        }\n        if (typeof expiredMillis !== 'number' || expiredMillis <= 0) {\n            throw new Error('expiredMillis must be a positive number');\n        }\n        \n        const compositeKey = this.makeCompositeKey(regionName, key);\n        const entry: CacheEntry = {\n            value,\n            timestamp: Date.now(),\n            expiredMillis,\n        };\n        await this.provider.set(compositeKey, entry);\n    }\n\n    async delete(key: string, regionName = this.defaultOptions.regionName): Promise<void> {\n        if (!key || typeof key !== 'string') {\n            throw new Error('Cache key must be a non-empty string');\n        }\n        \n        const compositeKey = this.makeCompositeKey(regionName, key);\n        await this.provider.delete(compositeKey);\n    }\n\n    async clearRegion(regionName = this.defaultOptions.regionName): Promise<void> {\n        const prefix = `${regionName}:`;\n        await this.provider.deleteByPrefix(prefix);\n    }\n\n    async clearAll(): Promise<void> {\n        await this.provider.clear();\n    }\n}\n"],"names":[],"mappings":"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"}