{"version":3,"file":"storm-select.entry.esm.js","sources":["src/components/storm-select/storm-select.css?tag=storm-select","src/components/storm-select/storm-select.tsx"],"sourcesContent":[".choices__list--dropdown,\r\n.choices__list[aria-expanded] {\r\n    z-index: 1030;\r\n}","import { Component, Element, Event, EventEmitter, Host, Prop, Watch, h } from '@stencil/core';\nimport { debounce, deepEqual } from '@utils/utils';\nimport Choices from 'choices.js';\nimport type { Choice } from 'choices.js/src/scripts/interfaces/choice';\n\n@Component({\n  tag: 'storm-select',\n  styleUrl: 'storm-select.css',\n  shadow: false,\n})\nexport class StormSelect {\n  private _choices: Choices;\n  private _dataSet: Choice[];\n  private _selectRef: HTMLSelectElement;\n\n  @Element() host: HTMLElement;\n\n  @Prop() label: string;\n  @Prop({ mutable: true }) value?: string | string[];\n  @Prop() name: string;\n  @Prop({ mutable: true }) dataSet: IOption[] | string;\n  @Prop() shouldSort: boolean = false;\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\n  @Prop() removeItemButton: boolean = false;\n  @Prop() duplicateItemsAllowed: boolean = false;\n  @Prop() searchable?: boolean;\n  @Prop() searchTimeOut: number = 500;\n  @Prop() searchFilter: boolean = true;\n\n  @Event() valueChanged: EventEmitter<string | string[]>;\n  @Event() change: EventEmitter<string | string[]>;\n  @Event() searchChange: EventEmitter<string>;\n\n  @Watch('dataSet')\n  dataSetWatcher() {\n    this.initDataSet();\n    if (this._selectRef?.getAttribute('data-choice') === 'active' && this._dataSet) {\n      if (this._dataSet.length) {\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\n      } else {\n        this._choices.clearStore();\n      }\n    }\n  }\n\n  @Watch('value')\n  valueWatcher() {\n    if (this._choices) {\n      const newValue = this._choices.getValue(true) as string[] | string;\n\n      if (Array.isArray(newValue) && Array.isArray(this.value)) {\n        if (!deepEqual(newValue, this.value)) {\n          this._choices.setChoiceByValue(this.value);\n        }\n      } else if (newValue !== this.value) {\n        this._choices.setChoiceByValue(this.value);\n      }\n    }\n\n    this.change.emit(this.value);\n    this.valueChanged.emit(this.value);\n  }\n\n  private readonly setSearch = debounce((value: string) => {\n    this.searchChange.emit(value);\n  }, this.searchTimeOut);\n\n  initSelection() {\n    if (this._dataSet) {\n      if (this.value) {\n        this._dataSet.forEach(item => {\n          item.selected = Array.isArray(this.value) ? this.value.includes(item.value) : this.value == item.value;\n        });\n      } else if (this._dataSet.some(item => item.selected)) {\n        const selectedItems = this._dataSet.filter(item => item.selected);\n        this.value = this.selection === 'single' ? selectedItems[0].value : selectedItems.map(item => item.value);\n      } else if (this.selection === 'single') {\n        this._dataSet[0].selected = true;\n\n        this.value = this._dataSet[0].value;\n      }\n    } else if (this.selection === 'multiple') {\n      this.value = Array.from(this.host.querySelectorAll('option:checked')).map(o => (o as HTMLOptionElement).value);\n    } else {\n      this.value = (this.host.querySelector('option:checked') as HTMLOptionElement).value;\n    }\n  }\n\n  initDataSet() {\n    if (!this.dataSet) {\n      this._dataSet = null;\n    } else if (typeof this.dataSet === 'string') {\n      this._dataSet = JSON.parse(this.dataSet);\n    } else if (Array.isArray(this.dataSet) && this.dataSet.length) {\n      this._dataSet = this.dataSet.map(item => ({\n        value: item.id,\n        label: item.title,\n        selected: item.selected,\n      }));\n    }\n  }\n\n  handleFocused = async e => {\n    e.target.parentElement.classList.add('is-focused');\n  };\n\n  handleFocusout = async e => {\n    const target = e.target;\n    if (target.value) {\n      target.parentElement.classList.add('is-filled');\n    }\n    target.parentElement.classList.remove('is-focused');\n  };\n\n  handleKeyUp = async e => {\n    const target = e.target;\n    if (target.value) {\n      target.parentElement.classList.add('is-filled');\n    } else {\n      target.parentElement.classList.remove('is-filled');\n    }\n  };\n\n  componentWillLoad() {\n    this.initDataSet();\n    this.initSelection();\n  }\n\n  labelRender() {\n    if (this.label) {\n      return <label class=\"form-label ms-0\">{this.label}</label>;\n    }\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.labelRender()}\n        <select\n          class=\"form-control\"\n          name={this.name}\n          onFocus={e => this.handleFocused(e)}\n          onFocusout={e => this.handleFocusout(e)}\n          onKeyUp={e => this.handleKeyUp(e)}\n          ref={el => (this._selectRef = el)}\n          multiple={this.selection === 'multiple'}\n        >\n          <slot name=\"option\" />\n        </select>\n      </Host>\n    );\n  }\n\n  componentDidRender() {\n    if (this._selectRef.getAttribute('data-choice') !== 'active') {\n      this._choices = new Choices(this._selectRef, {\n        searchEnabled: this.searchable ?? this.selection === 'multiple',\n        allowHTML: true,\n        removeItemButton: this.removeItemButton,\n        noChoicesText: '沒有可供選擇的選項',\n        noResultsText: '找不到任何結果',\n        duplicateItemsAllowed: this.duplicateItemsAllowed,\n        shouldSort: this.shouldSort,\n        searchPlaceholderValue: '搜尋',\n        searchChoices: this.searchFilter,\n        searchFloor: -1,\n      });\n      if (this._dataSet) {\n        this._choices.setChoices(this._dataSet, 'value', 'label', true);\n      }\n      this._choices.passedElement.element.addEventListener(\n        'change',\n        (e: CustomEvent) => {\n          e.preventDefault();\n          e.stopPropagation();\n          this.value = this._choices.getValue(true) as string[] | string;\n        },\n        false,\n      );\n      if (!this.searchFilter)\n        this._selectRef.addEventListener('search', e => {\n          const event = e as CustomEvent<{ value: string; resultCount: number }>;\n          this.setSearch(event.detail.value);\n        });\n    }\n  }\n}\n\nexport interface IOption {\n  id: string;\n  title: string;\n  selected: boolean;\n}\n"],"names":[],"mappings":";;;;;AAAA,MAAM,cAAc,GAAG,sEAAsE;;MCUhF,WAAW,GAAA,MAAA;;;;;;;AACd,IAAA,QAAQ;AACR,IAAA,QAAQ;AACR,IAAA,UAAU;;AAIV,IAAA,KAAK;AACY,IAAA,KAAK;AACtB,IAAA,IAAI;AACa,IAAA,OAAO;IACxB,UAAU,GAAY,KAAK;IAC3B,SAAS,GAAmC,QAAQ;IACpD,gBAAgB,GAAY,KAAK;IACjC,qBAAqB,GAAY,KAAK;AACtC,IAAA,UAAU;IACV,aAAa,GAAW,GAAG;IAC3B,YAAY,GAAY,IAAI;AAE3B,IAAA,YAAY;AACZ,IAAA,MAAM;AACN,IAAA,YAAY;IAGrB,cAAc,GAAA;QACZ,IAAI,CAAC,WAAW,EAAE;AAClB,QAAA,IAAI,IAAI,CAAC,UAAU,EAAE,YAAY,CAAC,aAAa,CAAC,KAAK,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE;AAC9E,YAAA,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;AACxB,gBAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC;;iBAC1D;AACL,gBAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE;;;;IAMhC,YAAY,GAAA;AACV,QAAA,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAsB;AAElE,YAAA,IAAI,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;gBACxD,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE;oBACpC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,CAAC;;;AAEvC,iBAAA,IAAI,QAAQ,KAAK,IAAI,CAAC,KAAK,EAAE;gBAClC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,CAAC;;;QAI9C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;QAC5B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;;AAGnB,IAAA,SAAS,GAAG,QAAQ,CAAC,CAAC,KAAa,KAAI;AACtD,QAAA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC;AAC/B,KAAC,EAAE,IAAI,CAAC,aAAa,CAAC;IAEtB,aAAa,GAAA;AACX,QAAA,IAAI,IAAI,CAAC,QAAQ,EAAE;AACjB,YAAA,IAAI,IAAI,CAAC,KAAK,EAAE;AACd,gBAAA,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,IAAG;AAC3B,oBAAA,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK;AACxG,iBAAC,CAAC;;AACG,iBAAA,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE;AACpD,gBAAA,MAAM,aAAa,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC;AACjE,gBAAA,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,SAAS,KAAK,QAAQ,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,aAAa,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC;;AACpG,iBAAA,IAAI,IAAI,CAAC,SAAS,KAAK,QAAQ,EAAE;gBACtC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,IAAI;gBAEhC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK;;;AAEhC,aAAA,IAAI,IAAI,CAAC,SAAS,KAAK,UAAU,EAAE;YACxC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAK,CAAuB,CAAC,KAAK,CAAC;;aACzG;AACL,YAAA,IAAI,CAAC,KAAK,GAAI,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAuB,CAAC,KAAK;;;IAIvF,WAAW,GAAA;AACT,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACjB,YAAA,IAAI,CAAC,QAAQ,GAAG,IAAI;;AACf,aAAA,IAAI,OAAO,IAAI,CAAC,OAAO,KAAK,QAAQ,EAAE;YAC3C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC;;AACnC,aAAA,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;AAC7D,YAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,KAAK;gBACxC,KAAK,EAAE,IAAI,CAAC,EAAE;gBACd,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ;AACxB,aAAA,CAAC,CAAC;;;AAIP,IAAA,aAAa,GAAG,OAAM,CAAC,KAAG;QACxB,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC;AACpD,KAAC;AAED,IAAA,cAAc,GAAG,OAAM,CAAC,KAAG;AACzB,QAAA,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM;AACvB,QAAA,IAAI,MAAM,CAAC,KAAK,EAAE;YAChB,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC;;QAEjD,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,CAAC;AACrD,KAAC;AAED,IAAA,WAAW,GAAG,OAAM,CAAC,KAAG;AACtB,QAAA,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM;AACvB,QAAA,IAAI,MAAM,CAAC,KAAK,EAAE;YAChB,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC;;aAC1C;YACL,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC;;AAEtD,KAAC;IAED,iBAAiB,GAAA;QACf,IAAI,CAAC,WAAW,EAAE;QAClB,IAAI,CAAC,aAAa,EAAE;;IAGtB,WAAW,GAAA;AACT,QAAA,IAAI,IAAI,CAAC,KAAK,EAAE;AACd,YAAA,OAAO,CAAA,CAAA,OAAA,EAAA,EAAO,KAAK,EAAC,iBAAiB,IAAE,IAAI,CAAC,KAAK,CAAS;;;IAI9D,MAAM,GAAA;QACJ,QACE,EAAC,IAAI,EAAA,EAAA,GAAA,EAAA,0CAAA,EAAA,EACF,IAAI,CAAC,WAAW,EAAE,EACnB,CAAA,CAAA,QAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EACE,KAAK,EAAC,cAAc,EACpB,IAAI,EAAE,IAAI,CAAC,IAAI,EACf,OAAO,EAAE,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EACnC,UAAU,EAAE,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EACvC,OAAO,EAAE,CAAC,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EACjC,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,EACjC,QAAQ,EAAE,IAAI,CAAC,SAAS,KAAK,UAAU,EAAA,EAEvC,CAAA,CAAA,MAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EAAM,IAAI,EAAC,QAAQ,GAAG,CACf,CACJ;;IAIX,kBAAkB,GAAA;QAChB,IAAI,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,aAAa,CAAC,KAAK,QAAQ,EAAE;YAC5D,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE;gBAC3C,aAAa,EAAE,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,SAAS,KAAK,UAAU;AAC/D,gBAAA,SAAS,EAAE,IAAI;gBACf,gBAAgB,EAAE,IAAI,CAAC,gBAAgB;AACvC,gBAAA,aAAa,EAAE,WAAW;AAC1B,gBAAA,aAAa,EAAE,SAAS;gBACxB,qBAAqB,EAAE,IAAI,CAAC,qBAAqB;gBACjD,UAAU,EAAE,IAAI,CAAC,UAAU;AAC3B,gBAAA,sBAAsB,EAAE,IAAI;gBAC5B,aAAa,EAAE,IAAI,CAAC,YAAY;gBAChC,WAAW,EAAE,EAAE;AAChB,aAAA,CAAC;AACF,YAAA,IAAI,IAAI,CAAC,QAAQ,EAAE;AACjB,gBAAA,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC;;AAEjE,YAAA,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,gBAAgB,CAClD,QAAQ,EACR,CAAC,CAAc,KAAI;gBACjB,CAAC,CAAC,cAAc,EAAE;gBAClB,CAAC,CAAC,eAAe,EAAE;gBACnB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAsB;aAC/D,EACD,KAAK,CACN;YACD,IAAI,CAAC,IAAI,CAAC,YAAY;gBACpB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC,IAAG;oBAC7C,MAAM,KAAK,GAAG,CAAwD;oBACtE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC;AACpC,iBAAC,CAAC;;;;;;;;;;;;"}