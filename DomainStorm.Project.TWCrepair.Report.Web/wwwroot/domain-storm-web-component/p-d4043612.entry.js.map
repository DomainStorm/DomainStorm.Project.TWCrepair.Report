{"version":3,"names":["stormCheckboxCss","StormCheckbox","_uid","_inputEl","type","label","labelClasses","isDisabled","isChecked","isIndeterminate","isSwitch","isInline","timeStamp","valueChanged","check","this","emit","uncheck","renderLabel","h","htmlFor","class","parseClassNames","componentDidRender","indeterminate","render","generateUid","Host","key","ref","el","id","checked","disabled","onChange","async","ev","stopPropagation","target","stormTreeNodeCss","StormTreeNode","_child","href","dataSet","tree","parent","content","searchText","nodeSelect","nodeUnselect","nodeClick","nodeDblClick","nodeCheck","nodeUncheck","handleNodeClick","detail","getId","getSelectable","getSelected","select","nullable","unselect","hasChild","expandToggle","getExpanded","collapse","expand","getFieldValue","fieldId","getHref","fieldHref","getChild","fieldChildren","selectable","fieldSelectable","selection","getCheckSelectable","fieldCheckSelectable","fieldSelected","getChecked","fieldChecked","getDisabled","fieldDisabled","setSelected","value","setFieldValue","rerender","setChecked","fieldExpanded","setExpanded","fieldChildLoaded","loadChild","debounce","forceUpdate","length","renderExpandIcon","collapseIcon","expandIcon","expandIconAlign","undefined","classes","onClick","FnIcon","renderIndent","indent","level","fieldLevel","i","push","renderChild","map","item","renderNodeItem","fieldLabel","appendHighlight","node","innerHTML","componentWillLoad","fieldElement","renderCheckbox","onValueChanged","selectToCheck","color","active","onDblClick","fieldIcon","disconnectedCallback","IndexedDBCache","dbPromise","maxEntries","dbName","dbVersion","constructor","Math","max","openDB","Promise","resolve","reject","request","window","indexedDB","open","onupgradeneeded","event","db","result","objectStoreNames","contains","store","createObjectStore","keyPath","createIndex","unique","onsuccess","onerror","error","withTransaction","mode","operation","tx","transaction","objectStore","get","req","record","timestamp","ttlMillis","set","entry","existsReq","exists","processSet","put","countReq","count","evictOldestEntry","onComplete","onError","index","deleteReq","openCursor","cursor","delReq","delete","clear","defaultKeyPrefix","size","setMaxEntries","getMaxEntries","destroy","close","deleteDatabase","onblocked","console","warn","cacheService","CacheService","regionName","fetchDataSource","options","method","contentType","JSON","stringify","cached","response","fetch","url","body","headers","Headers","ok","Error","statusText","data","json","text","stormTreeViewCss","StormTreeView","_searchText","_dataSet","_items","_dataSource","_searchRef","_nodeSelectableRule","_nodeCheckRule","partialLoad","loading","fieldSubId","fieldSubLabel","fieldSubChildren","fieldParent","dataSource","expandLevel","structure","searchable","nodeSelectableRule","checkSelectable","nodeCheckRule","dateSetLoaded","checkedChanged","searchChanged","keydown","searchChangedHandler","cleanNodes","loadDataSet","nodeSelectHandler","currentValue","Array","isArray","includes","nodeUnselectHandler","filter","nodeCheckHandler","nodeUncheckHandler","valueChangedHandler","valueArray","all","String","shouldSelect","selected","promises","setNodeExpanded","setNodeSelectionState","checkedChangedHandler","checkedArray","shouldChecked","setNodeCheckedState","watchValueHandler","watchCheckedHandler","getTreeNode","watchDataSourceHandler","isModuleFunctionString","createFunctionFromString","startsWith","endsWith","parse","watchNodeSelectableRuleHandler","watchNodeCheckRuleHandler","watchDataSetHandler","getNodeById","find","x","getLabel","unselectAll","getDataSource","setDataSet","getSelectedById","then","y","setSearchFocus","setFocus","renderNode","catch","treeNode","dataSetParse","mergeChild","split","trim","updateItems","source","dest","part","sourcePartValue","destPartValue","clonedValue","structureType","items","calculateObjectValue","children","SharedStyles","applyShadowRootStylesAsync","host","componentWillRender","componentDidLoad","handleSearchChanged","renderSearch","FnSearchInput","elm","nodesRender","nodes"],"sources":["src/components/storm-checkbox-group/storm-checkbox/storm-checkbox.css?tag=storm-checkbox","src/components/storm-checkbox-group/storm-checkbox/storm-checkbox.tsx","src/components/storm-tree-view/storm-tree-node/storm-tree-node.css?tag=storm-tree-node","src/components/storm-tree-view/storm-tree-node/storm-tree-node.tsx","src/utils/cache/indexed-db-cache.ts","src/utils/fetch-data-source/fetch-data-source.ts","src/components/storm-tree-view/storm-tree-view.css?tag=storm-tree-view&encapsulation=shadow","src/components/storm-tree-view/storm-tree-view.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n\r\n:host>.form-check {\r\n  padding-left: 0.25rem;\r\n}\r\n\r\n:host>.form-check.form-switch {\r\n  padding-left: 2.75rem;\r\n}\r\n\r\n:host>.form-check.form-switch .form-check-input {\r\n  margin-top: .3rem;\r\n}\r\n\r\n:host>.form-check.form-check-inline {\r\n  margin-right: .75rem;\r\n}\r\n\r\n:host>.form-check:not(.form-switch) .form-check-input[type=checkbox] {\r\n  margin-top: 0;\r\n}\r\n\r\n:host .input-group.input-group-static label {\r\n  margin-left: .25rem;\r\n  margin-top: .15rem;\r\n}\r\n\r\n:host label {\r\n  cursor: pointer;\r\n}","import { Component, Event, EventEmitter, h, Host, Method, Prop } from '@stencil/core';\nimport { generateUid, parseClassNames } from '@utils/utils';\n\n@Component({\n  tag: 'storm-checkbox',\n  styleUrl: 'storm-checkbox.css',\n  shadow: false,\n})\nexport class StormCheckbox {\n  private _uid?: string;\n  private _inputEl: HTMLInputElement;\n\n  @Prop() type: 'checkbox' | 'radio' = 'checkbox';\n  @Prop() label: string;\n  @Prop() labelClasses?: Record<string, boolean> | string = 'custom-control-label';\n  @Prop({ mutable: true, reflect: true }) isDisabled?: boolean;\n  @Prop({ mutable: true, reflect: true }) isChecked?: boolean;\n  @Prop({ mutable: true, reflect: true }) isIndeterminate?: boolean;\n  @Prop({ reflect: true }) isSwitch: boolean = false;\n  @Prop({ reflect: true }) isInline: boolean = false;\n  @Prop({ mutable: true, reflect: true }) timeStamp?: number;\n\n  @Event() valueChanged: EventEmitter<boolean>;\n\n  @Method()\n  async check() {\n    if (this.isChecked) return;\n    this.isChecked = true;\n    this.valueChanged.emit(this.isChecked);\n  }\n\n  @Method()\n  async uncheck() {\n    if (!this.isChecked) return;\n    this.isChecked = false;\n    this.valueChanged.emit(this.isChecked);\n  }\n\n  renderLabel() {\n    if (!this.label) return;\n    return (\n      <label htmlFor={this._uid} class={parseClassNames(this.labelClasses)}>\n        {this.label}\n      </label>\n    );\n  }\n\n  componentDidRender() {\n    if (this._inputEl) {\n      this._inputEl.indeterminate = !!this.isIndeterminate;\n    }\n  }\n\n  render() {\n    if (!this._uid) this._uid = generateUid('storm-checkbox');\n\n    return (\n      <Host>\n        <div class={{ 'form-check': true, 'form-check-inline': this.isInline, 'form-switch': this.isSwitch }}>\n          <input\n            ref={el => (this._inputEl = el)}\n            class={{ 'form-check-input': true }}\n            id={this._uid}\n            type={this.type}\n            checked={this.isChecked}\n            disabled={this.isDisabled}\n            indeterminate={this.isIndeterminate}\n            onChange={async ev => {\n              ev.stopPropagation();\n              if (ev.target['checked']) await this.check();\n              else await this.uncheck();\n            }}\n          />\n          {this.renderLabel()}\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\r\n    display: block;\r\n    -webkit-user-select: none;\r\n    user-select: none;\r\n}\r\n\r\n.list-group-item.active .form-check:not(.form-switch) .form-check-input[type=\"checkbox\"]:checked {\r\n    background: #fff !important;\r\n    border-color: #fff !important;\r\n}\r\n\r\n.list-group-item.active .form-check:not(.form-switch) .form-check-input[type=\"checkbox\"]::after {\r\n    color: #e91e63 !important;\r\n}\r\n\r\n.list-group-item .form-check {\r\n    margin-bottom: 0 !important;\r\n}","import { Component, Element, Event, EventEmitter, Host, Listen, Method, Prop, forceUpdate, h } from '@stencil/core';\r\nimport { FnIcon } from '@utils/functional/functional';\r\nimport { appendHighlight, debounce, getFieldValue, setFieldValue } from '@utils/utils';\r\nimport { StormTreeView } from '../storm-tree-view';\r\n\r\n@Component({\r\n  tag: 'storm-tree-node',\r\n  styleUrl: 'storm-tree-node.css',\r\n  shadow: false,\r\n})\r\nexport class StormTreeNode {\r\n  private _child: HTMLStormTreeNodeElement[];\r\n\r\n  @Element() host: HTMLElement;\r\n  @Prop({ mutable: true }) href: string = 'javascript:void(0);';\r\n  @Prop() dataSet: object;\r\n  @Prop() tree: StormTreeView;\r\n  @Prop() parent?: StormTreeNode;\r\n  @Prop() content: string;\r\n  @Prop() searchText?: string;\r\n\r\n  @Event() nodeSelect: EventEmitter<string>;\r\n  @Event() nodeUnselect: EventEmitter<string>;\r\n  @Event() nodeClick: EventEmitter<string>;\r\n  @Event() nodeDblClick: EventEmitter<string>;\r\n  @Event() nodeCheck: EventEmitter<string>;\r\n  @Event() nodeUncheck: EventEmitter<string>;\r\n\r\n  @Listen('nodeClick')\r\n  async handleNodeClick(ev: CustomEvent<string>) {\r\n    if (ev.detail !== this.getId()) return;\r\n\r\n    if (this.getSelectable()) {\r\n      if (!this.getSelected()) {\r\n        await this.select();\r\n      } else if (this.tree.nullable) {\r\n        await this.unselect();\r\n      }\r\n    } else {\r\n      ev.stopPropagation();\r\n      if (this.hasChild()) {\r\n        this.expandToggle();\r\n      }\r\n    }\r\n  }\r\n\r\n  expandToggle() {\r\n    this.getExpanded() ? this.collapse() : this.expand();\r\n  }\r\n\r\n  getId(): string {\r\n    return getFieldValue(this.dataSet, this.tree.fieldId) as string;\r\n  }\r\n\r\n  getHref(): string {\r\n    const href = getFieldValue(this.dataSet, this.tree.fieldHref) as string;\r\n    return href ?? this.href;\r\n  }\r\n\r\n  getChild(): object[] {\r\n    return (getFieldValue(this.dataSet, this.tree.fieldChildren) as object[]) || [];\r\n  }\r\n\r\n  getSelectable(): boolean {\r\n    const selectable = getFieldValue(this.dataSet, this.tree.fieldSelectable) as boolean;\r\n    return selectable ?? this.tree.selection != 'none';\r\n  }\r\n\r\n  getCheckSelectable(): boolean {\r\n    return getFieldValue(this.dataSet, this.tree.fieldCheckSelectable) === true;\r\n  }\r\n\r\n  getSelected(): boolean {\r\n    return getFieldValue(this.dataSet, this.tree.fieldSelected) === true;\r\n  }\r\n\r\n  getChecked(): boolean {\r\n    return getFieldValue(this.dataSet, this.tree.fieldChecked) === true;\r\n  }\r\n\r\n  getDisabled(): boolean {\r\n    return getFieldValue(this.dataSet, this.tree.fieldDisabled) === true;\r\n  }\r\n\r\n  setSelected(value: boolean) {\r\n    if ((getFieldValue(this.dataSet, this.tree.fieldSelected) as boolean) === value) return;\r\n    setFieldValue(this.dataSet, this.tree.fieldSelected, value);\r\n    this.rerender();\r\n  }\r\n\r\n  setChecked(value: boolean) {\r\n    if ((getFieldValue(this.dataSet, this.tree.fieldChecked) as boolean) === value) return;\r\n    setFieldValue(this.dataSet, this.tree.fieldChecked, value);\r\n    this.rerender();\r\n  }\r\n\r\n  getExpanded(): boolean {\r\n    return getFieldValue(this.dataSet, this.tree.fieldExpanded) === true;\r\n  }\r\n\r\n  async setExpanded(value: boolean): Promise<void> {\r\n    if (this.getExpanded() === value) return;\r\n    setFieldValue(this.dataSet, this.tree.fieldExpanded, value);\r\n\r\n    if (value && !(getFieldValue(this.dataSet, this.tree.fieldChildLoaded) as boolean)) {\r\n      await this.tree.loadChild(this);\r\n    }\r\n\r\n    this.rerender();\r\n  }\r\n\r\n  private readonly rerender = debounce(() => {\r\n    forceUpdate(this);\r\n  }, 50);\r\n\r\n  @Method()\r\n  async select() {\r\n    if (this.getSelected()) {\r\n      return;\r\n    }\r\n    this.setSelected(true);\r\n    this.nodeSelect.emit(this.getId());\r\n  }\r\n\r\n  @Method()\r\n  async unselect() {\r\n    if (!this.getSelected()) {\r\n      return;\r\n    }\r\n    this.setSelected(false);\r\n    this.nodeUnselect.emit(this.getId());\r\n  }\r\n\r\n  @Method()\r\n  async check() {\r\n    if (this.getChecked()) {\r\n      return;\r\n    }\r\n    this.setChecked(true);\r\n    this.nodeCheck.emit(this.getId());\r\n  }\r\n\r\n  @Method()\r\n  async uncheck() {\r\n    if (!this.getChecked()) {\r\n      return;\r\n    }\r\n    this.setChecked(false);\r\n    this.nodeUncheck.emit(this.getId());\r\n  }\r\n\r\n  @Method()\r\n  async expand() {\r\n    await this.setExpanded(true);\r\n  }\r\n\r\n  @Method()\r\n  async collapse() {\r\n    await this.setExpanded(false);\r\n  }\r\n\r\n  hasChild(): boolean {\r\n    return !!this.getChild()?.length;\r\n  }\r\n\r\n  renderExpandIcon() {\r\n    if (this.searchText) return;\r\n\r\n    if (!this.hasChild() || (this.getExpanded() && this.tree.collapseIcon === '') || (!this.getExpanded() && this.tree.expandIcon === '')) {\r\n      return this.tree.expandIconAlign === 'left' ? <span class=\"indent\" /> : undefined;\r\n    }\r\n    const classes: any = {\r\n      'mb-1': true,\r\n      'mx-1': true,\r\n      'position-absolute': this.tree.expandIconAlign === 'right',\r\n      'end-0': this.tree.expandIconAlign === 'right',\r\n    };\r\n    return (\r\n      <span\r\n        class={classes}\r\n        onClick={ev => {\r\n          ev.stopPropagation();\r\n          this.expandToggle();\r\n        }}\r\n      >\r\n        <FnIcon>{this.getExpanded() ? this.tree.collapseIcon : this.tree.expandIcon}</FnIcon>\r\n      </span>\r\n    );\r\n  }\r\n\r\n  renderIndent() {\r\n    if (this.searchText) return;\r\n\r\n    const indent = [];\r\n    const level = getFieldValue(this.dataSet, this.tree.fieldLevel) as number;\r\n    for (let i = 1; i < level; i++) {\r\n      indent.push(<span class=\"indent\" />);\r\n    }\r\n    if (!this.hasChild() && this.tree.expandIconAlign === 'left') {\r\n      indent.push(<span class=\"leaf\" />);\r\n    }\r\n    return indent;\r\n  }\r\n\r\n  renderChild(): HTMLStormTreeNodeElement {\r\n    if (this.searchText) return;\r\n    if (!this.hasChild() || !this.getExpanded()) return;\r\n\r\n    this._child = this.getChild().map(item => {\r\n      return this.renderNodeItem(item);\r\n    });\r\n    return <div class=\"list-group\">{this._child}</div>;\r\n  }\r\n\r\n  renderNodeItem(item: object): HTMLStormTreeNodeElement {\r\n    let content = getFieldValue(item, this.tree.fieldLabel) as string;\r\n    if (content && this.searchText) {\r\n      content = appendHighlight(content, this.searchText);\r\n    }\r\n\r\n    const node = <storm-tree-node tree={this.tree} dataSet={item} content={content} searchText={this.searchText}></storm-tree-node>;\r\n    return node;\r\n  }\r\n\r\n  renderLabel() {\r\n    return <span innerHTML={this.content}></span>;\r\n  }\r\n\r\n  componentWillLoad() {\r\n    setFieldValue(this.dataSet, this.tree.fieldElement, this);\r\n  }\r\n\r\n  renderCheckbox() {\r\n    if (!this.getCheckSelectable()) return;\r\n    return (\r\n      <storm-checkbox\r\n        type=\"checkbox\"\r\n        isInline={true}\r\n        isChecked={this.getChecked()}\r\n        onValueChanged={ev => {\r\n          ev.stopPropagation();\r\n        }}\r\n        onClick={async ev => {\r\n          ev.stopPropagation();\r\n          if (this.tree.selectToCheck) {\r\n            this.nodeClick.emit(this.getId());\r\n          } else if (!this.getChecked()) {\r\n            await this.check();\r\n          } else {\r\n            await this.uncheck();\r\n          }\r\n        }}\r\n      ></storm-checkbox>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!this.dataSet) return;\r\n    return (\r\n      <Host>\r\n        <a\r\n          href={this.getHref()}\r\n          class={{\r\n            'py-1': true,\r\n            'px-1': true,\r\n            'list-group-item': true,\r\n            'list-group-item-action': getFieldValue(this.dataSet, this.tree.fieldSelectable) as boolean,\r\n            'list-group-item-primary': this.tree.color == 'primary',\r\n            'list-group-item-secondary': this.tree.color == 'secondary',\r\n            'list-group-item-success': this.tree.color == 'success',\r\n            'list-group-item-danger': this.tree.color == 'danger',\r\n            'list-group-item-warning': this.tree.color == 'warning',\r\n            'list-group-item-info': this.tree.color == 'info',\r\n            'list-group-item-light': this.tree.color == 'light',\r\n            'list-group-item-dark': this.tree.color == 'dark',\r\n            'd-flex': true,\r\n            'align-items-end': true,\r\n            active: this.getSelected(),\r\n            disabled: this.getDisabled(),\r\n          }}\r\n          onClick={ev => {\r\n            ev.stopPropagation();\r\n            this.nodeClick.emit(this.getId());\r\n          }}\r\n          onDblClick={ev => {\r\n            ev.stopPropagation();\r\n            this.nodeDblClick.emit(this.getId());\r\n          }}\r\n        >\r\n          {this.renderIndent()}\r\n          {this.renderExpandIcon()}\r\n          <FnIcon>{getFieldValue(this.dataSet, this.tree.fieldIcon) as string}</FnIcon>\r\n          {this.renderCheckbox()}\r\n          {this.renderLabel()}\r\n        </a>\r\n        {this.renderChild()}\r\n      </Host>\r\n    );\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    setFieldValue(this.dataSet, this.tree.fieldElement, undefined);\r\n  }\r\n}\r\n","import type { CacheEntry, CacheProvider } from './interface';\r\n\r\nexport class IndexedDBCache implements CacheProvider {\r\n    private dbPromise: Promise<IDBDatabase> | null = null;\r\n    private maxEntries: number;\r\n    private readonly dbName: string;\r\n    private readonly dbVersion: number;\r\n\r\n    constructor(maxEntries = 1000, dbName = 'StencilCacheDB', dbVersion = 1) {\r\n        this.maxEntries = Math.max(1, maxEntries); // Ensure at least 1 entry\r\n        this.dbName = dbName;\r\n        this.dbVersion = dbVersion;\r\n    }\r\n\r\n\r\n    private openDB(): Promise<IDBDatabase> {\r\n        if (!this.dbPromise) {\r\n            this.dbPromise = new Promise((resolve, reject) => {\r\n                const request = window.indexedDB.open(this.dbName, this.dbVersion);\r\n\r\n                request.onupgradeneeded = (event) => {\r\n                    const db = (event.target as IDBOpenDBRequest).result;\r\n                    if (!db.objectStoreNames.contains('cache')) {\r\n                        const store = db.createObjectStore('cache', { keyPath: 'key' });\r\n                        store.createIndex('timestamp', 'timestamp', { unique: false });\r\n                    }\r\n                };\r\n\r\n                request.onsuccess = (event) => {\r\n                    resolve((event.target as IDBOpenDBRequest).result);\r\n                };\r\n\r\n                request.onerror = () => {\r\n                    this.dbPromise = null;\r\n                    reject(request.error);\r\n                };\r\n            });\r\n        }\r\n\r\n        return this.dbPromise;\r\n    }\r\n\r\n    private async withTransaction<T>(\r\n        mode: IDBTransactionMode,\r\n        operation: (store: IDBObjectStore) => Promise<T>\r\n    ): Promise<T> {\r\n        const db = await this.openDB();\r\n        const tx = db.transaction('cache', mode);\r\n        return await operation(tx.objectStore('cache'));\r\n    }\r\n\r\n    async get(key: string): Promise<CacheEntry | null> {\r\n        return await this.withTransaction('readonly', (store) => {\r\n            return new Promise<CacheEntry | null>((resolve, reject) => {\r\n                const req = store.get(key);\r\n                req.onsuccess = () => {\r\n                    const record = req.result;\r\n                    resolve(record ? {\r\n                        value: record.value,\r\n                        timestamp: record.timestamp,\r\n                        ttlMillis: record.ttlMillis\r\n                    } : null);\r\n                };\r\n                req.onerror = () => reject(req.error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async set(key: string, entry: CacheEntry): Promise<void> {\r\n        await this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                // Check if key exists first\r\n                const existsReq = store.get(key);\r\n                existsReq.onsuccess = () => {\r\n                    const exists = existsReq.result;\r\n                    \r\n                    const processSet = () => {\r\n                        const req = store.put({ key, ...entry });\r\n                        req.onsuccess = () => resolve();\r\n                        req.onerror = () => reject(req.error);\r\n                    };\r\n                    \r\n                    if (exists) {\r\n                        // Key exists, just update\r\n                        processSet();\r\n                    } else {\r\n                        // New key, check size limit\r\n                        const countReq = store.count();\r\n                        countReq.onsuccess = () => {\r\n                            if (countReq.result >= this.maxEntries) {\r\n                                this.evictOldestEntry(store, processSet, reject);\r\n                            } else {\r\n                                processSet();\r\n                            }\r\n                        };\r\n                        countReq.onerror = () => reject(countReq.error);\r\n                    }\r\n                };\r\n                existsReq.onerror = () => reject(existsReq.error);\r\n            });\r\n        });\r\n    }\r\n\r\n    private evictOldestEntry(\r\n        store: IDBObjectStore, \r\n        onComplete: () => void, \r\n        onError: (error: any) => void\r\n    ): void {\r\n        const index = store.index('timestamp');\r\n        const deleteReq = index.openCursor();\r\n        \r\n        deleteReq.onsuccess = (event) => {\r\n            const cursor = (event.target as IDBRequest).result;\r\n            if (cursor) {\r\n                const delReq = cursor.delete();\r\n                delReq.onsuccess = onComplete;\r\n                delReq.onerror = () => onError(delReq.error);\r\n            } else {\r\n                onComplete();\r\n            }\r\n        };\r\n        deleteReq.onerror = () => onError(deleteReq.error);\r\n    }\r\n\r\n    async delete(key: string): Promise<void> {\r\n        await this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                const req = store.delete(key);\r\n                req.onsuccess = () => resolve();\r\n                req.onerror = () => reject(req.error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.withTransaction('readwrite', (store) => {\r\n            return new Promise<void>((resolve, reject) => {\r\n                const req = store.clear();\r\n                req.onsuccess = () => resolve();\r\n                req.onerror = () => reject(req.error);\r\n            });\r\n        });\r\n    }\r\n\r\n    get defaultKeyPrefix(): string {\r\n        return 'idb';\r\n    }\r\n\r\n    async size(): Promise<number> {\r\n        return await this.withTransaction('readonly', (store) => {\r\n            return new Promise<number>((resolve, reject) => {\r\n                const req = store.count();\r\n                req.onsuccess = () => resolve(req.result);\r\n                req.onerror = () => reject(req.error);\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n    setMaxEntries(maxEntries: number): void {\r\n        this.maxEntries = maxEntries;\r\n    }\r\n\r\n    getMaxEntries(): number {\r\n        return this.maxEntries;\r\n    }\r\n\r\n    async destroy(): Promise<void> {\r\n        if (this.dbPromise) {\r\n            const db = await this.dbPromise;\r\n            db.close();\r\n            this.dbPromise = null;\r\n        }\r\n\r\n        return new Promise<void>((resolve, reject) => {\r\n            const deleteReq = window.indexedDB.deleteDatabase(this.dbName);\r\n            deleteReq.onsuccess = () => resolve();\r\n            deleteReq.onerror = () => reject(deleteReq.error);\r\n            deleteReq.onblocked = () => {\r\n                console.warn('Database deletion blocked. Other connections may be open.');\r\n                resolve();\r\n            };\r\n        });\r\n    }\r\n}","\r\nimport { CacheService } from '../cache/cache-service';\r\nimport { IndexedDBCache } from '../cache/indexed-db-cache';\r\nimport type { FetchOption } from './interface';\r\n\r\nconst cacheService = new CacheService(new IndexedDBCache(), {\r\n    regionName: 'fetchDataSource',\r\n});\r\n\r\nexport async function fetchDataSource(options: FetchOption): Promise<any> {\r\n    // 1. 合併預設值\r\n    options = {\r\n        method: 'POST',\r\n        contentType: 'application/json',\r\n        ...options,\r\n    };\r\n\r\n    // 2. 以 JSON.stringify(options) 當作單筆快取的 key\r\n    const key = JSON.stringify(options);\r\n\r\n    // 3. 嘗試從快取讀取 (使用預設 region)\r\n    const cached = await cacheService.get<any>(key);\r\n    if (cached !== null) {\r\n        return cached;\r\n    }\r\n\r\n    // 4. 快取不存在或已過期，真正執行 fetch\r\n    const response = await fetch(options.url, {\r\n        method: options.method,\r\n        body: options.method !== 'GET' ? JSON.stringify(options.body ?? {}) : null,\r\n        headers: new Headers({\r\n            'Content-Type': options.contentType,\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error(`Network response was not ok: ${response.statusText}`);\r\n    }\r\n\r\n    const data =\r\n        options.contentType === 'application/json'\r\n            ? await response.json()\r\n            : await response.text();\r\n\r\n    // 5. 把新資料寫回快取 (使用預設 region)\r\n    await cacheService.set(key, data);\r\n\r\n    return data;\r\n}\r\n",":host {\r\n    display: block;\r\n    background-color: #fff;\r\n}\r\n\r\n:host .list-group-item {\r\n    border: none !important;\r\n    white-space: nowrap !important;\r\n    cursor: pointer !important;\r\n    margin-bottom: 0 !important;\r\n}\r\n\r\n:host .close.material-icons,\r\n:host .open.material-icons:hover {\r\n    opacity: 0.5;\r\n}\r\n\r\n:host .open.material-icons,\r\n:host .close.material-icons:hover {\r\n    opacity: 1;\r\n}\r\n\r\n:host .material-icons:empty {\r\n    width: 1.25rem;\r\n}\r\n\r\n:host .indent {\r\n    margin-left: 0.575rem;\r\n    margin-right: 0.575rem;\r\n}\r\n\r\n:host .leaf {\r\n    margin-left: 0.6rem;\r\n}","import { Component, Element, Event, EventEmitter, forceUpdate, h, Host, Listen, Method, Prop, Watch } from '@stencil/core';\r\nimport { fetchDataSource } from '@utils/fetch-data-source/fetch-data-source';\r\nimport type { FetchOption } from '@utils/fetch-data-source/interface';\r\nimport { FnSearchInput } from '@utils/functional/functional';\r\nimport { SharedStyles } from '@utils/shared-styles';\r\nimport { appendHighlight, calculateObjectValue, createFunctionFromString, debounce, getFieldValue, isModuleFunctionString, setFieldValue } from '@utils/utils';\r\nimport type { StormTreeNode } from './storm-tree-node/storm-tree-node';\r\n\r\n@Component({\r\n  tag: 'storm-tree-view',\r\n  styleUrl: 'storm-tree-view.css',\r\n  shadow: true,\r\n})\r\nexport class StormTreeView {\r\n  private _searchText?: string;\r\n  private _dataSet?: object[];\r\n  private _items?: object[];\r\n  private _dataSource?: FetchOption | Function;\r\n  private _searchRef: HTMLStormInputGroupElement;\r\n  private _nodeSelectableRule?: Function;\r\n  private _nodeCheckRule?: Function;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() partialLoad: boolean = false;\r\n  @Prop() loading: 'eager' | 'lazy' = 'eager';\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop({ mutable: true }) checked: string[] = [];\r\n\r\n  @Prop() fieldId: string = 'id';\r\n  @Prop() fieldLabel: string = 'label';\r\n  @Prop() fieldChildren: string = 'children';\r\n\r\n  @Prop() fieldSubId: string = 'subId';\r\n  @Prop() fieldSubLabel: string = 'subLabel';\r\n  @Prop() fieldSubChildren: string = 'subChildren';\r\n\r\n  @Prop() fieldSelected: string = '_selected';\r\n  @Prop() fieldChecked: string = '_checked';\r\n  @Prop() fieldExpanded: string = '_expanded';\r\n  @Prop() fieldDisabled: string = '_disabled';\r\n  @Prop() fieldParent: string = '_parent';\r\n  @Prop() fieldSelectable: string = '_selectable';\r\n  @Prop() fieldCheckSelectable: string = '_checkSelectable';\r\n  @Prop() fieldIcon: string = '_icon';\r\n  @Prop() fieldHref: string = '_href';\r\n  @Prop() fieldLevel: string = '_level';\r\n  @Prop() fieldChildLoaded: string = '_loaded';\r\n  @Prop() fieldElement: string = '_element';\r\n\r\n  @Prop({ mutable: true }) expandIconAlign: 'left' | 'right' = 'left';\r\n  @Prop({ mutable: true }) expandIcon?: string;\r\n  @Prop({ mutable: true }) collapseIcon?: string;\r\n  @Prop() color?: string;\r\n\r\n  @Prop({ mutable: true }) dataSet?: object | object[];\r\n  @Prop({ mutable: true }) dataSource?: FetchOption | Function | string;\r\n  @Prop({ mutable: true }) fetch?: Function;\r\n  @Prop() nullable: boolean = true;\r\n  @Prop({ mutable: true }) expandLevel: number = 2;\r\n  @Prop() structure: 'tree' | 'array' | 'auto' = 'auto';\r\n  @Prop() searchable: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n  @Prop({ mutable: true }) nodeSelectableRule?: string | Function;\r\n  @Prop() checkSelectable: boolean = false;\r\n  @Prop({ mutable: true }) nodeCheckRule?: string | Function;\r\n  @Prop({ mutable: true }) selectToCheck: boolean = true;\r\n\r\n  @Event() dateSetLoaded: EventEmitter;\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() nodeSelect: EventEmitter<string>;\r\n  @Event() nodeUnselect: EventEmitter<string>;\r\n  @Event() nodeClick: EventEmitter<string>;\r\n  @Event() nodeDblClick: EventEmitter<string>;\r\n  @Event() nodeCheck: EventEmitter<string>;\r\n  @Event() nodeUncheck: EventEmitter<string>;\r\n  @Event() checkedChanged: EventEmitter<string[]>;\r\n\r\n  @Event() searchChanged: EventEmitter<string>;\r\n  @Event() keydown: EventEmitter<KeyboardEvent>;\r\n\r\n  @Listen('searchChanged')\r\n  async searchChangedHandler(ev: CustomEvent<string>) {\r\n    this._searchText = ev.detail;\r\n    if (this.partialLoad) {\r\n      this.cleanNodes();\r\n      await this.loadDataSet();\r\n    } else {\r\n      this.rerender();\r\n    }\r\n  }\r\n\r\n  @Listen('nodeSelect')\r\n  nodeSelectHandler(ev: CustomEvent<string>) {\r\n    switch (this.selection) {\r\n      case 'single':\r\n        this.value = ev.detail;\r\n        break;\r\n      case 'multiple': {\r\n        const currentValue = Array.isArray(this.value) ? this.value : this.value ? [this.value] : [];\r\n        if (!currentValue.includes(ev.detail)) this.value = [...currentValue, ev.detail];\r\n        break;\r\n      }\r\n      default:\r\n        console.warn(`Unknown selection mode: ${this.selection}`);\r\n    }\r\n  }\r\n\r\n  @Listen('nodeUnselect')\r\n  nodeUnselectHandler(ev: CustomEvent<string>) {\r\n    switch (this.selection) {\r\n      case 'single':\r\n        if (this.value === ev.detail) {\r\n          this.value = null;\r\n        }\r\n        break;\r\n      case 'multiple': {\r\n        const currentValue = Array.isArray(this.value) ? this.value : [];\r\n        if (currentValue.includes(ev.detail)) this.value = currentValue.filter(id => id !== ev.detail);\r\n        break;\r\n      }\r\n      default:\r\n        console.warn(`Unknown selection mode: ${this.selection}`);\r\n    }\r\n  }\r\n\r\n  @Listen('nodeCheck')\r\n  nodeCheckHandler(ev: CustomEvent<string>) {\r\n    if (this.selectToCheck) return;\r\n    if (!this.checked.includes(ev.detail)) this.checked = [...this.checked, ev.detail];\r\n  }\r\n\r\n  @Listen('nodeUncheck')\r\n  nodeUncheckHandler(ev: CustomEvent<string>) {\r\n    if (this.selectToCheck) return;\r\n    if (this.checked.includes(ev.detail)) this.checked = this.checked.filter(id => id !== ev.detail);\r\n  }\r\n\r\n  @Listen('valueChanged')\r\n  async valueChangedHandler(): Promise<void> {\r\n    if (!Array.isArray(this._items)) return;\r\n\r\n    const valueArray = Array.isArray(this.value) ? this.value : this.value ? [this.value] : [];\r\n\r\n    await Promise.all(\r\n      this._items.map(async item => {\r\n        const id = String(getFieldValue(item, this.fieldId) as string);\r\n        const shouldSelect = valueArray.includes(id);\r\n        const selected = (getFieldValue(item, this.fieldSelected) as boolean) === true;\r\n\r\n        const promises: Promise<void>[] = [];\r\n        if (shouldSelect) {\r\n          promises.push(this.setNodeExpanded(item));\r\n        }\r\n\r\n        if (selected !== shouldSelect) {\r\n          promises.push(this.setNodeSelectionState(item, shouldSelect));\r\n        }\r\n\r\n        return Promise.all(promises);\r\n      }),\r\n    );\r\n\r\n    if (this.checkSelectable && this.selectToCheck) {\r\n      this.checked = valueArray;\r\n    }\r\n  }\r\n\r\n  @Listen('checkedChanged')\r\n  async checkedChangedHandler(): Promise<void> {\r\n    if (!Array.isArray(this._items)) return;\r\n\r\n    await Promise.all(\r\n      this._items.map(item => {\r\n        const id = String(getFieldValue(item, this.fieldId) as string);\r\n        const checkedArray = Array.isArray(this.checked) ? this.checked : this.checked ? [this.checked] : [];\r\n        const shouldChecked = checkedArray.includes(id);\r\n        const checked = (getFieldValue(item, this.fieldChecked) as boolean) === true;\r\n\r\n        if (checked !== shouldChecked) {\r\n          return this.setNodeCheckedState(item, shouldChecked);\r\n        }\r\n        return Promise.resolve();\r\n      }),\r\n    );\r\n  }\r\n\r\n  @Watch('value')\r\n  async watchValueHandler() {\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  @Watch('checked')\r\n  async watchCheckedHandler() {\r\n    this.checkedChanged.emit(this.checked);\r\n  }\r\n\r\n  async setNodeSelectionState(item: object, shouldSelect: boolean): Promise<void> {\r\n    const node = await this.getTreeNode(item);\r\n\r\n    if (node) {\r\n      await (shouldSelect ? node.select() : node.unselect());\r\n    } else {\r\n      setFieldValue(item, this.fieldSelected, shouldSelect);\r\n    }\r\n    if (this.checkSelectable && this.selectToCheck) {\r\n      await this.setNodeCheckedState(item, shouldSelect);\r\n    }\r\n  }\r\n\r\n  async setNodeCheckedState(item: object, shouldChecked: boolean): Promise<void> {\r\n    const node = await this.getTreeNode(item);\r\n\r\n    if (node) {\r\n      await (shouldChecked ? node.check() : node.uncheck());\r\n    } else {\r\n      setFieldValue(item, this.fieldChecked, shouldChecked);\r\n    }\r\n  }\r\n\r\n  @Watch('dataSource')\r\n  watchDataSourceHandler() {\r\n    this.cleanNodes();\r\n    if (typeof this.dataSource === 'string') {\r\n      if (isModuleFunctionString(this.dataSource)) {\r\n        this._dataSource = createFunctionFromString(this.dataSource);\r\n      } else if (this.dataSource.startsWith('{') && this.dataSource.endsWith('}')) {\r\n        this._dataSource = JSON.parse(this.dataSource) as FetchOption;\r\n      } else {\r\n        this._dataSource = { url: this.dataSource } as FetchOption;\r\n      }\r\n    } else {\r\n      this._dataSource = this.dataSource;\r\n    }\r\n  }\r\n\r\n  @Watch('nodeSelectableRule')\r\n  watchNodeSelectableRuleHandler() {\r\n    if (typeof this.nodeSelectableRule === 'string') {\r\n      if (isModuleFunctionString(this.nodeSelectableRule)) {\r\n        this._nodeSelectableRule = createFunctionFromString(this.nodeSelectableRule);\r\n      }\r\n    } else {\r\n      this._nodeSelectableRule = this.nodeSelectableRule;\r\n    }\r\n  }\r\n\r\n  @Watch('nodeCheckRule')\r\n  watchNodeCheckRuleHandler() {\r\n    if (typeof this.nodeCheckRule === 'string') {\r\n      if (isModuleFunctionString(this.nodeCheckRule)) {\r\n        this._nodeCheckRule = createFunctionFromString(this.nodeCheckRule);\r\n      }\r\n    } else {\r\n      this._nodeCheckRule = this.nodeCheckRule;\r\n    }\r\n  }\r\n\r\n  @Watch('dataSet')\r\n  async watchDataSetHandler() {\r\n    this.cleanNodes();\r\n    await this.watchValueHandler();\r\n    await this.watchCheckedHandler();\r\n  }\r\n\r\n  @Method()\r\n  async getNodeById(id: string): Promise<object | null> {\r\n    if (!this._items) return null;\r\n    return this._items.find(x => (getFieldValue(x, this.fieldId) as string) === id);\r\n  }\r\n\r\n  @Method()\r\n  async getTreeNode(item: object): Promise<HTMLStormTreeNodeElement> {\r\n    return getFieldValue(item, this.fieldElement) as HTMLStormTreeNodeElement;\r\n  }\r\n\r\n  @Method()\r\n  async getLabel(item: object): Promise<string> {\r\n    return getFieldValue(item, this.fieldLabel) as string;\r\n  }\r\n\r\n  @Method()\r\n  async unselectAll() {\r\n    this.value = null;\r\n  }\r\n\r\n  @Method()\r\n  async loadDataSet() {\r\n    if (this._dataSet) return;\r\n    if (this.dataSource || this.fetch) {\r\n      try {\r\n        const dataSet = await this.getDataSource();\r\n        this.setDataSet(dataSet);\r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n      }\r\n    } else {\r\n      this.setDataSet(this.dataSet);\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async getSelected(): Promise<object[]> {\r\n    return this._items.filter(node => getFieldValue(node, this.fieldSelected) as boolean);\r\n  }\r\n\r\n  @Method()\r\n  async getSelectedById(): Promise<string[]> {\r\n    return await this.getSelected().then(x => x.map(y => getFieldValue(y, this.fieldId) as string));\r\n  }\r\n\r\n  @Method()\r\n  async setSearchFocus() {\r\n    if (this.searchable && this._searchRef) {\r\n      await this._searchRef.setFocus();\r\n    }\r\n  }\r\n\r\n  private readonly rerender = debounce(async (): Promise<void> => {\r\n    if (!Array.isArray(this._items) || this._items.length === 0) return;\r\n    await Promise.all(\r\n      this._items.map(async item => {\r\n        const node = await this.getTreeNode(item);\r\n        if (node) {\r\n          forceUpdate(node);\r\n        }\r\n      }),\r\n    );\r\n    forceUpdate(this);\r\n  }, 50);\r\n\r\n  renderNode(item: object): StormTreeNode {\r\n    let content = getFieldValue(item, this.fieldLabel) as string;\r\n    if (content && this._searchText) {\r\n      content = appendHighlight(content, this._searchText);\r\n    }\r\n\r\n    return <storm-tree-node tree={this} dataSet={item} content={content} searchText={this._searchText}></storm-tree-node>;\r\n  }\r\n\r\n  async setNodeExpanded(item: object) {\r\n    let parent = getFieldValue(item, this.fieldParent) as object;\r\n    while (parent) {\r\n      const node = await this.getTreeNode(parent);\r\n      if (node) {\r\n        await node.expand().catch(error => {\r\n          console.error('Failed to expand tree node:', error);\r\n        });\r\n      } else {\r\n        setFieldValue(parent, this.fieldExpanded, true);\r\n      }\r\n\r\n      parent = getFieldValue(parent, this.fieldParent) as object;\r\n    }\r\n  }\r\n\r\n  cleanNodes() {\r\n    this._dataSet = undefined;\r\n    this._items = undefined;\r\n  }\r\n\r\n  async getDataSource(treeNode: StormTreeNode | null = null): Promise<any> {\r\n    if (this.fetch) {\r\n      return this.fetch(treeNode?.dataSet);\r\n    } else {\r\n      const options: FetchOption = typeof this._dataSource === 'function' ? this._dataSource(treeNode?.dataSet, this._searchText) : this._dataSource;\r\n      return await fetchDataSource(options);\r\n    }\r\n  }\r\n\r\n  async loadChild(treeNode: StormTreeNode) {\r\n    try {\r\n      const dataSource = await this.getDataSource(treeNode);\r\n      const dataSet = this.dataSetParse(dataSource);\r\n\r\n      await this.mergeChild(\r\n        dataSet,\r\n        this.fieldChildren.split('&').map(x => x.trim()),\r\n      );\r\n      setFieldValue(treeNode.dataSet, this.fieldChildLoaded, true);\r\n\r\n      this._items = this.updateItems(this._dataSet);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n    }\r\n  }\r\n\r\n  async mergeChild(source: any, fieldChildren: string[]): Promise<void> {\r\n    for (const item of source) {\r\n      const dest = await this.getNodeById(getFieldValue(item, this.fieldId) as string);\r\n\r\n      for (const part of fieldChildren) {\r\n        const sourcePartValue = getFieldValue(item, part) as object[];\r\n        const destPartValue = getFieldValue(dest, part) as object[];\r\n\r\n        if (!!sourcePartValue && (!destPartValue || destPartValue.length == 0)) {\r\n          setFieldValue(dest, part, sourcePartValue);\r\n        } else if (!!sourcePartValue && sourcePartValue.length > 0) {\r\n          await this.mergeChild(sourcePartValue, [part]);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  dataSetParse(value: object | object[]): object[] {\r\n    const clonedValue = JSON.parse(JSON.stringify(value));\r\n    const structureType = this.structure === 'auto' ? (!Array.isArray(clonedValue) && !!this.fieldChildren ? 'tree' : 'array') : this.structure;\r\n\r\n    switch (structureType) {\r\n      case 'tree':\r\n        return getFieldValue(clonedValue, this.fieldChildren) as object[];\r\n      case 'array':\r\n        return clonedValue as object[];\r\n      default:\r\n        throw new Error(`Unsupported structure type: ${structureType}`);\r\n    }\r\n  }\r\n\r\n  setDataSet(value: object | object[]) {\r\n    if (!value) return;\r\n\r\n    this._dataSet = this.dataSetParse(value);\r\n    this._items = this.updateItems(this._dataSet);\r\n\r\n    this.rerender();\r\n  }\r\n\r\n  updateItems(value: object[], parent: object = null): object[] {\r\n    if (!value || value.length === 0) return [];\r\n\r\n    const items: object[] = [];\r\n    for (const item of value) {\r\n      let id = getFieldValue(item, this.fieldId) as string;\r\n      if (id == null) {\r\n        id = getFieldValue(item, this.fieldLabel) as string;\r\n        setFieldValue(item, this.fieldId, id);\r\n      }\r\n\r\n      if (this.selection != 'none' && item[this.fieldSelectable] == null) {\r\n        setFieldValue(item, this.fieldSelectable, calculateObjectValue(this, this._nodeSelectableRule, item) ?? true);\r\n      }\r\n      if (this.checkSelectable && item[this.fieldCheckSelectable] == null) {\r\n        setFieldValue(item, this.fieldCheckSelectable, calculateObjectValue(this, this._nodeCheckRule, item) ?? true);\r\n      }\r\n\r\n      let level: number = 1;\r\n      if (parent) {\r\n        setFieldValue(item, this.fieldParent, parent);\r\n        level = (getFieldValue(parent, this.fieldLevel) as number) + 1;\r\n      }\r\n\r\n      setFieldValue(item, this.fieldLevel, level);\r\n      if (!(getFieldValue(item, this.fieldChildLoaded) as boolean)) {\r\n        setFieldValue(item, this.fieldExpanded, this.expandLevel > level);\r\n        setFieldValue(item, this.fieldChildLoaded, !this.partialLoad || this.expandLevel > level);\r\n      }\r\n\r\n      items.push(item);\r\n\r\n      const children = getFieldValue(item, this.fieldChildren) as object[];\r\n      if (children && children.length > 0) {\r\n        items.push(...this.updateItems(children, item));\r\n      }\r\n    }\r\n\r\n    return items;\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await SharedStyles.applyShadowRootStylesAsync(this.host, 'material');\r\n    this.expandIcon = this.expandIcon ?? (this.expandIconAlign === 'right' ? 'add' : 'chevron_right');\r\n    this.collapseIcon = this.collapseIcon ?? (this.expandIconAlign === 'right' ? 'remove' : 'expand_more');\r\n    this.watchDataSourceHandler();\r\n    this.watchNodeSelectableRuleHandler();\r\n    this.watchNodeCheckRuleHandler();\r\n  }\r\n\r\n  async componentWillRender() {\r\n    if (this.loading === 'eager' || !this.partialLoad) {\r\n      await this.loadDataSet();\r\n    }\r\n\r\n    if (this.selection != 'none' && !this.nullable && !this.value && this._items?.length) {\r\n      this.value = getFieldValue(\r\n        this._items.find(item => getFieldValue(item, this.fieldSelectable) as boolean),\r\n        this.fieldId,\r\n      ) as string;\r\n    }\r\n\r\n    await this.watchValueHandler();\r\n    await this.watchCheckedHandler();\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    if (this._items?.length) {\r\n      this.dateSetLoaded.emit();\r\n    }\r\n  }\r\n\r\n  handleSearchChanged(ev: CustomEvent<string>) {\r\n    ev.stopPropagation();\r\n    const value = ev.detail?.trim() ?? '';\r\n    if (this._searchText === value) return;\r\n    if (value) {\r\n      this.searchChanged.emit(value);\r\n    }\r\n  }\r\n\r\n  renderSearch() {\r\n    if (!this.searchable) return;\r\n    return <FnSearchInput ref={elm => (this._searchRef = elm)} value={this._searchText} onValueChanged={ev => this.handleSearchChanged(ev)} />;\r\n  }\r\n\r\n  nodesRender() {\r\n    let nodes: any[] = [];\r\n    if (this.partialLoad || !this.searchable || this._searchText == null || !this._searchText.length) {\r\n      nodes = this._dataSet;\r\n    } else {\r\n      nodes = this._items.filter(x => (getFieldValue(x, this.fieldLabel) as string).includes(this._searchText));\r\n    }\r\n    if (nodes.length === 0) return <div class=\"align-middle text-center p-4 h6\">沒有找到符合的結果</div>;\r\n    return nodes.map(item => this.renderNode(item));\r\n  }\r\n\r\n  render() {\r\n    if (!this._dataSet) return;\r\n\r\n    return (\r\n      <Host>\r\n        {this.renderSearch()}\r\n        {this.nodesRender()}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}