{"version":3,"names":["stormCarouselCss","StormCarousel","dataSet","fade","wrap","carousel","carouselRef","videoRefs","componentWillLoad","SharedStyles","applyShadowRootStyles","this","host","componentDidRender","Carousel","ride","addEventListener","ev","controlInterval","playListItems","to","length","forEach","v","next","addItem","Map","map","item","index","h","class","playDuration","addItemElement","mimeType","innerHTML","content","startsWith","src","url","ref","el","set","controls","autoplay","type","pause","get","currentTime","play","cycle","render","Host","key","id"],"sources":["src/components/storm-carousel/storm-carousel.css?tag=storm-carousel&encapsulation=shadow","src/components/storm-carousel/storm-carousel.tsx"],"sourcesContent":[".storm-carousel .center {\r\n  display: block;\r\n  text-align: -webkit-center;\r\n}","import { Component, Element, h, Host, Prop } from '@stencil/core';\r\nimport { Carousel } from 'bootstrap/dist/js/bootstrap.bundle';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\n\r\n@Component({\r\n  tag: 'storm-carousel',\r\n  styleUrl: 'storm-carousel.css',\r\n  shadow: true,\r\n})\r\nexport class StormCarousel {\r\n  @Element() host: HTMLElement;\r\n  @Prop() dataSet: IPlayList;\r\n  @Prop() fade: boolean = false;\r\n  // @Prop() interval: number | boolean = false   //在一個自動循環的輪播中，項目之間所延遲的時間。 如果為 false，輪播不會自動重播。\r\n  @Prop() wrap: boolean = true; //輪播是否應該連續循環，或是會停止。\r\n  carousel: Carousel;\r\n  carouselRef: HTMLDivElement;\r\n  // videoRefs: Map<IMediaFileData,HTMLStormVideoElement>\r\n  videoRefs: Map<IMediaFileData, HTMLVideoElement>;\r\n\r\n  // @Listen('change')\r\n  // listenVideoEnd() {\r\n  //   debugger\r\n  //   this.carousel.next();\r\n  // }\r\n\r\n  componentWillLoad() {\r\n    SharedStyles.applyShadowRootStyles(this.host);\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (!this.dataSet) return;\r\n    // if(!this.carouselRef || this.carousel) return\r\n    this.carousel = new Carousel(this.carouselRef, {\r\n      // interval: true,\r\n      wrap: this.wrap,\r\n      ride: 'carousel',\r\n    });\r\n\r\n    // this.carousel = new Carousel(this.carouselRef, {\r\n    //   interval: this.dataSet.playListItems[0].mimeType.startsWith('video/') ? this.interval : true,\r\n    //   wrap: this.wrap,\r\n    //   pause: this.pause\r\n    //   ride: 'carousel'\r\n    // });\r\n\r\n    this.carouselRef.addEventListener('slid.bs.carousel', (ev: any) => {\r\n      this.controlInterval(this.dataSet.playListItems[ev.to]);\r\n    });\r\n\r\n    if (this.dataSet && this.dataSet.playListItems?.length > 0) {\r\n      this.controlInterval(this.dataSet.playListItems[0]);\r\n    }\r\n\r\n    this.videoRefs?.forEach(v => {\r\n      v.addEventListener('ended', () => {\r\n        this.carousel.next();\r\n      });\r\n    });\r\n  }\r\n\r\n  addItem() {\r\n    if (!this.dataSet) return;\r\n    // this.videoRefs = new Map<IMediaFileData,HTMLStormVideoElement>()\r\n    this.videoRefs = new Map<IMediaFileData, HTMLVideoElement>();\r\n    return this.dataSet.playListItems.map((item, index) => {\r\n      return (\r\n        <div class={index == 0 ? 'carousel-item center active' : 'carousel-item center'} data-bs-interval={item.playDuration > 0 ? item.playDuration * 1000 : false}>\r\n          {this.addItemElement(item)}\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  addItemElement = (item: IMediaFileData): HTMLElement => {\r\n    if (item.mimeType == 'text/html') {\r\n      return <div innerHTML={item.content}></div>;\r\n    } else if (item.mimeType.startsWith('image/')) {\r\n      return <img class=\"d-block\" src={item.url} />;\r\n    } else if (item.mimeType.startsWith('video/')) {\r\n      return (\r\n        <video ref={el => this.videoRefs.set(item, el)} controls autoplay>\r\n          <source src={item.url} type={item.mimeType} />\r\n        </video>\r\n      );\r\n      // return <storm-video url={item.url} autoplay={true} reTime={true} ref={el => this.videoRefs.set(item,el)}/>\r\n    }\r\n  };\r\n\r\n  controlInterval = (item: IMediaFileData) => {\r\n    if (item.mimeType.startsWith('video/')) {\r\n      this.carousel.pause();\r\n      this.videoRefs.get(item).currentTime = 0;\r\n      this.videoRefs.get(item).play();\r\n    } else {\r\n      this.carousel.cycle();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div id=\"carouselControls\" class={this.fade ? 'carousel slide carousel-fade' : 'carousel slide'} ref={el => (this.carouselRef = el)}>\r\n          <div class=\"carousel-inner\">{this.addItem()}</div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface IPlayList {\r\n  playListId?: string;\r\n  name?: string;\r\n  // ownerId: string\r\n  marquee: string;\r\n  playListItems: IMediaFileData[];\r\n}\r\n\r\nexport interface IMediaFileData {\r\n  mediaFileId?: string;\r\n  name?: string;\r\n  description?: string;\r\n  url: string;\r\n  poster?: string;\r\n  playDuration?: number;\r\n  mimeType: 'text/html' | 'image/' | 'video/';\r\n  ownerId: string;\r\n  fileName: string;\r\n  content: string;\r\n}\r\n"],"mappings":"iIAAA,MAAMA,EAAmB,mE,MCSZC,EAAa,M,mDAEhBC,QACAC,KAAgB,MAEhBC,KAAgB,KACxBC,SACAC,YAEAC,UAQA,iBAAAC,GACEC,EAAaC,sBAAsBC,KAAKC,K,CAG1C,kBAAAC,GACE,IAAKF,KAAKT,QAAS,OAEnBS,KAAKN,SAAW,IAAIS,WAASH,KAAKL,YAAa,CAE7CF,KAAMO,KAAKP,KACXW,KAAM,aAURJ,KAAKL,YAAYU,iBAAiB,oBAAqBC,IACrDN,KAAKO,gBAAgBP,KAAKT,QAAQiB,cAAcF,EAAGG,IAAI,IAGzD,GAAIT,KAAKT,SAAWS,KAAKT,QAAQiB,eAAeE,OAAS,EAAG,CAC1DV,KAAKO,gBAAgBP,KAAKT,QAAQiB,cAAc,G,CAGlDR,KAAKJ,WAAWe,SAAQC,IACtBA,EAAEP,iBAAiB,SAAS,KAC1BL,KAAKN,SAASmB,MAAM,GACpB,G,CAIN,OAAAC,GACE,IAAKd,KAAKT,QAAS,OAEnBS,KAAKJ,UAAY,IAAImB,IACrB,OAAOf,KAAKT,QAAQiB,cAAcQ,KAAI,CAACC,EAAMC,IAEzCC,EAAK,OAAAC,MAAOF,GAAS,EAAI,8BAAgC,uBAAsB,mBAAoBD,EAAKI,aAAe,EAAIJ,EAAKI,aAAe,IAAO,OACnJrB,KAAKsB,eAAeL,K,CAM7BK,eAAkBL,IAChB,GAAIA,EAAKM,UAAY,YAAa,CAChC,OAAOJ,EAAA,OAAKK,UAAWP,EAAKQ,S,MACvB,GAAIR,EAAKM,SAASG,WAAW,UAAW,CAC7C,OAAOP,EAAA,OAAKC,MAAM,UAAUO,IAAKV,EAAKW,K,MACjC,GAAIX,EAAKM,SAASG,WAAW,UAAW,CAC7C,OACEP,EAAA,SAAOU,IAAKC,GAAM9B,KAAKJ,UAAUmC,IAAId,EAAMa,GAAKE,SAAQ,KAACC,SAAQ,MAC/Dd,EAAA,UAAQQ,IAAKV,EAAKW,IAAKM,KAAMjB,EAAKM,W,GAO1ChB,gBAAmBU,IACjB,GAAIA,EAAKM,SAASG,WAAW,UAAW,CACtC1B,KAAKN,SAASyC,QACdnC,KAAKJ,UAAUwC,IAAInB,GAAMoB,YAAc,EACvCrC,KAAKJ,UAAUwC,IAAInB,GAAMqB,M,KACpB,CACLtC,KAAKN,SAAS6C,O,GAIlB,MAAAC,GACE,OACErB,EAACsB,EAAI,CAAAC,IAAA,4CACHvB,EAAA,OAAAuB,IAAA,2CAAKC,GAAG,mBAAmBvB,MAAOpB,KAAKR,KAAO,+BAAiC,iBAAkBqC,IAAKC,GAAO9B,KAAKL,YAAcmC,GAC9HX,EAAA,OAAAuB,IAAA,2CAAKtB,MAAM,kBAAkBpB,KAAKc,Y","ignoreList":[]}