{"version":3,"file":"storm-carousel.entry.esm.js","sources":["src/components/storm-carousel/storm-carousel.css?tag=storm-carousel&encapsulation=shadow","src/components/storm-carousel/storm-carousel.tsx"],"sourcesContent":[".storm-carousel .center {\r\n  display: block;\r\n  text-align: -webkit-center;\r\n}","import { Component, Element, h, Host, Prop } from '@stencil/core';\r\nimport { Carousel } from 'bootstrap/dist/js/bootstrap.bundle';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\n\r\n@Component({\r\n  tag: 'storm-carousel',\r\n  styleUrl: 'storm-carousel.css',\r\n  shadow: true,\r\n})\r\nexport class StormCarousel {\r\n  @Element() host: HTMLElement;\r\n  @Prop() dataSet: IPlayList;\r\n  @Prop() fade: boolean = false;\r\n  // @Prop() interval: number | boolean = false   //在一個自動循環的輪播中，項目之間所延遲的時間。 如果為 false，輪播不會自動重播。\r\n  @Prop() wrap: boolean = true; //輪播是否應該連續循環，或是會停止。\r\n  carousel: Carousel;\r\n  carouselRef: HTMLDivElement;\r\n  // videoRefs: Map<IMediaFileData,HTMLStormVideoElement>\r\n  videoRefs: Map<IMediaFileData, HTMLVideoElement>;\r\n\r\n  // @Listen('change')\r\n  // listenVideoEnd() {\r\n  //   debugger\r\n  //   this.carousel.next();\r\n  // }\r\n\r\n  componentWillLoad() {\r\n    SharedStyles.applyShadowRootStyles(this.host);\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (!this.dataSet) return;\r\n    // if(!this.carouselRef || this.carousel) return\r\n    this.carousel = new Carousel(this.carouselRef, {\r\n      // interval: true,\r\n      wrap: this.wrap,\r\n      ride: 'carousel',\r\n    });\r\n\r\n    // this.carousel = new Carousel(this.carouselRef, {\r\n    //   interval: this.dataSet.playListItems[0].mimeType.startsWith('video/') ? this.interval : true,\r\n    //   wrap: this.wrap,\r\n    //   pause: this.pause\r\n    //   ride: 'carousel'\r\n    // });\r\n\r\n    this.carouselRef.addEventListener('slid.bs.carousel', (ev: any) => {\r\n      this.controlInterval(this.dataSet.playListItems[ev.to]);\r\n    });\r\n\r\n    if (this.dataSet && this.dataSet.playListItems?.length > 0) {\r\n      this.controlInterval(this.dataSet.playListItems[0]);\r\n    }\r\n\r\n    this.videoRefs?.forEach(v => {\r\n      v.addEventListener('ended', () => {\r\n        this.carousel.next();\r\n      });\r\n    });\r\n  }\r\n\r\n  addItem() {\r\n    if (!this.dataSet) return;\r\n    // this.videoRefs = new Map<IMediaFileData,HTMLStormVideoElement>()\r\n    this.videoRefs = new Map<IMediaFileData, HTMLVideoElement>();\r\n    return this.dataSet.playListItems.map((item, index) => {\r\n      return (\r\n        <div class={index == 0 ? 'carousel-item center active' : 'carousel-item center'} data-bs-interval={item.playDuration > 0 ? item.playDuration * 1000 : false}>\r\n          {this.addItemElement(item)}\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  addItemElement = (item: IMediaFileData): HTMLElement => {\r\n    if (item.mimeType == 'text/html') {\r\n      return <div innerHTML={item.content}></div>;\r\n    } else if (item.mimeType.startsWith('image/')) {\r\n      return <img class=\"d-block\" src={item.url} />;\r\n    } else if (item.mimeType.startsWith('video/')) {\r\n      return (\r\n        <video ref={el => this.videoRefs.set(item, el)} controls autoplay>\r\n          <source src={item.url} type={item.mimeType} />\r\n        </video>\r\n      );\r\n      // return <storm-video url={item.url} autoplay={true} reTime={true} ref={el => this.videoRefs.set(item,el)}/>\r\n    }\r\n  };\r\n\r\n  controlInterval = (item: IMediaFileData) => {\r\n    if (item.mimeType.startsWith('video/')) {\r\n      this.carousel.pause();\r\n      this.videoRefs.get(item).currentTime = 0;\r\n      this.videoRefs.get(item).play();\r\n    } else {\r\n      this.carousel.cycle();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div id=\"carouselControls\" class={this.fade ? 'carousel slide carousel-fade' : 'carousel slide'} ref={el => (this.carouselRef = el)}>\r\n          <div class=\"carousel-inner\">{this.addItem()}</div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface IPlayList {\r\n  playListId?: string;\r\n  name?: string;\r\n  // ownerId: string\r\n  marquee: string;\r\n  playListItems: IMediaFileData[];\r\n}\r\n\r\nexport interface IMediaFileData {\r\n  mediaFileId?: string;\r\n  name?: string;\r\n  description?: string;\r\n  url: string;\r\n  poster?: string;\r\n  playDuration?: number;\r\n  mimeType: 'text/html' | 'image/' | 'video/';\r\n  ownerId: string;\r\n  fileName: string;\r\n  content: string;\r\n}\r\n"],"names":["Carousel"],"mappings":"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"}