{"version":3,"names":["stormVerticalNavigationCss","StormVerticalNavigation","_dataSet","verticalSLotRef","treeViewRef","verticalList","navigationList","verticalListReverse","verticals","isDebouncing","ticking","treeViewable","dataSet","fixTop","scrollY","selectToCheck","checkSelectable","scroll","checked","checkedChanged","fieldIcon","fieldSelected","value","dataSetWatcher","newValue","this","JSON","parse","scrollHandler","e","newScrollY","detail","window","requestFrame","stopPropagation","innerScrollHandler","requestAnimationFrame","updateFrame","refresh","triggerActive","emit","setVerticalData","getChecked","componentWillLoad","SharedStyles","applyShadowRootStyles","host","componentDidRender","getVertical","setNavigationData","componentDidLoad","addEventListener","async","node","getNodeById","location","replace","origin","pathname","search","setTimeout","assignedElements","length","getScrollContainer","elem","classList","contains","parentElement","map","push","href","getAttribute","top","getBoundingClientRect","slice","reverse","treeNodes","shadowRoot","querySelectorAll","forEach","children","elemChild","viewportMidpoint","innerHeight","activeElem","find","navElem","isActive","addActive","removeActive","forceUpdate","treeViewRender","h","class","selection","onCheckedChanged","ev","handleCheckedChanged","ref","render","Host","key","name"],"sources":["src/layouts/storm-vertical-navigation/storm-vertical-navigation.css?tag=storm-vertical-navigation&encapsulation=shadow","src/layouts/storm-vertical-navigation/storm-vertical-navigation.tsx"],"sourcesContent":[null,"import { Component, Element, Event, EventEmitter, Host, Listen, Method, Prop, Watch, forceUpdate, h } from '@stencil/core';\r\nimport { StormTreeViewCustomEvent } from '../../components';\r\nimport { SharedStyles } from '../../utils/shared-styles';\r\n\r\n@Component({\r\n  tag: 'storm-vertical-navigation',\r\n  styleUrl: 'storm-vertical-navigation.css',\r\n  shadow: true,\r\n})\r\nexport class StormVerticalNavigation {\r\n  private _dataSet: object[];\r\n  private verticalSLotRef: HTMLSlotElement;\r\n  private treeViewRef: HTMLStormTreeViewElement;\r\n\r\n  private verticalList: VerticalData[];\r\n  private navigationList: HTMLStormTreeNodeElement[];\r\n  private verticalListReverse: VerticalData[];\r\n  private verticals: Element[];\r\n  private isDebouncing: boolean = false;\r\n  private ticking: boolean = false;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop() treeViewable: boolean = true;\r\n  @Prop({ reflect: false }) dataSet: object[] | string;\r\n  @Prop() fixTop: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 = 10;\r\n  @Prop({ mutable: true }) scrollY: number;\r\n  @Prop({ mutable: true }) selectToCheck: boolean = false;\r\n  @Prop() checkSelectable: boolean = false;\r\n  @Event() scroll: EventEmitter<number>;\r\n  @Prop({ mutable: true }) checked?: string[];\r\n  @Event() checkedChanged: EventEmitter<string[]>;\r\n  @Prop({ reflect: false }) fieldIcon: string = 'icon';\r\n  @Prop() fieldSelected: string = '_selected';\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher(newValue: object[] | string) {\r\n    if (typeof newValue === 'string') {\r\n      this._dataSet = JSON.parse(newValue);\r\n    } else {\r\n      this._dataSet = newValue;\r\n    }\r\n  }\r\n\r\n  @Listen('scroll', { target: 'document' })\r\n  scrollHandler(e: CustomEvent) {\r\n    if (this.isDebouncing) return;\r\n    const newScrollY = e.detail | window.scrollY;\r\n    if (this.scrollY === newScrollY) return;\r\n    this.scrollY = newScrollY;\r\n\r\n    this.requestFrame();\r\n\r\n    e.stopPropagation();\r\n  }\r\n\r\n  @Listen('innerScroll', { target: 'document' })\r\n  innerScrollHandler(e: CustomEvent) {\r\n    if (this.isDebouncing) return;\r\n    const newScrollY = e.detail | window.scrollY;\r\n    if (this.scrollY === newScrollY) return;\r\n    this.scrollY = newScrollY;\r\n\r\n    this.requestFrame();\r\n\r\n    e.stopPropagation();\r\n  }\r\n\r\n  requestFrame() {\r\n    if (this.ticking) return;\r\n\r\n    this.ticking = true;\r\n    requestAnimationFrame(() => {\r\n      this.ticking = false;\r\n      this.updateFrame();\r\n    });\r\n  }\r\n\r\n  private updateFrame() {\r\n    this.refresh();\r\n    this.triggerActive();\r\n    this.scroll.emit(this.scrollY);\r\n  }\r\n\r\n  @Method()\r\n  refresh() {\r\n    this.setVerticalData();\r\n  }\r\n\r\n  @Method()\r\n  async getChecked(): Promise<string[]> {\r\n    return this.treeViewRef.checked;\r\n  }\r\n\r\n  componentWillLoad() {\r\n    SharedStyles.applyShadowRootStyles(this.host);\r\n\r\n    if (!this.dataSet) return;\r\n    this.dataSetWatcher(this.dataSet);\r\n  }\r\n\r\n  componentDidRender() {\r\n    if (this.verticalList && this.navigationList) return;\r\n    this.getVertical();\r\n    this.setNavigationData();\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.treeViewRef.addEventListener('nodeSelect', async (e: CustomEvent) => {\r\n      const node = await this.treeViewRef.getNodeById(e.detail);\r\n      window.location.replace(window.location.origin + window.location.pathname + window.location.search + node['href']);\r\n      this.isDebouncing = true;\r\n      setTimeout(() => {\r\n        this.isDebouncing = false;\r\n      }, 1);\r\n    });\r\n  }\r\n\r\n  getVertical() {\r\n    this.verticals = this.verticalSLotRef.assignedElements();\r\n    if (this.verticals.length == 0) return;\r\n    this.setVerticalData();\r\n  }\r\n\r\n  getScrollContainer(elem: Element) {\r\n    while (elem) {\r\n      if (elem.classList.contains('ps')) {\r\n        break;\r\n      }\r\n      elem = elem.parentElement;\r\n    }\r\n\r\n    return elem;\r\n  }\r\n\r\n  setVerticalData() {\r\n    this.verticalList = [];\r\n    this.verticals.map(elem => {\r\n      this.verticalList.push({\r\n        href: '#' + elem.getAttribute('id'),\r\n        top: elem.getBoundingClientRect().top + this.scrollY,\r\n      });\r\n    });\r\n    this.verticalListReverse = this.verticalList.slice().reverse();\r\n  }\r\n\r\n  setNavigationData() {\r\n    let treeNodes = this.treeViewRef.shadowRoot.querySelectorAll('storm-tree-node');\r\n    if (treeNodes.length == 0) return;\r\n    this.navigationList = [];\r\n    treeNodes.forEach(elem => {\r\n      this.navigationList.push(elem);\r\n      if (elem.children) {\r\n        elem.querySelectorAll('storm-tree-node').forEach(elemChild => this.navigationList.push(elemChild));\r\n      }\r\n    });\r\n  }\r\n\r\n  triggerActive() {\r\n    const viewportMidpoint = this.scrollY + window.innerHeight / 2;\r\n\r\n    const activeElem = this.verticalListReverse.find(elem => elem.top <= viewportMidpoint);\r\n\r\n    this.navigationList.forEach(navElem => {\r\n      const isActive = navElem.dataSet['href'] === activeElem?.href;\r\n      if (isActive && !navElem.dataSet[this.fieldSelected]) {\r\n        this.addActive(navElem);\r\n      } else if (!isActive && navElem.dataSet[this.fieldSelected]) {\r\n        this.removeActive(navElem);\r\n      }\r\n    });\r\n  }\r\n\r\n  addActive(elem: HTMLStormTreeNodeElement) {\r\n    //let listItem = elem.querySelector('a');\r\n    //listItem.classList.add('active');\r\n    elem.dataSet[this.fieldSelected] = true;\r\n    forceUpdate(elem);\r\n  }\r\n\r\n  removeActive(elem: HTMLStormTreeNodeElement) {\r\n    //let listItem = elem.querySelector('a');\r\n    //listItem.classList.remove('active');\r\n    elem.dataSet[this.fieldSelected] = false;\r\n    forceUpdate(elem);\r\n  }\r\n\r\n  treeViewRender() {\r\n    if (!this.treeViewable) return;\r\n    return (\r\n      <storm-tree-view\r\n        class=\"p-3\"\r\n        selection=\"single\"\r\n        dataSet={this._dataSet}\r\n        selectToCheck={this.selectToCheck}\r\n        checkSelectable={this.checkSelectable}\r\n        checked={this.checked}\r\n        fieldIcon={this.fieldIcon}\r\n        fieldSelected={this.fieldSelected}\r\n        value={this.value}\r\n        onCheckedChanged={ev => this.handleCheckedChanged(ev)}\r\n        ref={e => (this.treeViewRef = e)}\r\n      ></storm-tree-view>\r\n    );\r\n  }\r\n\r\n  handleCheckedChanged(ev: StormTreeViewCustomEvent<string[]>) {\r\n    ev.stopPropagation();\r\n    this.checkedChanged.emit(ev.detail);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class=\"container-fluid my-3 py-3\">\r\n          <div class=\"row mb-5\">\r\n            <div class=\"col-lg-9 mt-lg-0 mt-4\">\r\n              <slot name=\"vertical\" ref={(e: HTMLSlotElement) => (this.verticalSLotRef = e)} />\r\n            </div>\r\n\r\n            <div class=\"col-lg-3\">\r\n              <div class={'position-sticky ' + 'top-' + this.fixTop}>\r\n                <slot name=\"navigation-header\" />\r\n                <div class=\"card\">{this.treeViewRender()}</div>\r\n                {/* <ul class=\"nav flex-column bg-white border-radius-lg p-3\">\r\n                  {this.treeViewRender()}\r\n                  <slot name=\"navigation\"/>\r\n                </ul> */}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface VerticalData {\r\n  href: string;\r\n  top: number;\r\n}\r\n"],"mappings":"2GAAA,MAAMA,EAA6B,G,MCStBC,EAAuB,M,mGAC1BC,SACAC,gBACAC,YAEAC,aACAC,eACAC,oBACAC,UACAC,aAAwB,MACxBC,QAAmB,M,0BAInBC,aAAwB,KACNC,QAClBC,OAAiD,GAChCC,QACAC,cAAyB,MAC1CC,gBAA2B,MAC1BC,OACgBC,QAChBC,eACiBC,UAAoB,OACtCC,cAAwB,YACPC,MAGzB,cAAAC,CAAeC,GACb,UAAWA,IAAa,SAAU,CAChCC,KAAKvB,SAAWwB,KAAKC,MAAMH,E,KACtB,CACLC,KAAKvB,SAAWsB,C,EAKpB,aAAAI,CAAcC,GACZ,GAAIJ,KAAKhB,aAAc,OACvB,MAAMqB,EAAaD,EAAEE,OAASC,OAAOlB,QACrC,GAAIW,KAAKX,UAAYgB,EAAY,OACjCL,KAAKX,QAAUgB,EAEfL,KAAKQ,eAELJ,EAAEK,iB,CAIJ,kBAAAC,CAAmBN,GACjB,GAAIJ,KAAKhB,aAAc,OACvB,MAAMqB,EAAaD,EAAEE,OAASC,OAAOlB,QACrC,GAAIW,KAAKX,UAAYgB,EAAY,OACjCL,KAAKX,QAAUgB,EAEfL,KAAKQ,eAELJ,EAAEK,iB,CAGJ,YAAAD,GACE,GAAIR,KAAKf,QAAS,OAElBe,KAAKf,QAAU,KACf0B,uBAAsB,KACpBX,KAAKf,QAAU,MACfe,KAAKY,aAAa,G,CAId,WAAAA,GACNZ,KAAKa,UACLb,KAAKc,gBACLd,KAAKR,OAAOuB,KAAKf,KAAKX,Q,CAIxB,OAAAwB,GACEb,KAAKgB,iB,CAIP,gBAAMC,GACJ,OAAOjB,KAAKrB,YAAYc,O,CAG1B,iBAAAyB,GACEC,EAAaC,sBAAsBpB,KAAKqB,MAExC,IAAKrB,KAAKb,QAAS,OACnBa,KAAKF,eAAeE,KAAKb,Q,CAG3B,kBAAAmC,GACE,GAAItB,KAAKpB,cAAgBoB,KAAKnB,eAAgB,OAC9CmB,KAAKuB,cACLvB,KAAKwB,mB,CAGP,gBAAAC,GACEzB,KAAKrB,YAAY+C,iBAAiB,cAAcC,MAAOvB,IACrD,MAAMwB,QAAa5B,KAAKrB,YAAYkD,YAAYzB,EAAEE,QAClDC,OAAOuB,SAASC,QAAQxB,OAAOuB,SAASE,OAASzB,OAAOuB,SAASG,SAAW1B,OAAOuB,SAASI,OAASN,EAAK,SAC1G5B,KAAKhB,aAAe,KACpBmD,YAAW,KACTnC,KAAKhB,aAAe,KAAK,GACxB,EAAE,G,CAIT,WAAAuC,GACEvB,KAAKjB,UAAYiB,KAAKtB,gBAAgB0D,mBACtC,GAAIpC,KAAKjB,UAAUsD,QAAU,EAAG,OAChCrC,KAAKgB,iB,CAGP,kBAAAsB,CAAmBC,GACjB,MAAOA,EAAM,CACX,GAAIA,EAAKC,UAAUC,SAAS,MAAO,CACjC,K,CAEFF,EAAOA,EAAKG,a,CAGd,OAAOH,C,CAGT,eAAAvB,GACEhB,KAAKpB,aAAe,GACpBoB,KAAKjB,UAAU4D,KAAIJ,IACjBvC,KAAKpB,aAAagE,KAAK,CACrBC,KAAM,IAAMN,EAAKO,aAAa,MAC9BC,IAAKR,EAAKS,wBAAwBD,IAAM/C,KAAKX,SAC7C,IAEJW,KAAKlB,oBAAsBkB,KAAKpB,aAAaqE,QAAQC,S,CAGvD,iBAAA1B,GACE,IAAI2B,EAAYnD,KAAKrB,YAAYyE,WAAWC,iBAAiB,mBAC7D,GAAIF,EAAUd,QAAU,EAAG,OAC3BrC,KAAKnB,eAAiB,GACtBsE,EAAUG,SAAQf,IAChBvC,KAAKnB,eAAe+D,KAAKL,GACzB,GAAIA,EAAKgB,SAAU,CACjBhB,EAAKc,iBAAiB,mBAAmBC,SAAQE,GAAaxD,KAAKnB,eAAe+D,KAAKY,I,KAK7F,aAAA1C,GACE,MAAM2C,EAAmBzD,KAAKX,QAAUkB,OAAOmD,YAAc,EAE7D,MAAMC,EAAa3D,KAAKlB,oBAAoB8E,MAAKrB,GAAQA,EAAKQ,KAAOU,IAErEzD,KAAKnB,eAAeyE,SAAQO,IAC1B,MAAMC,EAAWD,EAAQ1E,QAAQ,UAAYwE,GAAYd,KACzD,GAAIiB,IAAaD,EAAQ1E,QAAQa,KAAKJ,eAAgB,CACpDI,KAAK+D,UAAUF,E,MACV,IAAKC,GAAYD,EAAQ1E,QAAQa,KAAKJ,eAAgB,CAC3DI,KAAKgE,aAAaH,E,KAKxB,SAAAE,CAAUxB,GAGRA,EAAKpD,QAAQa,KAAKJ,eAAiB,KACnCqE,EAAY1B,E,CAGd,YAAAyB,CAAazB,GAGXA,EAAKpD,QAAQa,KAAKJ,eAAiB,MACnCqE,EAAY1B,E,CAGd,cAAA2B,GACE,IAAKlE,KAAKd,aAAc,OACxB,OACEiF,EACE,mBAAAC,MAAM,MACNC,UAAU,SACVlF,QAASa,KAAKvB,SACda,cAAeU,KAAKV,cACpBC,gBAAiBS,KAAKT,gBACtBE,QAASO,KAAKP,QACdE,UAAWK,KAAKL,UAChBC,cAAeI,KAAKJ,cACpBC,MAAOG,KAAKH,MACZyE,iBAAkBC,GAAMvE,KAAKwE,qBAAqBD,GAClDE,IAAKrE,GAAMJ,KAAKrB,YAAcyB,G,CAKpC,oBAAAoE,CAAqBD,GACnBA,EAAG9D,kBACHT,KAAKN,eAAeqB,KAAKwD,EAAGjE,O,CAG9B,MAAAoE,GACE,OACEP,EAACQ,EAAI,CAAAC,IAAA,4CACHT,EAAK,OAAAS,IAAA,2CAAAR,MAAM,6BACTD,EAAK,OAAAS,IAAA,2CAAAR,MAAM,YACTD,EAAK,OAAAS,IAAA,2CAAAR,MAAM,yBACTD,EAAA,QAAAS,IAAA,2CAAMC,KAAK,WAAWJ,IAAMrE,GAAwBJ,KAAKtB,gBAAkB0B,KAG7E+D,EAAK,OAAAS,IAAA,2CAAAR,MAAM,YACTD,EAAK,OAAAS,IAAA,2CAAAR,MAAO,mBAAqB,OAASpE,KAAKZ,QAC7C+E,EAAM,QAAAS,IAAA,2CAAAC,KAAK,sBACXV,EAAA,OAAAS,IAAA,2CAAKR,MAAM,QAAQpE,KAAKkE,sB","ignoreList":[]}