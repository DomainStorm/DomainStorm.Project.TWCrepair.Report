{"version":3,"file":"storm-dropdown-tree.entry.esm.js","sources":["src/components/storm-dropdown-tree/storm-dropdown-tree.css?tag=storm-dropdown-tree","src/components/storm-dropdown-tree/storm-dropdown-tree.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}","import { Component, Element, Event, EventEmitter, h, Host, Prop, Watch } from '@stencil/core';\r\nimport type { FetchOption } from '../../utils/fetch-data-source/interface';\r\nimport { arrayEqual } from '../../utils/utils';\r\n@Component({\r\n  tag: 'storm-dropdown-tree',\r\n  styleUrl: 'storm-dropdown-tree.css',\r\n  shadow: false,\r\n})\r\nexport class StormDropdownTree {\r\n  private _dropdownRef: HTMLStormDropdownElement;\r\n  private _treeRef: HTMLStormTreeViewElement;\r\n  private _text: string;\r\n\r\n  @Element() host: HTMLElement;\r\n\r\n  @Prop({ mutable: true }) label: string;\r\n  @Prop({ mutable: true }) heading: string;\r\n  @Prop({ mutable: true }) text?: string;\r\n  @Prop({ mutable: true }) value?: string | string[];\r\n  @Prop({ mutable: true }) dataSet?: object | object[];\r\n  @Prop({ mutable: true }) dataSource?: FetchOption | Function | string;\r\n  @Prop({ mutable: true }) disabled?: boolean;\r\n  @Prop() nullable: boolean = false;\r\n  @Prop() fieldId: string = 'id';\r\n  @Prop() fieldLabel: string = 'label';\r\n  @Prop() fieldChildren: string = 'children';\r\n  @Prop() expandLevel: number = 2;\r\n  @Prop() nodeSelectableRule?: string | Function;\r\n  @Prop() size: 'Default' | 'Small' = 'Default';\r\n  @Prop() partialLoad: boolean = false;\r\n  @Prop() loading: 'eager' | 'lazy' = 'lazy';\r\n  @Prop() class: Record<string, boolean> | string;\r\n\r\n  @Prop({ mutable: true }) valid?: boolean;\r\n  @Prop() required?: boolean;\r\n\r\n  @Prop({ mutable: true }) searchText?: string;\r\n  @Prop() searchable: boolean = false;\r\n  @Prop() selection: 'single' | 'multiple' | 'none' = 'single';\r\n\r\n  @Prop({ mutable: true }) timeStamp?: number;\r\n\r\n  @Event() valueChanged: EventEmitter<string | string[]>;\r\n  @Event() textChanged: EventEmitter<string>;\r\n  @Event() searchChanged: EventEmitter<string>;\r\n\r\n  @Watch('value')\r\n  valueWatcher(newValue: string | string[], oldValue: string | string[]) {\r\n    if (arrayEqual(newValue, oldValue)) return;\r\n    this.updateValue();\r\n    this.valueChanged.emit(this.value);\r\n  }\r\n\r\n  @Watch('text')\r\n  textWatcher() {\r\n    this.textChanged.emit(this.text);\r\n  }\r\n\r\n  @Watch('dataSet')\r\n  dataSetWatcher() {\r\n    this._treeRef.dataSet = this.dataSet;\r\n  }\r\n\r\n  updateValue() {\r\n    if (this._treeRef.value != this.value) this._treeRef.value = this.value;\r\n    if (this._dropdownRef.value != this.value) this._dropdownRef.value = this.value;\r\n  }\r\n\r\n  componentDidLoad() {\r\n    this.updateValue();\r\n  }\r\n\r\n  renderTree() {\r\n    return (\r\n      <storm-tree-view\r\n        ref={elm => (this._treeRef = elm)}\r\n        partialLoad={this.partialLoad}\r\n        loading={this.loading}\r\n        value={this.value}\r\n        class={this.class}\r\n        dataSet={this.dataSet}\r\n        dataSource={this.dataSource}\r\n        fieldId={this.fieldId}\r\n        fieldLabel={this.fieldLabel}\r\n        fieldChildren={this.fieldChildren}\r\n        nullable={this.nullable}\r\n        selection={this.selection}\r\n        expandLevel={this.expandLevel}\r\n        nodeSelectableRule={this.nodeSelectableRule}\r\n        searchable={this.searchable}\r\n        onValueChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.value = ev.detail;\r\n        }}\r\n        onNodeClick={async ev => {\r\n          ev.stopPropagation();\r\n          await this._dropdownRef.hide();\r\n        }}\r\n        onSearchChanged={ev => {\r\n          ev.stopPropagation();\r\n          this.searchChanged.emit(ev.detail);\r\n        }}\r\n      ></storm-tree-view>\r\n    );\r\n  }\r\n\r\n  async componentWillRender() {\r\n    this._text = this.text;\r\n    if (this._text == null) {\r\n      if (this._treeRef && this.value) {\r\n        const values = Array.isArray(this.value) ? this.value : [this.value];\r\n        const texts = [];\r\n        for (const value of values) {\r\n          const node = await this._treeRef.getNodeById(value);\r\n          if (node) {\r\n            texts.push(await this._treeRef.getLabel(node));\r\n          }\r\n        }\r\n        this._text = texts.join('„ÄÅ');\r\n      } else {\r\n        this._text = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <storm-dropdown\r\n          ref={elm => (this._dropdownRef = elm)}\r\n          nullable={this.nullable}\r\n          heading={this.heading}\r\n          label={this.label}\r\n          text={this._text}\r\n          value={this.value}\r\n          showSelected={true}\r\n          valid={this.valid}\r\n          required={this.required}\r\n          disabled={this.disabled}\r\n          timeStamp={this.timeStamp}\r\n          type=\"select\"\r\n          onValueChanged={ev => {\r\n            ev.stopPropagation();\r\n            this.value = ev.detail;\r\n            if (this.value == null) {\r\n              this.text = undefined;\r\n            }\r\n          }}\r\n          onUnselectedAll={async ev => {\r\n            ev.stopPropagation();\r\n            await this._treeRef.unselectAll();\r\n          }}\r\n          onShowMenu={async ev => {\r\n            ev.stopPropagation();\r\n            await this._treeRef.loadDataSet();\r\n            if (this.searchable && this._treeRef) {\r\n              requestAnimationFrame(async () => {\r\n                await this._treeRef.setSearchFocus();\r\n              });\r\n            }\r\n          }}\r\n        >\r\n          {this.renderTree()}\r\n        </storm-dropdown>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}