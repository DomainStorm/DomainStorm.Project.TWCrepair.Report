import{r as e,c as t,a as i,f as s,h as a,H as c}from"./p-BrLtLH4U.js";import{S as r}from"./p-B0cWbvbo.js";const h="";const d=class{constructor(i){e(this,i);this.scroll=t(this,"scroll");this.checkedChanged=t(this,"checkedChanged")}_dataSet;verticalSLotRef;treeViewRef;verticalList;navigationList;verticalListReverse;verticals;isDebouncing=false;ticking=false;get host(){return i(this)}treeViewable=true;dataSet;fixTop=10;scrollY;selectToCheck=false;checkSelectable=false;scroll;checked;checkedChanged;fieldIcon="icon";fieldSelected="_selected";value;dataSetWatcher(e){if(typeof e==="string"){this._dataSet=JSON.parse(e)}else{this._dataSet=e}}scrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}innerScrollHandler(e){if(this.isDebouncing)return;const t=e.detail|window.scrollY;if(this.scrollY===t)return;this.scrollY=t;this.requestFrame();e.stopPropagation()}requestFrame(){if(this.ticking)return;this.ticking=true;requestAnimationFrame((()=>{this.ticking=false;this.updateFrame()}))}updateFrame(){this.refresh();this.triggerActive();this.scroll.emit(this.scrollY)}async refresh(){this.setVerticalData()}async getChecked(){return this.treeViewRef.checked}async componentWillLoad(){await r.applyShadowRootStylesAsync(this.host,"material");if(!this.dataSet)return;this.dataSetWatcher(this.dataSet)}componentDidRender(){if(this.verticalList&&this.navigationList)return;this.getVertical();this.setNavigationData()}componentDidLoad(){this.treeViewRef.addEventListener("nodeSelect",(async e=>{const t=await this.treeViewRef.getNodeById(e.detail);window.location.replace(window.location.origin+window.location.pathname+window.location.search+t["href"]);this.isDebouncing=true;setTimeout((()=>{this.isDebouncing=false}),1)}))}getVertical(){this.verticals=this.verticalSLotRef.assignedElements();if(this.verticals.length==0)return;this.setVerticalData()}getScrollContainer(e){while(e){if(e.classList.contains("ps")){break}e=e.parentElement}return e}setVerticalData(){this.verticalList=[];this.verticals.map((e=>{this.verticalList.push({href:"#"+e.getAttribute("id"),top:e.getBoundingClientRect().top+this.scrollY})}));this.verticalListReverse=this.verticalList.slice().reverse()}setNavigationData(){let e=this.treeViewRef.shadowRoot.querySelectorAll("storm-tree-node");if(e.length==0)return;this.navigationList=[];e.forEach((e=>{this.navigationList.push(e);if(e.children){e.querySelectorAll("storm-tree-node").forEach((e=>this.navigationList.push(e)))}}))}triggerActive(){const e=this.scrollY+window.innerHeight/2;const t=this.verticalListReverse.find((t=>t.top<=e));this.navigationList.forEach((e=>{const i=e.dataSet["href"]===t?.href;if(i&&!e.dataSet[this.fieldSelected]){this.addActive(e)}else if(!i&&e.dataSet[this.fieldSelected]){this.removeActive(e)}}))}addActive(e){e.dataSet[this.fieldSelected]=true;s(e)}removeActive(e){e.dataSet[this.fieldSelected]=false;s(e)}treeViewRender(){if(!this.treeViewable)return;return a("storm-tree-view",{class:"p-3",selection:"single",dataSet:this._dataSet,selectToCheck:this.selectToCheck,checkSelectable:this.checkSelectable,checked:this.checked,fieldIcon:this.fieldIcon,fieldSelected:this.fieldSelected,value:this.value,onCheckedChanged:e=>this.handleCheckedChanged(e),ref:e=>this.treeViewRef=e})}handleCheckedChanged(e){e.stopPropagation();this.checkedChanged.emit(e.detail)}render(){return a(c,{key:"ed3b3b6c2c40017249657aecbf01030149e2ab07"},a("div",{key:"d1287058d16585e7b8245398cc0bdcbbed27e828",class:"container-fluid my-3 py-3"},a("div",{key:"461bd50ea28c0c815650fae349ed9558ce8e15ac",class:"row mb-5"},a("div",{key:"544fdc6eba99f0de5ac6de7524372039e4702f4f",class:"col-lg-9 mt-lg-0 mt-4"},a("slot",{key:"2ad47edc384f04976c575f859ca5990e482762f6",name:"vertical",ref:e=>this.verticalSLotRef=e})),a("div",{key:"0ecf092e61b62fbb5dba3c97bf6d0a9502fb861b",class:"col-lg-3"},a("div",{key:"436179985b7f912ded4c9da6ed199c30e49474a4",class:"position-sticky "+"top-"+this.fixTop},a("slot",{key:"9cd9075af106cf9057fe821dc6e69a385da2fb9c",name:"navigation-header"}),a("div",{key:"83694dca7ecb8b476f37d463ed5469de9376bd70",class:"card"},this.treeViewRender()))))))}static get watchers(){return{dataSet:["dataSetWatcher"]}}};d.style=h;export{d as storm_vertical_navigation};
//# sourceMappingURL=p-701c6058.entry.js.map